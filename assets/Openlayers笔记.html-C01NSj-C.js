import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as c,c as l,a as n,d as s,b as t,e as p}from"./app-DQm1rv6y.js";const i="/assets/image-20230419111002080-BDfbCim_.png",u="/assets/image-20230419113545351-a4W0Z8Ip.png",r="/assets/image-20230419113559070-BnSLYxil.png",k="/assets/image-20230713194821191-_7eEIwL-.png",d="/assets/image-20230419113849291-BbzFmk5L.png",v="/assets/image-20230419113902091-C-2xWA--.png",m="/assets/image-20230419114002037-GD80lWOp.png",b="/assets/image-20230419114025340-CsV7ribH.png",y="/assets/image-20230419114101500-CSwxJ4gP.png",g="/assets/image-20230713203311600-Dt2tI4zg.png",w="/assets/image-20240323010618300-C02wdcah.png",f="/assets/image-20210723165744815-CQn7aZ_l.png",q="/assets/image-20230713204022219-DdS4wDi_.png",h="/assets/image-20230713204240680-BBY6exVX.png",S="/assets/image-20230713204918186-CgZVSpSt.png",x="/assets/image-20230713205109590-Cm-6FvIo.png",L="/assets/image-20230714093233969-BioZ-g9J.png",_="/assets/image-20230714110422177-CaBdAsQn.png",M="/assets/image-20230714111814666-CDQx2OKW.png",P="/assets/image-20230714112116258-BStS5XJt.png",F="/assets/image-20230714134751754-BB1xtAcl.png",C="/assets/image-20230714141625197-Sx3SPNnP.png",O="/assets/添加交互-DOQ-Hn0k.gif",G="/assets/多选-D93C_d6Z.gif",T="/assets/普通聚合-CrzcQaNE.gif",V="/assets/image-20230714153516516-D08c9In_.png",E="/assets/image-20230714153609781-BRgYlVlp.png",z="/assets/轨迹-B_RCvT2s.gif",I="/assets/image-20231206162314667-VuwjQ931.png",W="/assets/image-20231206162829592-SlTyHWgs.png",j="/assets/image-20231206163335871-DGgpBfSL.png",D="/assets/image-20231206163355407-y-OoX90Y.png",N={},A=p(`<h1 id="openlayers笔记" tabindex="-1"><a class="header-anchor" href="#openlayers笔记"><span>Openlayers笔记</span></a></h1><h2 id="一、基础配置" tabindex="-1"><a class="header-anchor" href="#一、基础配置"><span>一、基础配置</span></a></h2><h3 id="_1、准备工作" tabindex="-1"><a class="header-anchor" href="#_1、准备工作"><span>1、准备工作</span></a></h3><h4 id="_1-1、安装openlayers" tabindex="-1"><a class="header-anchor" href="#_1-1、安装openlayers"><span>1.1、安装openlayers</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>npm install ol
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_1-2、导入ol" tabindex="-1"><a class="header-anchor" href="#_1-2、导入ol"><span>1.2、导入ol</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">&#39;ol/ol.css&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 在main.ts引入地图样式</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ol <span class="token keyword">from</span> <span class="token string">&#39;ol&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 在地图组件页面中一级属性可一次性全部导入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View<span class="token punctuation">,</span> Feature <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol&#39;</span> <span class="token comment">// 在地图组件页面中一级属性也可按需导入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Tile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/layer&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 二级属性必须由ol/xxx(一级属性名)进行按需导入</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、初始化" tabindex="-1"><a class="header-anchor" href="#_2、初始化"><span>2、初始化</span></a></h3><h4 id="_2-1、准备地图容器" tabindex="-1"><a class="header-anchor" href="#_2-1、准备地图容器"><span>2.1、准备地图容器</span></a></h4><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapContent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapContent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token comment">/*为地图容器指定大小*/</span>
<span class="token selector">.mapContent</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vh - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2、初始化地图" tabindex="-1"><a class="header-anchor" href="#_2-2、初始化地图"><span>2.2、初始化地图</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> map<span class="token operator">:</span>Map<span class="token comment">//定义一个Map类型的变量，接收地图实例</span>
<span class="token comment">//定义初始化地图实例函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">initMap</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        target<span class="token operator">:</span><span class="token string">&quot;mapContent&quot;</span><span class="token punctuation">,</span><span class="token comment">//地图容器</span>
        view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            center<span class="token operator">:</span> <span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">108.84</span><span class="token punctuation">,</span> <span class="token number">34.26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将坐标从经度/纬度转换为其他投影。</span>
      		zoom<span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token comment">//缩放级别</span>
      		projection<span class="token operator">:</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">,</span> <span class="token comment">//设置投影坐标为自定义坐标EPSG:4548</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
        controls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//地图控件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//在onMounted钩子函数上挂载初始化函数</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
	<span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、view视图中常用配置" tabindex="-1"><a class="header-anchor" href="#_3、view视图中常用配置"><span>3、view视图中常用配置</span></a></h3><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.06</span><span class="token punctuation">,</span> <span class="token number">30.67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 成都EPSG:4326坐标系中心点</span>
    projection<span class="token operator">:</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 坐标系 若不设置坐标系格式，则默认为EPSG:3857的坐标系</span>
    zoom<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">//默认缩放值</span>
    maxZoom<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">//最大缩放值</span>
    minZoom<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">//最小缩放值</span>
    rotation<span class="token operator">:</span> <span class="token number">1.57</span><span class="token punctuation">,</span> <span class="token comment">//旋转 按照一圈（2π）3.1415926...*2来计算，比如90度大约就是3.14/2=1.57，旋转方向为顺时针，可设置负值</span>
    extent<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">101.87372</span><span class="token punctuation">,</span> <span class="token number">26.68196289</span><span class="token punctuation">,</span> <span class="token number">109.498232</span><span class="token punctuation">,</span> <span class="token number">34.1087207</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 定义地图容器初始所显示的内容，鼠标对地图进行拖动时无法超过这个边界 [xMin, yMin, xMax, yMax]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="二、地图控件" tabindex="-1"><a class="header-anchor" href="#二、地图控件"><span>二、地图控件</span></a></h2><p><strong>OpenLayers</strong>封装了很多地图控件用于操作地图内容、显示地图信息等。具体来说，控件是一个地图上可见的一个小部件，其DOM元素位于屏幕的固定位置，使用CSS来决定控件位置。 在将设置的图层数据渲染呈现到Web客户端的时候，<strong>OpenLayers</strong>首先在我们自定义的div元素中创建一个<strong>Viewport</strong>容器，地图的所有内容都放置在<strong>Viewport</strong>中。主要分为三个关键层：</p><ul><li>地图渲染层：canvas元素，地图基于canvas方式渲染。</li><li>内容叠加层：用于放置覆盖层内容，如弹窗、图片等等。</li><li>地图控件层：用于放置控件，默认情况会放置zoom、rotate1、attribution这三个控件。</li></ul><img src="`+i+'" alt="image-20230419111002080" style="zoom:80%;"><h3 id="_1、普通缩放控件" tabindex="-1"><a class="header-anchor" href="#_1、普通缩放控件"><span>1、普通缩放控件</span></a></h3><p>普通缩放控件具有两个按钮分别用于地图的缩小和放大。可以用鼠标分别点击这两个按钮用于地图缩小和放大。</p><figure><img src="'+u+'" alt="image-20230419113545351" tabindex="0" loading="lazy"><figcaption>image-20230419113545351</figcaption></figure><p>打开浏览器的开发者工具，可以发现普通缩放控件的DOM元素确实放在地图控件层中：</p><img src="'+r+'" alt="image-20230419113559070" style="zoom:80%;"><p>可以通过<code>map.getControls().getArray()</code>返回一个地图控件数组，里面包含了地图中默认的控件实例，而这个数组的第一个元素就是普通缩放控件的实例。</p><p>查看<code>ol.control.Zoom</code>类的API文档，可以发现<strong>OpenLayers</strong>设计了许多属性以方便开发人员对普通缩放控件进行调整：</p><figure><img src="'+k+`" alt="image-20230713194821191" tabindex="0" loading="lazy"><figcaption>image-20230713194821191</figcaption></figure><p>可以通过为<code>target</code>属性赋值为自定义的DOM元素来为普通缩放控件绑定指定的DOM元素。</p><h3 id="_2、滑块缩放控件" tabindex="-1"><a class="header-anchor" href="#_2、滑块缩放控件"><span>2、滑块缩放控件</span></a></h3><p>普通缩放控件<code>ol.control.Zoom</code>会被默认加到地图中的，而滑块缩放控件<code>ol.control.ZoomSlider</code>不会被默认加入到地图中:</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 关联到对应的div容器</span>
  layers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 瓦片图层</span>
      source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// OpenStreetMap数据源</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 地图视图</span>
    projection<span class="token operator">:</span> <span class="token string">&quot;EPSG:3857&quot;</span><span class="token punctuation">,</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    zoom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  controls<span class="token operator">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 往地图增加滑块缩放控件</span>
    <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">ZoomSlider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>OpenLayers</strong>实现了一个对原生JavaScript的Array类进行扩展的类<code>ol.Collection</code>，Map对象会保存一个<code>ol.Collection</code>实例用于存放控件。</p><p>上面的新增代码中，<code>ol.control.defaults()</code>方法就用于返回保存默认控件的<code>ol.Collection</code>实例，然后使用<code>ol.Collection</code>类的<code>extend()</code>方法往里增加了滑块缩放控件。</p><figure><img src="`+d+'" alt="image-20230419113849291" tabindex="0" loading="lazy"><figcaption>image-20230419113849291</figcaption></figure><p>可以发现滑块缩放控件已经渲染在地图界面上了（透明度有点高），可以使用鼠标拖拉滑块来缩放地图！</p><figure><img src="'+v+`" alt="image-20230419113902091" tabindex="0" loading="lazy"><figcaption>image-20230419113902091</figcaption></figure><p>打开浏览器的开发者工具，可以发现在地图控件层中增加了一个用于承载滑块缩放控件的DOM元素。</p><h3 id="_3、缩放至特定位置控件" tabindex="-1"><a class="header-anchor" href="#_3、缩放至特定位置控件"><span>3、缩放至特定位置控件</span></a></h3><p>关于缩放至特定位置控件<code>ol.control.ZoomToExtent</code>，在上述代码中添加：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code> <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            target<span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>                          <span class="token comment">// 关联到对应的div容器</span>
            layers<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                 <span class="token comment">// 瓦片图层</span>
                    source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// OpenStreetMap数据源</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                     <span class="token comment">// 地图视图</span>
                projection<span class="token operator">:</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">,</span>
                center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                zoom<span class="token operator">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            controls<span class="token operator">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token comment">// 往地图增加控件</span>
                <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">ZoomSlider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token comment">// 滑块缩放控件</span>
                <span class="token comment">// 新增代码</span>
                <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">ZoomToExtent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>           <span class="token comment">// 缩放至特定位置控件      </span>
                    extent<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token number">12667718</span><span class="token punctuation">,</span> <span class="token number">2562800</span><span class="token punctuation">,</span>
                        <span class="token number">12718359</span><span class="token punctuation">,</span> <span class="token number">2597725</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里创建了一个ol.control.ZoomToExtent类的实例，从而创建了一个缩放至特定位置控件。其中的extent属性用于指定缩放的目标位置，它是一个数组，前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标：</p><figure><img src="`+m+'" alt="image-20230419114002037" tabindex="0" loading="lazy"><figcaption>image-20230419114002037</figcaption></figure><p>最后通过<code>ol.Collectionl</code>类的<code>extend()</code>方法将该控件增加到地图中。</p><figure><img src="'+b+`" alt="image-20230419114025340" tabindex="0" loading="lazy"><figcaption>image-20230419114025340</figcaption></figure><h3 id="_4、修改控件样式" tabindex="-1"><a class="header-anchor" href="#_4、修改控件样式"><span>4、修改控件样式</span></a></h3><p>OpenLayers为承载控件的各个DOM元素都自动设置了类名，所以通过CSS的类选择符就可以修改指定的控件样式。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  target<span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 关联到对应的div容器</span>
  layers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 瓦片图层</span>
      source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// OpenStreetMap数据源</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 地图视图</span>
    projection<span class="token operator">:</span> <span class="token string">&quot;EPSG:3857&quot;</span><span class="token punctuation">,</span>
    center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    zoom<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  controls<span class="token operator">:</span> ol<span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">defaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 往地图增加控件</span>
    <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">ZoomSlider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 滑块缩放控件</span>
    <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>control<span class="token punctuation">.</span><span class="token function">ZoomToExtent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 缩放至特定位置控件</span>
      extent<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">12667718</span><span class="token punctuation">,</span> <span class="token number">2562800</span><span class="token punctuation">,</span> <span class="token number">12718359</span><span class="token punctuation">,</span> <span class="token number">2597725</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+y+'" alt="image-20230419114101500" tabindex="0" loading="lazy"><figcaption>image-20230419114101500</figcaption></figure><h3 id="_5、控件列表" tabindex="-1"><a class="header-anchor" href="#_5、控件列表"><span>5、控件列表</span></a></h3>',48),B=n("strong",null,"OpenLayers",-1),Z={href:"https://openlayers.org/en/latest/apidoc/module-ol_control_Control-Control.html",target:"_blank",rel:"noopener noreferrer"},J=p('<table><thead><tr><th>控件名称</th><th>控件功能</th></tr></thead><tbody><tr><td>Zoom</td><td>显示地图的放大和缩小按钮，用于调整地图的缩放级别。</td></tr><tr><td>ScaleLine</td><td>在地图上显示比例尺线，用于测量地图中的距离和比例尺。</td></tr><tr><td>Attribution</td><td>显示地图的版权信息和数据源信息，用于向用户提供地图来源和使用限制等信息。</td></tr><tr><td>FullScreen</td><td>提供一个全屏切换按钮，使地图占据整个屏幕空间。</td></tr><tr><td>MousePosition</td><td>在指定位置显示鼠标所在位置的经纬度坐标。</td></tr><tr><td>OverviewMap</td><td>显示地图的总体概览图，可以通过鼠标拖动来移动地图。</td></tr><tr><td>Rotate</td><td>提供一个旋转按钮，使用户可以旋转地图视图。</td></tr><tr><td>ZoomSlider</td><td>在地图上显示一个缩放滑块条，用户可以通过拖动来调整地图的缩放级别。</td></tr><tr><td>ZoomToExtent</td><td>提供一个快速缩放到指定范围的按钮，可通过传入一个 Extent 对象来设置缩放范围。</td></tr><tr><td>LayerSwitcher</td><td>提供一个图层切换控件，用于显示和切换不同的地图图层。</td></tr><tr><td>PanZoomBar</td><td>在地图上显示一个拖动条和放大/缩小按钮，用于调整地图的平移和缩放。</td></tr><tr><td>ZoomBox</td><td>提供一个框选缩放控件，用于在地图上进行矩形选择缩放。</td></tr><tr><td>DragPan</td><td>提供一个拖动平移控件，允许用户通过鼠标拖动来平移地图视图。</td></tr><tr><td>DragZoom</td><td>提供一个框选缩放控件，用于在地图上进行矩形选择缩放。</td></tr><tr><td>KeyboardPan</td><td>提供键盘平移控件，允许用户使用键盘上的方向键来平移地图视图。</td></tr><tr><td>KeyboardZoom</td><td>提供键盘缩放控件，允许用户使用 &quot;+&quot; 和 &quot;-&quot; 键来调整地图的缩放级别。</td></tr><tr><td>ModifyFeature</td><td>提供一个修改要素控件，用于编辑和修改地图上的矢量要素。</td></tr><tr><td>Navigation</td><td>提供一个多功能导航控件，允许用户进行平移、缩放、旋转和拖动等地图操作。</td></tr><tr><td>SelectFeature</td><td>提供一个选择要素控件，用于选择和高亮显示地图上的矢量要素。</td></tr><tr><td>TouchNavigation</td><td>提供一个多功能触摸导航控件，类似于 Navigation 控件，但适用于移动设备上的触摸操作。</td></tr></tbody></table><h2 id="三、图层" tabindex="-1"><a class="header-anchor" href="#三、图层"><span>三、图层</span></a></h2><h3 id="_1、瓦片地图" tabindex="-1"><a class="header-anchor" href="#_1、瓦片地图"><span>1、瓦片地图</span></a></h3><h4 id="_1-1、瓦片地图原理" tabindex="-1"><a class="header-anchor" href="#_1-1、瓦片地图原理"><span>1.1、瓦片地图原理</span></a></h4><p>​ <strong>瓦片地图</strong>是一种对于大地图的解决方案，针对一整块非常大的地图进行切片，将其分成很多相同的大小的小块地图，在用户访问的时候进行逐块加载，还原成一整块大地图，可以有效的提高Web地图的访问速率。</p><p>​ 原理上，瓦片地图就是在<strong>多个比例尺</strong>下配置地图，然后提前把每个比例尺下的地图绘制成小块地图，保存在服务器的<strong>缓存目录</strong>中，这样客户端在访问地图时，可以直接获取需要的小块地图拼接成整块地图，而不是服务器动态的创建出一幅地图再发送给客户端，从而极大的提高了访问速度。</p><figure><img src="'+g+'" alt="image-20230713203311600" tabindex="0" loading="lazy"><figcaption>image-20230713203311600</figcaption></figure><p>瓦片地图采用的是<strong>金字塔模型</strong>，是一种多分辨率层次模型，从瓦片金字塔的底层到顶层，比例尺越来越小，分辨率越来越低，但是表示的<strong>地图范围不变</strong>，瓦片地图通常带有一个级别、行与列编号方案，以便将来自于多个瓦片地图服务的瓦片放到正确的位置。</p><h4 id="_1-2、lod原理" tabindex="-1"><a class="header-anchor" href="#_1-2、lod原理"><span>1.2、LOD原理</span></a></h4><p><strong>LOD</strong>是Levels of Detail（<strong>细节层级</strong>）的简写，用于根据当前的环境，渲染不同的图像，用于降低非重要内容的细节度，从而提高渲染效率，在电子游戏中经常运用，对于需要显示全球地图的GIS系统而言，更需要应用这项技术。</p><p>在不同的<strong>LOD</strong>下，自然<strong>分辨率</strong>就可能不一样，这两者是紧密结合在一起的。对于图形显示系统而言，<strong>分辨率</strong>作为屏幕坐标和世界坐标之间计算的纽带，其作用是非常重要的（例如，屏幕上两个像素点间的距离对应的现实世界的距离是多少，这就需要通过<strong>分辨率</strong>来衡量与计算——<strong>分辨率</strong>将在这篇文章的后面进行介绍）。</p><p>在详细讲解之前，假设给你两张A4纸，在其中一张纸上把你家整个绘制上去，在另一张纸上只把你睡的房间绘制上去。如果别人想看你家，你会给哪一张纸？如果想看你睡的房间，你会给哪一张纸？相信你不会给错，LOD就是这种根据不同需要，采用不同图的技术方案。在地图应用中，最直观的体验，就是地图放大缩小。当地图放大后，能看到更详细的地理信息，比如街道、商店等等。当地图缩小再缩小，原来能看到的街道、商店就看不见了，但是能看到更大的区域。我们的屏幕就相当于是A4纸，大小不变。</p><p><strong>LOD</strong>非常符合我们的自然习惯，所以在很多图形系统中都使用了这项技术。在GIS系统中，不断放大，就能看到更多地图细节，了解更加详细的信息。对于GIS引擎的开发者而言，需要实现这项技术，当发现用户放大地图时，就立马使用更有细节的地图图片，替换现在显示的地图图片。现在问题来了：意思是说对于同一个地点而言，需要有更多张呈现不同细节程度的图片？是的，你没有猜错。虽然在使用<strong>瓦片地图</strong>的过程中，感觉放大、缩小地图是浑然一体的，但其实就在你眼皮下发生了图片替换。不同层级使用具有不同细节的<strong>地图瓦片</strong>，这就需要为每一个层级准备图片，如果使用离线工具下载<strong>瓦片地图</strong>，会看到下载的图片是按照<strong>层级Z</strong>进行存储的。开发者不用担心数据源的处理，只需要知道这个原理就可以了。</p><p>为了便于理解GIS系统中不同层级，使用不同的图片，下面使用<strong>google在线瓦片地图</strong>进行说明。最小层级0情况下，只用了一张256*256像素的图片表示整个地球平面：</p><figure><img src="'+w+'" alt="image-20240323010618300" tabindex="0" loading="lazy"><figcaption>image-20240323010618300</figcaption></figure><p>稍大一个层级1情况下，用了四张256*256像素的图片（各张图片中表示的信息更丰富了）来表示整个地球：</p><figure><img src="'+f+'" alt="image-20210723165744815" tabindex="0" loading="lazy"><figcaption>image-20210723165744815</figcaption></figure><h4 id="_1-3、瓦片计算" tabindex="-1"><a class="header-anchor" href="#_1-3、瓦片计算"><span>1.3、瓦片计算</span></a></h4><p>不同环境条件下，加载具有不同细节的图片资源，可以提高效率，但这并不是终点。<strong>瓦片技术</strong>可以更进一步提高效率。其原理是将一张大图片（完整地图）切割成很多张小图片（<strong>地图瓦片</strong>），按照呈现需求，加载其中的几张小图片即可。</p><p>为什么这样就能提高效率？因为屏幕显示窗口的大小是固定的，比如屏幕分辨率是<code>800*600</code>，或者<code>1024*768</code>，又或者是<code>1920*800</code>等等。如果屏幕分辨率是<code>800*600</code>，一张大图是<code>9000*9000</code>，那么同一时间，你只能看到这张图片的十分之一。但是在不切片的情况下，你却必须要加载整个地图。如果是在本地浏览还好，假如是发布到网络上，则网络传输和渲染，都将耗时。如果我们按照<code>500*500</code>大小进行切片，我们则只需要加载4张<code>500*500</code>的小图片就可以了（就可以布满<strong>分辨率</strong>是<code>800*600</code>的屏幕）。对于WebGIS而言，需要在网络上发布，同时需要显示整个地球，自然需要使用<strong>瓦片技术</strong>。</p><p>如果对整个地球图片进行切片，需要考虑的是整个地球图片大小，以及切片规则，切片（瓦片）大小。</p><p>对于WebGIS而言，在线地图几乎都采用<strong>墨卡托投影坐标系（Mercator)</strong>，对应的地图投影到平面上就是一个正方形。为了方便使用，切片时大多按照正方形的方式来进行切片，比如切片大小为<code>256*256</code>（单位<strong>像素</strong>）。一个<code>1024*1024</code>的地图，就可以切片4张小的<strong>瓦片</strong>。同时，瓦片大小几乎都是<code>256*256</code>，有一些则会增加到<code>512*512</code>（由于以前的屏幕<strong>分辨率</strong>通常比较低，所以<code>256*256</code>的瓦片在低分辨率的屏幕上显示效果比较好，随着屏幕<strong>分辨率</strong>的提高，瓦片大小自然也就增加到<code>512*512</code>）。</p><p><strong>LOD</strong>会使得不同层级下的全球地图大小不一致，结合<strong>瓦片地图技术</strong>一起，就出现了<strong>金字塔瓦片结构</strong>：</p><figure><img src="'+q+`" alt="image-20230713204022219" tabindex="0" loading="lazy"><figcaption>image-20230713204022219</figcaption></figure><p>在WebGIS中，上一层级的一张瓦片，在更大一层级中，会用4张瓦片来表示，依次类推，比如上一节中看到的<strong>Google在线瓦片地图</strong>的第0级和第1级的瓦片地图。这样做可以维持正方形的投影方式不变，同时按照2的幂次方放大（<strong>瓦片</strong>的边长），计算效率非常高。</p><p>通过上面切片的介绍，我们可以对每一层级<strong>瓦片</strong>的数量进行简单的计算：</p><ul><li><p>层级0的瓦片数是1=2<sup>0∗2</sup>0</p></li><li><p>层级1的瓦片数是4=2<sup>1*2</sup>1</p></li><li><p>层级n的瓦片数是<strong>2<sup>n*2</sup>n</strong></p><p>这个地方计算的是所有瓦片数，因为是一个正方形，所以是边长的平方。如果只计算x轴或y轴一边的瓦片数，就是2^n个。</p></li></ul><p>任意一个层级的地图，切成多个<strong>瓦片</strong>后，我们需要给<strong>瓦片</strong>编号，才能通过编号找到<strong>瓦片</strong>。这个问题就涉及到<strong>瓦片坐标系</strong>。不同的在线地图服务商，可能定义不一样的<strong>瓦片坐标系</strong>，坐标系不一样，那么对应的同一个位置的<strong>瓦片</strong>的坐标也会不一样。需要引起重视。</p><p>在OpenLayers提供了一个用于调试瓦片的<code>source : ol.source.TileDebug</code>类。可以清晰的看到每一个<strong>瓦片</strong>的坐标：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;map&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;width: 100%&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">var</span> osmSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    layers<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 加载Open Street Map地图</span>
      <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        source<span class="token operator">:</span> osmSource
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 添加一个显示Open Street Map地图瓦片网格的图层</span>
      <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">TileDebug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          projection<span class="token operator">:</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">,</span>
          tileGrid<span class="token operator">:</span> osmSource<span class="token punctuation">.</span><span class="token function">getTileGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
    view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      center<span class="token operator">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      zoom<span class="token operator">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+h+'" alt="image-20230713204240680" tabindex="0" loading="lazy"><figcaption>image-20230713204240680</figcaption></figure><p>首先从上图可以看到地图上多了网格，每一个网格对应的就是一个<strong>瓦片</strong>。其次网格中有三个数字，这些数字就表示当前<strong>瓦片</strong>的坐标：</p><ul><li>第一个数字是层级z</li><li>第二个数字是表示经度方向上的x</li><li>第三个数字是表示纬度方向上的y</li></ul>',33),R={href:"https://mp.csdn.net/postedit/81317693",target:"_blank",rel:"noopener noreferrer"},X=p('<h4 id="_1-4、分辨率" tabindex="-1"><a class="header-anchor" href="#_1-4、分辨率"><span>1.4、分辨率</span></a></h4><p>前面简单提到过，<strong>分辨率</strong>是屏幕坐标和世界坐标的纽带，通过它，才能知道你在屏幕上用鼠标点击的位置对应于世界地图具体的<strong>经纬度</strong>位置。当然你不用自己来做这个计算，OpenLayers的ol.Map类已提供了对应的方法<code>getCoordinateFromPixel()</code>来帮助你实现坐标转换。</p><p>上面说到每一个层级会使用不同数量的瓦片来表示整个地球，那么无论是哪一个层级，所表示的实际地理空间范围都是一致的。但使用的瓦片个数却是不一样的。</p><p>以<strong>Google在线地图</strong>为例，层级0使用了一个<strong>瓦片</strong>，<strong>层级</strong>1使用了4个<strong>瓦片</strong>。通过计算可以知道层级0的整个地球图像（<strong>瓦片</strong>）为<code>256*256</code>像素大小，层级1整个地球图像为<code>512*512</code>像素大小。层级0和层级1表示的地球范围都是一样的<strong>经度</strong>[-180, 180]，<strong>纬度</strong>[-90, 90]。在层级0的时候，一个像素就表示<code>360/256 = 1.40625</code>这么长的<strong>经度</strong>范围，<code>180/256 = 0.703125</code>这么长的<strong>纬度</strong>范围。而这两个数字就是<strong>分辨率</strong>了，<strong>即一个像素所表示的现实世界的范围是多少</strong>，这个范围可能是度，可能是米，或者其他单位，根据具体的情况而定。</p><p>OpenLayers默认设置了加载<strong>瓦片地图</strong>时采用的<strong>分辨率</strong>，通过一个示例来看一下：</p><figure><img src="'+S+`" alt="image-20230713204918186" tabindex="0" loading="lazy"><figcaption>image-20230713204918186</figcaption></figure><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;map&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;width: 100%&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>当前层级：<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">&quot;zoom&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>分辨率：<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span>span id<span class="token operator">=</span><span class="token string">&quot;resolution&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        layers<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        target<span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
        view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          center<span class="token operator">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>
              <span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          zoom<span class="token operator">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 监听层级变化，输出当前层级和分辨率</span>
    map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;change:resolution&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;zoom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;，&#39;</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;resolution&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
 
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;zoom&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;，&#39;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;resolution&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>缩放上面的地图，从层级0开始，用前面介绍的公式和当前地图显示的<strong>分辨率</strong>进行比较，你会发现OpenLayers默认采用的<strong>分辨率</strong>和<strong>Google在线瓦片地图</strong>一样。</p><p>OpenLayers<strong>瓦片地图</strong>默认分辨率表：</p><figure><img src="`+x+`" alt="image-20230713205109590" tabindex="0" loading="lazy"><figcaption>image-20230713205109590</figcaption></figure><blockquote><p>注意：</p><p>为什么我们上面一直以<strong>Google在线瓦片地图</strong>举例说明？因为不同的<strong>在线瓦片地图</strong>可能采用不一样的<strong>分辨率</strong>，比如<strong>百度在线瓦片地图</strong>。所以在使用<strong>在线瓦片地图</strong>或者自己制作的<strong>瓦片地图</strong>时，都需要知道使用的<strong>分辨率</strong>是多少。如若不然，可能也会出现位置偏移。</p></blockquote><h3 id="_2、加载在线瓦片地图" tabindex="-1"><a class="header-anchor" href="#_2、加载在线瓦片地图"><span>2、加载在线瓦片地图</span></a></h3><p>主要包括开源的OSM、Bing、Stamen地图，Openlayers已经做好了相应的封装，可以直接使用。</p><h4 id="_2-1、osm地图" tabindex="-1"><a class="header-anchor" href="#_2-1、osm地图"><span>2.1、OSM地图</span></a></h4><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapContent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapContent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>ts<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">let</span> <span class="token literal-property property">map</span><span class="token operator">:</span>Map<span class="token comment">//定义一个Map类型的变量，接收地图实例</span>
<span class="token comment">//Open Street Map地图层</span>
<span class="token keyword">const</span> openStreetMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//定义初始化地图实例函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">initMap</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span><span class="token string">&quot;mapContent&quot;</span><span class="token punctuation">,</span><span class="token comment">//地图容器</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">108.84</span><span class="token punctuation">,</span> <span class="token number">34.26</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//将坐标从经度/纬度转换为其他投影。</span>
      		<span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token comment">//缩放级别</span>
      		<span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">,</span> <span class="token comment">//设置投影坐标为自定义坐标EPSG:4548</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
        <span class="token literal-property property">controls</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//地图控件</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>openStreetMapLayer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加图层至地图实例</span>
<span class="token punctuation">}</span>
<span class="token comment">//在onMounted钩子函数上挂载初始化函数</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
	<span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token comment">/*为地图容器指定大小*/</span>
<span class="token selector">.mapContent</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100vh - 50px<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2、bing地图" tabindex="-1"><a class="header-anchor" href="#_2-2、bing地图"><span>2.2、Bing地图</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> bingMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    	source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">BingMaps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		key<span class="token operator">:</span> <span class="token string">&#39;AkjzA7OhS4MIBjutL21bkAop7dc41HSE0CNTR5c6HJy8JKc7U9U9RveWJrylD3XJ&#39;</span><span class="token punctuation">,</span>
		imagerySet<span class="token operator">:</span> <span class="token string">&#39;Road&#39;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-3、stamen地图" tabindex="-1"><a class="header-anchor" href="#_2-3、stamen地图"><span>2.3、Stamen地图</span></a></h4><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//Stamen地图层</span>
<span class="token keyword">const</span> stamenLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">Stamen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		layer<span class="token operator">:</span> <span class="token string">&#39;watercolor&#39;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码很简单，因为OpenLayers对这几个在线服务都做了很好的封装，只用简单的配置一下Source的构造参数就可以了。此处并没有列出每一个类的所有构造参数，但可以通过API文档查询了解。</p><h3 id="_3、xyz加载瓦片地图" tabindex="-1"><a class="header-anchor" href="#_3、xyz加载瓦片地图"><span>3、XYZ加载瓦片地图</span></a></h3><p>常用的瓦片地图是一个<strong>三维的</strong>概念，我们通常使用xyz这样的坐标来精确定位一张瓦片。通常z用于表示地图层级，而xy表示某个层级内的瓦片平面，x为横坐标，y为纵坐标，类似于数学上常见的笛卡尔坐标系。在这个瓦片平面上的每一个瓦片在横轴和纵轴上都有对应的坐标：x和y。</p><h4 id="_3-1、简单的瓦片地图" tabindex="-1"><a class="header-anchor" href="#_3-1、简单的瓦片地图"><span>3.1、简单的瓦片地图</span></a></h4><p>虽然现在大多数网页地图都使用的是瓦片地图，但还是有必要先介绍一下如何识别它。在浏览器中打开任意一个在线的网页地图，然后打开浏览器的开发者工具，再随意拖动、放大、缩小地图。之后在开发者工具里查看新发起的请求，是否有一些图片请求，查看请求返回的图片，是否为正在浏览的地图的一部分。如果是，则基本为瓦片地图。下面以百度地图为例，说明一下在线瓦片地图请求信息：</p><figure><img src="`+L+`" alt="image-20230714093233969" tabindex="0" loading="lazy"><figcaption>image-20230714093233969</figcaption></figure><p>在请求的url中，我们可以很明显地看到<strong>xyz</strong>这三个参数，这进一步说明了百度地图就是用了瓦片地图。如果你多分析一下现有的在线网页地图，基本都是瓦片地图。正因为如此，<strong>OpenLayers</strong>提供了<code>ol.source.XYZ</code>这种通用的<strong>Source</strong>来适应广大的在线瓦片地图数据源，具备很好的适用性。通常情况下，开发者想要加载不同的在线瓦片地图源，则只需要更改<code>ol.source.XYZ</code>的构造参数中url就可以了。</p><p>比如可以不用<code>ol.source.OSM</code>，而用<code>ol.source.XYZ</code>来加载<strong>Open Street Map</strong>地图，结果一样：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// Open Street Map 地图层</span>
<span class="token keyword">const</span> openStreetMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">XYZ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		url<span class="token operator">:</span> <span class="token string">&#39;http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png&#39;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>除了OSM可以这样加载外，还有很多其他的在线瓦片地图源也可以，比如<strong>高德地图</strong>：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 高德地图层</span>
<span class="token keyword">const</span> gaodeMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">XYZ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span><span class="token string">&#39;http://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;scale=1&amp;style=7&amp;x={x}&amp;y={y}&amp;z={z}&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如<strong>Yahoo地图</strong>：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// yahoo地图层</span>
<span class="token keyword">const</span> yahooMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token constant">XYZ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        tileSize<span class="token operator">:</span> <span class="token number">512</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span><span class="token string">&#39;https://{0-3}.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/{z}/{x}/{y}/512/png8?lg=ENG&amp;ppi=250&amp;token=TrLJuXVK62IQk0vuXFzaig%3D%3D&amp;requestid=yahoo.prod&amp;app_id=eAdkWGYRoc4RfxVo0Z4B&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>大同小异，非常简单。上面的三个例子，只有<strong>Yahoo地图</strong>的代码有点不一样：多了<strong>tileSize</strong>参数的设置。</p><p>默认情况下，<strong>tileSize为256</strong>，这也是现在绝大多数瓦片采用的大小。但<strong>Yahoo地图</strong>使用的是<strong>512</strong>，所以我们需要显示指定。</p><h4 id="_3-2、高德地图" tabindex="-1"><a class="header-anchor" href="#_3-2、高德地图"><span>3.2、高德地图</span></a></h4><p>高德新版的参数：</p><p>lang可以通过zh_cn设置中文，en设置英文；</p><p>size基本无作用；</p><p>scl设置标注还是底图，scl=1代表注记，scl=2代表底图（矢量或者影像）；</p><p>style设置影像和路网，style=6为影像图，style=7为矢量路网，style=8为影像路网。</p><p>总结之：</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7 为矢量图（含路网、含注记）</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=7 为矢量图（含路网，不含注记）</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=6 为影像底图（不含路网，不含注记）</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=6 为影像底图（不含路网、不含注记）</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=8 为影像路图（含路网，含注记）</p><p>http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=8 为影像路网（含路网，不含注记）</p><p>高德旧版可以通过style设置影像、矢量、路网。</p><p>总结之：</p><p>http://webst0{1-4}.is.autonavi.com/appmaptile?style=6&amp;x={x}&amp;y={y}&amp;z={z} 为影像底图（不含路网，不含注记）</p><p>http://webst0{1-4}.is.autonavi.com/appmaptile?style=7&amp;x={x}&amp;y={y}&amp;z={z} 为矢量地图（含路网，含注记）</p><p>http://webst0{1-4}.is.autonavi.com/appmaptile?style=8&amp;x={x}&amp;y={y}&amp;z={z} 为影像路网（含路网，含注记）</p><h4 id="_3-3、百度地图" tabindex="-1"><a class="header-anchor" href="#_3-3、百度地图"><span>3.3、百度地图</span></a></h4><p>上面这种简单方法并不适用于所有的在线瓦片地图，比如百度地图，上面这种方式就不生效了。</p><p>瓦片地图加载的整个过程：</p><p>瓦片地图加载的关键在于<strong>找对瓦片</strong>，但要找对瓦片，就得知道<strong>瓦片的坐标</strong>，而<strong>坐标又需要明确的坐标系</strong>。我们在坐标里说过，任何坐标都得有坐标系才有意义。在<strong>OpenLayer</strong>中，默认使用的瓦片地图的坐标系是如何定义的？</p><p>经分析可知，<strong>OpenLayer的瓦片坐标系的原点在左上角，向上为y轴正方向</strong>。具体到地图上来讲，地球经过投影，投影到一个平面上，平面最左边对应地球最西边，平面最上边对应地球最北边。<strong>原点就处于整个平面的左上角</strong>，即<strong>地球的西北角</strong>，从北向南为y轴负方向，从西向东为x轴正方向。理解这一点非常重要，因为并不是所有在线的瓦片地图都是采用这样的坐标系。用<strong>OpenLayers</strong>加载它们的时候，如果坐标系不同，计算出来的瓦片地址就获取不到对应的瓦片，为解决这个问题，我们必须要先对瓦片坐标进行转换。那么，具体该怎么实现转换？最详细明了的方式还是看实例，下面我们看一下加载百度地图的一种实现方式：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>     <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">//百度地图层</span>
        <span class="token keyword">var</span> baiduMapLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>XYZ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">tilePixelRatio</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token function-variable function">tileUrlFunction</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tileCoord</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">var</span> z <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> x <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> y <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
                    <span class="token comment">//计算当前层级下瓦片总数的一半，用于定位整个地图的中心点</span>
                    <span class="token keyword">var</span> halfTileNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> z <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//原点移到中心点后，计算xy方向上新的坐标位置</span>
                    <span class="token keyword">var</span> baiduX <span class="token operator">=</span> x <span class="token operator">-</span> halfTileNum<span class="token punctuation">;</span>
                    <span class="token keyword">var</span> baiduY <span class="token operator">=</span> y <span class="token operator">+</span> halfTileNum<span class="token punctuation">;</span>
 
                    <span class="token comment">//百度瓦片服务url将负数使用M前缀来标识</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>baiduX <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        baiduX <span class="token operator">=</span> <span class="token string">&#39;M&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span>baiduX<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>baiduY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        baiduY <span class="token operator">=</span> <span class="token string">&#39;M&#39;</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token punctuation">(</span>baiduY<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
 
                    <span class="token comment">//返回经过转换后，对应于百度在线瓦片的url</span>
                    <span class="token keyword">return</span> <span class="token string">&#39;http://online2.map.bdimg.com/onlinelabel/?qt=tile&amp;x=&#39;</span> <span class="token operator">+</span> baiduX <span class="token operator">+</span> <span class="token string">&#39;&amp;y=&#39;</span> <span class="token operator">+</span> baiduY <span class="token operator">+</span> <span class="token string">&#39;&amp;z=&#39;</span> <span class="token operator">+</span> z <span class="token operator">+</span> <span class="token string">&#39;&amp;styles=pl&amp;udt=20160321&amp;scaler=2&amp;p=0&#39;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">//创建地图</span>
        <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                baiduMapLayer
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token comment">//设置成都为地图中心</span>
                <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.06</span><span class="token punctuation">,</span> <span class="token number">30.67</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;baiduMap&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>和前面几个加载在线瓦片地图的例子不一样的地方在于，**没有设置url，而是设置了tileUrlFunction，这是一个获取瓦片url的函数。<strong>如果自定义这个函数，就可以</strong>实现不同坐标系之间的转换，从而返回在线地图服务对应瓦片的url。**通过代码可以看到，函数入参是一个瓦片坐标，然后进行一系列的转换，得到百度在线地图的瓦片地址。</p><p><strong>tileUrlFunction</strong>这个自定义函数的代码实现有可能看不懂，虽然知道在进行坐标转换，但并不知道为什么要这样实现。为了彻底弄明白代码，我们必须得把之前遗漏的一个重要环节补上：弄明白待加载的在线瓦片地图的坐标系。对百度在线瓦片坐标系进行简单分析发现，<strong>它是以某一个位置为原点，向右为x正方向，向上为y正方向的坐标系。进一步分析发现，原点应该在中心位置。<strong>为此，我们假设百度地图是以经纬度[0,0]为原点，在此基础上编写函数</strong>tileUrlFunction</strong>的实现。<strong>halfTileNum</strong>表示的是在当前缩放层级之下，总的瓦片个数的一半，意味着它就是中心位置。对于baiduX小于0的情况，百度使用了<strong>M</strong>来表示负号，所以要特殊处理一下。想必这下应该更加理解代码实现了。不同的在线瓦片地图的转换代码可能不同，需要根据对应的坐标系来确定。</p><p>但上面这个地图并不完美，因为我们设定的地图中心为成都，然而实际上显示的地图中心并不在成都。虽然无缝拼接，但位置偏差有点远。由此基本可以排除坐标转换的问题，看起来应该是<strong>OpenLayers的分辨率和百度在线瓦片地图使用的分辨率对不上</strong>。经过分析发现，确实如此，在网上也有很多分析文章可以查询。那么我们是否可以重新定义分辨率呢？答案是肯定的，我们可以使用<strong>ol.source.XYZ的父类</strong>来解决问题。</p><h4 id="_3-4、重新定义openlayers的瓦片坐标系" tabindex="-1"><a class="header-anchor" href="#_3-4、重新定义openlayers的瓦片坐标系"><span>3.4、重新定义OpenLayers的瓦片坐标系</span></a></h4><p>ol.source.TileImage作为ol.source.XYZ的父类，除了可以转换坐标之外，还具备更加强大的功能，修改分辨率（分辨率指屏幕上一个像素代表实际多少距离）。下面我们使用它来加载百度地图，这次是正确的，对应的代码：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;baiduMap2&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;width: 100%&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
 
    <span class="token comment">// 自定义分辨率和瓦片坐标系</span>
  <span class="token keyword">var</span> resolutions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> maxZoom <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
 
  <span class="token comment">// 计算百度使用的分辨率</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>maxZoom<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      resolutions<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> maxZoom<span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> tilegrid  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>tilegrid<span class="token punctuation">.</span><span class="token function">TileGrid</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      origin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// 设置原点坐标</span>
      resolutions<span class="token operator">:</span> resolutions    <span class="token comment">// 设置分辨率</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token comment">// 创建百度地图的数据源</span>
  <span class="token keyword">var</span> baiduSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">TileImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      projection<span class="token operator">:</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">,</span>    
      tileGrid<span class="token operator">:</span> tilegrid<span class="token punctuation">,</span>
      <span class="token function-variable function">tileUrlFunction</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>tileCoord<span class="token punctuation">,</span> pixelRatio<span class="token punctuation">,</span> proj<span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> z <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> x <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> y <span class="token operator">=</span> tileCoord<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 
          <span class="token comment">// 百度瓦片服务url将负数使用M前缀来标识</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              x <span class="token operator">=</span> <span class="token string">&#39;M&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>y<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              y <span class="token operator">=</span> <span class="token string">&#39;M&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
 
          <span class="token keyword">return</span> <span class="token string">&quot;http://online0.map.bdimg.com/onlinelabel/?qt=tile&amp;x=&quot;</span><span class="token operator">+</span>x<span class="token operator">+</span><span class="token string">&quot;&amp;y=&quot;</span><span class="token operator">+</span>y<span class="token operator">+</span><span class="token string">&quot;&amp;z=&quot;</span><span class="token operator">+</span>z<span class="token operator">+</span><span class="token string">&quot;&amp;styles=pl&amp;udt=20160426&amp;scaler=1&amp;p=0&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 百度地图层</span>
    <span class="token keyword">var</span> baiduMapLayer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span><span class="token function">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        source<span class="token operator">:</span> baiduSource
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 创建地图</span>
  <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        layers<span class="token operator">:</span> <span class="token punctuation">[</span>
            baiduMapLayer2
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 设置成都为地图中心</span>
            center<span class="token operator">:</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">104.06</span><span class="token punctuation">,</span> <span class="token number">30.67</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:3857&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            zoom<span class="token operator">:</span> <span class="token number">10</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        target<span class="token operator">:</span> <span class="token string">&#39;baiduMap2&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个代码同上面的代码相比，引入了<code>**ol.tilegrid.TileGrid**</code>，由名字可见，这是定义<strong>瓦片网格</strong>，其实就是瓦片坐标系，构造时需要设定原点，紧接着设置分辨率，其作用在于设定每一图层级的分辨率。</p><p>我们是否遗漏了坐标系的正向和负向的设定？默认情况下，从左向右为x正方向，从下向上为y轴正方向。这和我们数学上通常定义的笛卡尔坐标系是一样的，这一点需要记住。如代码所示，就可以重新定义OpenLayers的瓦片地图坐标系，这种方式的代码比上一种方式更加的可读和简洁,并且适用性更强。</p><h3 id="_4、静态地图" tabindex="-1"><a class="header-anchor" href="#_4、静态地图"><span>4、静态地图</span></a></h3><p>静态地图只没有被地理投影过的普通地图，例如：规划图、室内建筑图、校园地图等。会涉及到一些简单的定位、标注等。</p><p>openlayers中提供了对应的source类：<code>ol.source.ImageStatic</code></p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//地图设置中心，设置到成都，在本地离线地图offlineMapTiles刚好有一张zoom为4的成都瓦片</span>
<span class="token keyword">const</span> center <span class="token operator">=</span> olProj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">104.06667</span><span class="token punctuation">,</span> <span class="token number">30.66667</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;EPSG:4548&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//计算熊猫基地地图映射到地图上的范围，图片像素为1920*943，保持比例的情况下，把分辨率放大一些</span>
<span class="token keyword">const</span> extent<span class="token operator">=</span><span class="token punctuation">[</span>
  center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1920</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">943</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1920</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">943</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">ImageStatic</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span><span class="token string">&#39;/public/img/动物园图片.jpg&#39;</span><span class="token punctuation">,</span><span class="token comment">// 熊猫基地地图</span>
    imageExtent<span class="token operator">:</span>extent<span class="token punctuation">,</span> <span class="token comment">//映射到地图的范围</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+_+`" alt="image-20230714110422177" tabindex="0" loading="lazy"><figcaption>image-20230714110422177</figcaption></figure><p>其中关于</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> extent<span class="token operator">=</span><span class="token punctuation">[</span>
  center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1920</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">943</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1920</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
  center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">943</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这是一个简单计算。目的是设置图片显示在地图中心。</p><h3 id="_5、矢量地图" tabindex="-1"><a class="header-anchor" href="#_5、矢量地图"><span>5、矢量地图</span></a></h3><p>矢量地图的图形的元素是一些点、线、矩形、多边形、圆和弧线等等，它们都是通过数学公式计算获得的。由于矢量图形可通过公式计算获得，所以矢量图形文件体积一般较小。</p><p>矢量图形最大的优点是无论放大、缩小或旋转等图形都不会失真。矢量地图在地图项目中存在着大量的应用，是地图数据中非常重要的组成部分。</p><p>为了便于存储、传递、使用，矢量地图会按照一定的格式来表达，比如常见的GeoJSON、TopoJSON、GML、KML、shapefile等等。除了最后一个shapefile，其他几个格式的矢量地图OpenLayers都支持，使用起来也非常的简单，下面这个地图就加载了GeoJson格式的矢量地图。</p><figure><img src="`+M+`" alt="image-20230714111814666" tabindex="0" loading="lazy"><figcaption>image-20230714111814666</figcaption></figure><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//创建地图</span>
    <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token comment">//底图用Open Street Map地图</span>
            <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">//再加载一个geojson的矢量地图</span>
            <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;data/geojson/line-samples.geojson&#39;</span><span class="token punctuation">,</span>     <span class="token comment">// 矢量地图来源</span>
                    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>format<span class="token punctuation">.</span>GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment">//解析矢量地图的格式化类</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">72.980624870461128</span><span class="token punctuation">,</span> <span class="token number">48.161307640513321</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&#39;EPSG:4326&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载矢量图使用的<strong>source</strong>是<code>ol.source.Vector</code>，<strong>layer</strong>是<code>ol.layer.Vector</code>。 加载代码之所以这么简单，是因为<strong>OpenLayer</strong>内置了对应矢量地图格式的解析类，比如<code>ol.format.GeoJSON</code>。它们都位于包<code>ol.format</code>下面，可以在API官方文档中查询得到。如果是<strong>shapefile</strong>这种不支持的，则需要自己解析。解析后，矢量地图都会转换为对应于<strong>OpenLayers</strong>中的<strong>Feature</strong>。所以，当加载完成后，可以通过<code>source.getFeatures()</code>方法来<strong>获取所有的矢量图形</strong>。</p><p>需要注意坐标系，因为**.geojson文档**里用的是和当前地图用的不一样的坐标系。</p><p>对于不同格式的矢量地图，会有相应的一些不同用法，下面就针对一些大家经常会遇到的问题，给出相应的实例，用以说明。</p><h4 id="_5-1、获取加载后的所有feature" tabindex="-1"><a class="header-anchor" href="#_5-1、获取加载后的所有feature"><span>5.1、获取加载后的所有feature</span></a></h4><p>因为在加载矢量地图后，需要对矢量地图做一些简单的查询，分析等。但是经常会遇到获取不到加载后的feature的问题。原因就在于获取的时机不对，因为<strong>矢量地图是异步加载的</strong>。</p><figure><img src="`+P+`" alt="image-20230714112116258" tabindex="0" loading="lazy"><figcaption>image-20230714112116258</figcaption></figure><p>从图上可以看到，共有9个feature，在地图下方的统计数据也是9。下面看看代码是如何实现的：</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>矢量地图Feature总数： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
 
    <span class="token comment">//创建地图</span>
    <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
            <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">72.980624870461128</span><span class="token punctuation">,</span> <span class="token number">48.161307640513321</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
            <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&#39;EPSG:4326&#39;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">var</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;../data/geojson/line-samples.geojson&#39;</span><span class="token punctuation">,</span> 
            <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>format<span class="token punctuation">.</span>GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token comment">// 因为是异步加载，所以要采用事件监听的方式来判定是否加载完成</span>
    <span class="token keyword">var</span> listenerKey <span class="token operator">=</span> vectorLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&#39;ready&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 判定是否加载完成</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;count&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> vectorLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            vectorLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unByKey</span><span class="token punctuation">(</span>listenerKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注销监听器</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果在此处调用vectorLayer.getSource().getFeatures()是完全有可能获取不到任何Feature的，这是常犯错误</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于其中<code>vectorLayer.getSource().getState() === &#39;ready&#39;</code>，关于source.getState()的返回值是数据源的状态，有： **&#39;undefined&#39;、&#39;loading&#39;、&#39;ready&#39; 、&#39;error&#39;<strong>四种状态。只有在</strong>&#39;ready&#39;**状态时才能正确获取加载完成的所有feature。</p><h4 id="_5-2、矢量地图的坐标转换" tabindex="-1"><a class="header-anchor" href="#_5-2、矢量地图的坐标转换"><span>5.2、矢量地图的坐标转换</span></a></h4><p>矢量地图一般为EPSG：4326（WGS 84墨卡托投影坐标系），但是openlayers地图默认为EPSG：3857（WGS 84地理坐标系）。所以一般需要使用ol内置的地图格式解析器。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//WKT图层</span>
<span class="token comment">// const hnWKT = HNWKT();</span>
<span class="token keyword">const</span> wktFormat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">WKT</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//利用readFeature方法自定义转换每一个要素坐标投影。</span>
<span class="token keyword">const</span> wktFeature <span class="token operator">=</span> wktFormat<span class="token punctuation">.</span><span class="token function">readFeature</span><span class="token punctuation">(</span><span class="token constant">HKWKT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  dataProjection<span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
  featureProjection<span class="token operator">:</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wktVectorSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vectorsource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  features<span class="token operator">:</span> <span class="token punctuation">[</span>wktFeature<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wktMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> wktVectorSource<span class="token punctuation">,</span>
  style<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fill<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;rgba(255, 255, 255, 0.2)&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    stroke<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;#ab4bfe&quot;</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;WKT&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;WKT图层&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3、样式设置" tabindex="-1"><a class="header-anchor" href="#_5-3、样式设置"><span>5.3、样式设置</span></a></h4><p>对矢量元素进行样式设置，OpenLayers支持两种方式，一种是直接给feature设置样式，一种是给layer设置样式。系统默认优先考虑feature的样式，如果没有，则使用layer的样式，还有一种情况是layer也没有设置样式，则会采用系统默认的样式。</p><p>对于自带样式的矢量地图修改样式 ，比如<strong>KML格式</strong>的矢量地图，如果要修改样式，则相对比较麻烦。得分情况考虑：</p><ul><li><p>​ 一种是所有矢量地图都不使用自带的样式：</p></li><li><p>​ 一种是部分矢量地图不使用自带的样式。</p></li></ul><p>对于第一种情况，则相对比较简单一点，只需要把<code>ol.format.KML</code>的构造参数<code>extractStyles</code>设置为<strong>false</strong>即可，然后为layer设定自定义的样式。</p><p>对于第二种情况，则相对麻烦一些，必须要读取加载的所有<strong>feature</strong>，并进行过滤，对符合条件的<strong>feature</strong>重新设置样式。</p><h4 id="_5-4、数据解析类" tabindex="-1"><a class="header-anchor" href="#_5-4、数据解析类"><span>5.4、数据解析类</span></a></h4><p>数据源使用<strong>url + format</strong>方式加载矢量数据，不同的数据类型使用不同的数据解析类，如下所述：</p><ul><li><p>GeoJSON格式数据：使用<code>ol.format.GeoJSON</code>类进行解析。</p></li><li><p>KML格式数据：使用<code>ol.format.KML</code>类进行解析。</p></li><li><p>GPX格式数据：使用<code>ol.format.GPX</code>类进行解析。</p></li></ul><p>除了使用示例中的<strong>url+format</strong>设置矢量数据源的方式，还可以调用数据解析类<strong>format</strong>的<code>readFeatures</code>方法读取矢量要素集，<strong>通过features参数设置数据源</strong>。同时，也可以调用数据源对象的addFeature方法来加载单个矢量要素。</p><p><strong>解析器相关类的类结构图</strong>：</p><figure><img src="`+F+'" alt="image-20230714134751754" tabindex="0" loading="lazy"><figcaption>image-20230714134751754</figcaption></figure><h3 id="_6、地图服务" tabindex="-1"><a class="header-anchor" href="#_6、地图服务"><span>6、地图服务</span></a></h3><p>因为每次都是根据用户请求参数，随时绘制地图，图像反映数据的最新情况，且在服务器端绘制地图，因此该方式通常称为<strong>动态绘制地图服务</strong>。而切片地图方式只反映了生成地图切片时的数据状况。</p><p>动态绘制地图服务的缺点是在多用户并发请求时，服务器容易超负荷运行，即用户越多，响应越慢。</p><h4 id="_6-1、wms服务" tabindex="-1"><a class="header-anchor" href="#_6-1、wms服务"><span>6.1、WMS服务</span></a></h4><p>OGC（开发地理空间联盟）的**WMS（Web Map Service）**服务规范就是一种动态绘制地图服务的规范，许多WebGIS服务器实现了WMS规范，因此可以结合一些WebGIS服务器发布WMS服务，然后使用OpenLayers调用WMS服务在客户端呈现地图。目前比较流行的WebGIS服务器有GeoServer、ArcGIS Server等。</p><p>WMS服务主要支持以下操作：</p><ul><li>请求服务的元数据（GetCapabilities）</li><li>请求地图图像（GetMap）</li><li>请求关于地图要素的信息（GetFeatureInfo，可选）</li><li>请求图例（GetLegendGraphic，可选）</li><li>请求用户定义的样式（GetStyles，可选）</li></ul><p>作为基本WMS服务，必须至少支持GetCapabilities和GetMap操作，如果作为可查询WMS，则需要支持可选的GetFeatureInfo操作。</p><p>对于样式化图层描述符WMS服务，还有两种可选的操作，一个是请求图例符号操作，即GetLegendGraphic；第二个是请求用户定义的样式操作，即GetStyles。</p>',113),Y={href:"https://zhuanlan.zhihu.com/p/73973319",target:"_blank",rel:"noopener noreferrer"},K=p(`<p>值得一提的是，WMS主要是用于<strong>显示地图</strong>，而非要素信息查询。<strong>要素信息查询</strong>应该交给WFS服务来完成。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//WMS图层</span>
<span class="token keyword">const</span> wmsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ImageLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//params参数直接查看geoserver预览查看源码</span>
  source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ImageWMS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">&quot;/geoserver/Dome/wms&quot;</span><span class="token punctuation">,</span> <span class="token comment">//访问参数采用KVP</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token constant">FORMAT</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
      <span class="token constant">VERSION</span><span class="token operator">:</span> <span class="token string">&quot;1.1.1&quot;</span><span class="token punctuation">,</span>
      <span class="token constant">STYLES</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
      <span class="token constant">LAYERS</span><span class="token operator">:</span> <span class="token string">&quot;Dome:city_WH&quot;</span><span class="token punctuation">,</span>
      exceptions<span class="token operator">:</span> <span class="token string">&quot;application/vnd.ogc.se_inimage&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ratio<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    serverType<span class="token operator">:</span> <span class="token string">&quot;geoserver&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;WMS&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;WMS图层&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;ImageLayer&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2、wmts服务" tabindex="-1"><a class="header-anchor" href="#_6-2、wmts服务"><span>6.2、WMTS服务</span></a></h4><p><strong>WMTS</strong>，即<strong>Web地图瓦片服务（Web Map Tile Service）</strong>，由OGC（开放地理信息联盟）制定。根据WMTS标准，可以使我们轻松的访问瓦片数据。</p><p>WMTS提供了一种采用预定义地图瓦片发布数字地图服务的标准化解决方案，它最重要的特征是采用<strong>瓦片缓存技术缓解WebGIS服务器端数据处理的压力，提高前后端交互响应速度。</strong></p><p>**WMS（Web地图服务）**提供可定制地图的服务，是一个动态数据或用户定制地图（需结合SLD-Style Layer Descriptor）的理想解决方法。例如，可以在GeoServer中通过修改SLD样式文件来随时自定义地图样式：</p><figure><img src="`+C+'" alt="image-20230714141625197" tabindex="0" loading="lazy"><figcaption>image-20230714141625197</figcaption></figure><p>随时都可以修改，而且一修改在客户端就能实时渲染出变化。根本原因是<strong>WMS的地图数据并没有通过切片放置到硬盘中，它的地图数据是实时处理并传输到客户端的。</strong></p><p>而<strong>WMTS标准需要地图数据切片后放置在硬盘中，然后再调用数据传输到客户端。</strong></p><p><strong>WMTS</strong>牺牲了提供定制地图的灵活性，代之以通过提供静态数据（瓦片地图）来增强伸缩性，这些静态数据的范围框和比例尺被限定在<strong>瓦片坐标系</strong>中。这些固定的瓦片地图数据集使得对<strong>WMTS</strong>服务的实现可以使用一个仅简单返回已有文件的Web服务器即可，同时使得可以利用一些标准诸如分布式缓存的网络机制实现伸缩性。</p><p>WMTS服务支持<strong>RESTful</strong>和<strong>KVP</strong>访问，其接口包括：</p><ul><li>GetCapabilities —— 获取服务元数据，元数据描述该服务的功能和包含的信息</li><li>GetTile —— 获取地图瓦片</li><li>GetFeatureInfo（鸡肋功能，不常用） —— 通过在WMTS图层上指定一定的条件，返回指定的地图瓦片内容对应的要素信息</li></ul>',12),H={href:"https://zhuanlan.zhihu.com/p/81258050",target:"_blank",rel:"noopener noreferrer"},U={href:"https://openlayers.org/en/latest/examples/?q=WMTS",target:"_blank",rel:"noopener noreferrer"},Q=p(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">// 计算EPSG:3857矩阵集</span>
<span class="token keyword">const</span> projectionExtent <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;EPSG:3857&quot;</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">getExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span>projectionExtent <span class="token keyword">as</span> Extent<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> resolutions<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> matrixIds<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> z <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token operator">++</span>z<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  resolutions<span class="token punctuation">[</span>z<span class="token punctuation">]</span> <span class="token operator">=</span> size <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>
  matrixIds<span class="token punctuation">[</span>z<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;EPSG:3857:&quot;</span> <span class="token operator">+</span> z<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//WMTS图层</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;/geoserver/gwc/service/wmts?Request=GetCapabilities&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">WMTSCapabilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>capabilities<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">optionsFromCapabilities</span><span class="token punctuation">(</span>capabilities<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      layer<span class="token operator">:</span> <span class="token string">&quot;Dome:tiff_GX&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wmtsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">WMTS</span></span><span class="token punctuation">(</span>options <span class="token keyword">as</span> Options<span class="token punctuation">)</span><span class="token punctuation">,</span>
      properties<span class="token operator">:</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">&quot;WMTS&quot;</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;WMTS图层&quot;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>wmtsMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载WMTS服务数据首先要<strong>基于WMTS服务的基地址查询对应的元数据</strong>，然后根据元数据文档里写的参数去请求瓦片数据就好了。</p><h4 id="_6-3、wfs服务" tabindex="-1"><a class="header-anchor" href="#_6-3、wfs服务"><span>6.3、WFS服务</span></a></h4><p>OGC的WMS和WMTS规范都是<strong>有关空间数据显示的标准</strong>，而WFS（Web Feature Service）则<strong>允许用户在分布式的环境下通过HTTP对空间数据进行增、删、改、查</strong>。</p><p>具体来说，WebGIS服务器除了能够返回一张张地图图像之外，还可以返回绘制该地图图像所使用的真实地理数据。用户利用这些传输到客户端的地理数据可以进行数据渲染可视化、空间分析等操作。而前后端的这种数据交互就是基于WFS规范的。</p><p>那么也就能很清楚的说明WMS与WFS之间的区别了。**WMS是由服务器将地图图像发送给客户端，而WFS是服务器将矢量数据发送给客户端。**也就是在使用WMS时地图由服务器绘制，在使用WFS时地图由客户端绘制。另外最最重要的，使用WFS可以对WebGIS服务器中的地理数据（存储在空间数据库中）直接进行增、删、改、查。</p><p>WFS服务一般支持如下功能：</p><ul><li>GetCapabilities —— 获取WFS服务的元数据（介绍服务中的要素类和支持的操作）</li><li>DescribeFeatureType —— 获取WFS服务支持的要素类的定义（要素类的元数据，比如要素包含哪些字段）</li><li>GetFeature —— 获取要素数据</li><li>GetGmlObject —— 通过XLink获取GML对象</li><li>Transaction —— 创建、更新、删除要素数据的事务操作</li><li>LockFeature —— 在事务过程中锁定要素</li></ul><p>实际中，WebGIS服务器针对这些功能并不是必须全部实现，而是实现全部或部分。</p><p>因此，根据依据这些功能的支持与否，可以将WFS分为3类：</p><ul><li>Basic WFS —— 必须支持GetCapabilities、DescribeFeature Type、GetFeature功能</li><li>XLink WFS —— 必须在Basic WFS基础上加上GetGmlObject操作</li><li>Transaction WFS —— 也称为WFS-T，必须在Basic WFS基础上加上Transaction功能以及支持编辑数据，另外也可以加上GetGmlObject或LockFeature功能</li></ul>`,11),$={href:"https://zhuanlan.zhihu.com/p/83473651",target:"_blank",rel:"noopener noreferrer"},nn=p(`<div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token comment">//WFS的GML2格式数据加载</span>
<span class="token keyword">const</span> wfsVectoreSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vectorsource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token operator">:</span> <span class="token string">&quot;/geoserver/Dome/ows?service=WFS&amp;version=1.0.0&amp;request=GetFeature&amp;typeName=Dome%3Acity_GZ&amp;outputFormat=text%2Fxml%3B%20subtype%3Dgml%2F2.1.2&quot;</span><span class="token punctuation">,</span>
  format<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">GML2</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//指定格式</span>
  strategy<span class="token operator">:</span> bbox<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> wfsMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//将GML2数据源传入矢量图层</span>
  source<span class="token operator">:</span> wfsVectoreSource<span class="token punctuation">,</span>

  style<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    image<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      radius<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      fill<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        color<span class="token operator">:</span> <span class="token string">&quot;#3885ff&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    stroke<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      color<span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span>
      width<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  visible<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">&quot;WFS&quot;</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">&quot;WFS图层&quot;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此处碰到问题：</p><blockquote><p>在openlayers中对GML数据进行投影转换失效，最后是在GeoServer中发布时设置坐标系才正确投影。？？？？</p></blockquote><h2 id="四、交互" tabindex="-1"><a class="header-anchor" href="#四、交互"><span>四、交互</span></a></h2><h3 id="_4-1、绘制图形" tabindex="-1"><a class="header-anchor" href="#_4-1、绘制图形"><span>4.1、绘制图形</span></a></h3><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectValue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectTypeChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span>
        <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in options<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.value<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.value<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.label<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stopInteraction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>完成绘制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>backoutInteraction<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>撤销绘制<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-dialog</span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>savePopupState<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>20%<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">destroy-on-close</span>
      <span class="token attr-name">draggable</span>
    <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>存到：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>layerName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectLayerName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span>
          <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, index) in vectorLayerArr<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.layerTitle<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.layerName<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>或<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>新建：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-input</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 159px</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>newLayerName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-input</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>saveFeature(selectLayerName)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>保存<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-dialog</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&quot;@/utils/bus.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Draw<span class="token punctuation">,</span> Snap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token literal-property property">mapCopy</span><span class="token operator">:</span> Map<span class="token punctuation">;</span>
<span class="token comment">//监听map数据</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mapToChecked&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> Map</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 传参由回调函数中的形参接受</span>
  mapCopy <span class="token operator">=</span> res<span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>drawVectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//定义一个类，接收图层属性</span>
<span class="token keyword">class</span> <span class="token class-name">VectorLayerAtt</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">layerName</span><span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
  <span class="token literal-property property">layerTitle</span><span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">;</span>

  <span class="token comment">//构造函数</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layerName <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>layerTitle <span class="token operator">=</span> title<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token literal-property property">draw</span><span class="token operator">:</span> Draw<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">snap</span><span class="token operator">:</span> Snap<span class="token punctuation">;</span>
<span class="token keyword">const</span> newLayerName <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//新建的图层名称</span>
<span class="token keyword">const</span> <span class="token literal-property property">vectorLayerArr</span><span class="token operator">:</span> VectorLayerAtt<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//矢量图层数组</span>
<span class="token keyword">const</span> savePopupState <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//保存弹窗的状态</span>
<span class="token keyword">const</span> selectValue <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//选中的值</span>
<span class="token keyword">const</span> selectLayerName <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//选中的图层的名称</span>
type SelectOption <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token literal-property property">label</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token literal-property property">options</span><span class="token operator">:</span> SelectOption<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">//绘制要素的类型</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;点&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;LineString&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;线&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;Polygon&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;面&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;MultiPoint&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&quot;多点&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> drawVectorSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//绘制要素的目标数据源</span>
<span class="token keyword">const</span> drawVectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//绘制要素的目标图层</span>
  <span class="token literal-property property">source</span><span class="token operator">:</span> drawVectorSource<span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;fill-color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rgba(255, 255, 255, 0.2)&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;stroke-color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#ffcc33&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;stroke-width&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-radius&quot;</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-fill-color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#ffcc33&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;drawLayer&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;临时绘画图层&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 添加绘制几何要素交互</span>
<span class="token keyword">const</span> <span class="token function-variable function">drawInteraction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> selectedtype <span class="token operator">=</span> selectValue<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">//接收选中的类型</span>
  <span class="token comment">//创建Draw对象</span>
  draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> drawVectorSource<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> selectedtype <span class="token keyword">as</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;ol/geom/Geometry.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Type<span class="token punctuation">,</span> <span class="token comment">//类型断言</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  draw<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Draw&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  snap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Snap</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">source</span><span class="token operator">:</span> drawVectorSource <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建Snap控件对象</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加draw、snap交互对象</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//监听选择框发生改变</span>
<span class="token keyword">const</span> <span class="token function-variable function">selectTypeChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">drawInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加交互</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//完成绘制</span>
<span class="token keyword">const</span> <span class="token function-variable function">stopInteraction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  savePopupState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//将弹窗状态设置为开启</span>
  <span class="token comment">//获取所有矢量图层</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vectorLayerArr<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vectorLayerArr<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//如果是矢量图层且不是临时图层，创建矢量图层属性对象</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">getAllLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;VectorLayer&quot;</span> <span class="token operator">&amp;&amp;</span>
      item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;drawLayer&quot;</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      vectorLayerArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">VectorLayerAtt</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//移除绘制交互</span>
  selectValue<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//置空选择框</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//保存要素至图层</span>
<span class="token keyword">const</span> <span class="token function-variable function">saveFeature</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">layerName</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//如果输入框内容为空</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>newLayerName<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mapCopy<span class="token punctuation">.</span><span class="token function">getAllLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//循环查找选中的图层</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> layerName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//获取图层的source断言类VectorSource类型</span>
        <span class="token keyword">const</span> source <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> VectorSource<span class="token punctuation">;</span>
        <span class="token comment">//将临时绘制图层上的要素添加至选中的矢量图层</span>
        source<span class="token punctuation">.</span><span class="token function">addFeatures</span><span class="token punctuation">(</span>drawVectorSource<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//重新指定加载的数据源</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">nameToLayer</span><span class="token punctuation">(</span>newLayerName<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//根据输入框的内容创建图层</span>
  <span class="token punctuation">}</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;保存成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  savePopupState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//关闭保存弹窗</span>
  drawVectorSource<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清空临时绘制图层</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//根据名称创建新图层</span>
<span class="token keyword">const</span> <span class="token function-variable function">nameToLayer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">layername</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//根据名称创建新的VectorLayer</span>
  <span class="token keyword">const</span> newVectorSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">features</span><span class="token operator">:</span> drawVectorSource<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//数据源绑定为临时绘制图层的getfeatures</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> newVectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> newVectorSource<span class="token punctuation">,</span>
    <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> layername<span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> layername<span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>newVectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//撤销绘制</span>
<span class="token keyword">const</span> <span class="token function-variable function">backoutInteraction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//removeLastPoint对Point和MultiPoint无效</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>selectValue<span class="token punctuation">.</span>value <span class="token operator">!=</span> <span class="token string">&quot;Point&quot;</span> <span class="token operator">&amp;&amp;</span> selectValue<span class="token punctuation">.</span>value <span class="token operator">!=</span> <span class="token string">&quot;MultiPoint&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    draw<span class="token operator">?.</span><span class="token function">removeLastPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过移除正在绘制的对象的最后一个点实现撤销</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取绘画源上的所有要素，getFeatures()只是以随机顺序获取源上当前要素的快照。返回的数组是一个副本，要素是对源中要素的引用。</span>
    <span class="token keyword">const</span> drawFeatures <span class="token operator">=</span> drawVectorSource<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> length <span class="token operator">=</span> drawFeatures<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    drawVectorSource<span class="token punctuation">.</span><span class="token function">removeFeature</span><span class="token punctuation">(</span>drawFeatures<span class="token punctuation">[</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//删除最后一个要素</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.selectDiv</span> <span class="token punctuation">{</span>
  <span class="token comment">/* width: px; */</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">:deep(.el-button)</span> <span class="token punctuation">{</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2、编辑图形" tabindex="-1"><a class="header-anchor" href="#_4-2、编辑图形"><span>4.2、编辑图形</span></a></h3><p>除了能够交互式地绘制几何图形，OpenLayers还支持我们编辑已经绘制的几何图形。</p><p><strong>ol.interaction.Modify</strong>类封装了编辑图形的功能，只要将它初始化作为交互控件加入Map对象，就可以对几何图形进行动态编辑。</p><div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>编辑图形<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../v5.3.0/css/ol.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../v5.3.0/build/ol.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>Geometry type <span class="token entity named-entity" title=" ">&amp;nbsp;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Point<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Point<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LineString<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>LineString<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Polygon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Polygon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Circle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Circle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">// 矢量地图源</span>
        <span class="token keyword">let</span> vectorSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 矢量地图</span>
        <span class="token keyword">let</span> vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Vector</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> vectorSource
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// 初始化地图</span>
        <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;map&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                vectorLayer
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">5</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">// 创建一个Modify控件，指定source可以对哪些地图源进行图形编辑。</span>
        <span class="token keyword">let</span> modify <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Modify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> vectorSource
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将Modify控件加入到Map对象中</span>
        map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>modify<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">let</span> draw<span class="token punctuation">,</span> snap<span class="token punctuation">;</span>
        <span class="token keyword">let</span> typeSelect <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token keyword">function</span> <span class="token function">addInteractions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 创建一个Draw控件，并加入到Map对象中</span>
            draw <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">source</span><span class="token operator">:</span> vectorSource<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> typeSelect<span class="token punctuation">.</span>value
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
            <span class="token comment">// 创建一个Snap控件，并加入到Map对象中，开启捕捉</span>
            snap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>interaction<span class="token punctuation">.</span>Snap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">source</span><span class="token operator">:</span> vectorSource
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        typeSelect<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 移除Draw控件和Snap控件</span>
            map<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>snap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">addInteractions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token function">addInteractions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3、查询图形" tabindex="-1"><a class="header-anchor" href="#_4-3、查询图形"><span>4.3、查询图形</span></a></h3><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;searchDiv&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>input
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;searchInput&quot;</span>
      v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;searchTerm&quot;</span>
      placeholder<span class="token operator">=</span><span class="token string">&quot;请输入关键字&quot;</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dataButtonSearch&quot;</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token operator">=</span><span class="token string">&quot;searchFeatures&quot;</span><span class="token operator">&gt;</span>查询<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>button <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dataButtonClear&quot;</span> <span class="token decorator"><span class="token at operator">@</span><span class="token function">click</span></span><span class="token operator">=</span><span class="token string">&quot;clearFeatures&quot;</span><span class="token operator">&gt;</span>清除<span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Ref<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&quot;@/utils/bus.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Fill <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Geometry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/geom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Feature <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mapCopy<span class="token operator">:</span> Map<span class="token punctuation">;</span>
<span class="token comment">//监听map数据</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mapToChecked&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>res<span class="token operator">:</span> Map<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 传参由回调函数中的形参接受</span>
  mapCopy <span class="token operator">=</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> searchTerm<span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//搜索框的关键字</span>
<span class="token keyword">let</span> featuresList<span class="token operator">:</span> Feature<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> selectedFeaturesList<span class="token operator">:</span> Feature<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//定义一个数组用于接收查询搜索到的要素</span>

<span class="token comment">//属性模糊查询</span>
<span class="token keyword">const</span> <span class="token function-variable function">searchFeatures</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>searchTerm<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//输入关键字不为空</span>
    selectedFeaturesList<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//初始化匹配选中的要素的数组</span>
    <span class="token keyword">const</span> geojsonSource<span class="token operator">:</span> VectorSource<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;</span> <span class="token operator">=</span> mapCopy
      <span class="token punctuation">.</span><span class="token function">getAllLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      <span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> VectorSource<span class="token punctuation">;</span>
    featuresList <span class="token operator">=</span> geojsonSource<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取矢量图层中GeoJSON的要素</span>
    <span class="token keyword">const</span> regex<span class="token operator">:</span> RegExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>searchTerm<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">&quot;i&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建正则表达式</span>
    featuresList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//对要素进行遍历</span>
      <span class="token keyword">const</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>district<span class="token punctuation">;</span> <span class="token comment">//接收要素名称</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>regex<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        selectedFeaturesList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将要素添加进要素数组</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">drawFeatures</span><span class="token punctuation">(</span>selectedFeaturesList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用绘制要素函数</span>
    searchTerm<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">//置空关键字</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 绘制选择</span>
<span class="token keyword">let</span> selectedVectorLayer<span class="token operator">:</span> VectorLayer<span class="token operator">&lt;</span>VectorSource<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span> <span class="token comment">//创建一个VectorLayer变量</span>
<span class="token keyword">const</span> <span class="token function-variable function">drawFeatures</span> <span class="token operator">=</span> <span class="token punctuation">(</span>list<span class="token operator">:</span> Feature<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//传入的要素数组不能为空</span>
    selectedVectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        features<span class="token operator">:</span> list<span class="token punctuation">,</span> <span class="token comment">//使用传入的要素数组</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      style<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//创建选中样式</span>
        fill<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          color<span class="token operator">:</span> <span class="token string">&quot;rgba(170, 198, 238)&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        stroke<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          color<span class="token operator">:</span> <span class="token string">&quot;#ff0000&quot;</span><span class="token punctuation">,</span>
          width<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      properties<span class="token operator">:</span> <span class="token punctuation">{</span>
        title<span class="token operator">:</span> <span class="token string">&quot;selectedLayer&quot;</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">&quot;选择图层&quot;</span><span class="token punctuation">,</span>
        type<span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mapCopy<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>selectedVectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将选中要素创建的图层添加进map</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//清除选择</span>
<span class="token keyword">const</span> <span class="token function-variable function">clearFeatures</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span>selectedVectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//利用removeLayer移除选中的图层</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>searchDiv <span class="token punctuation">{</span>
  display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
  margin<span class="token operator">-</span>right<span class="token operator">:</span> 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>dataButton<span class="token punctuation">,</span>
<span class="token punctuation">.</span>dataButtonSearch<span class="token punctuation">,</span>
<span class="token punctuation">.</span>dataButtonClear<span class="token punctuation">,</span>
<span class="token punctuation">.</span>searchInput <span class="token punctuation">{</span>
  margin<span class="token operator">:</span> 0px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">.</span>el<span class="token operator">-</span>button<span class="token operator">+</span><span class="token punctuation">.</span>el<span class="token operator">-</span>button<span class="token punctuation">{</span>
  margin<span class="token operator">:</span> 0px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4、框选图形" tabindex="-1"><a class="header-anchor" href="#_4-4、框选图形"><span>4.4、框选图形</span></a></h3><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> Select <span class="token keyword">from</span> <span class="token string">&#39;ol/interaction/Select.js&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>用于选择矢量特征的交互。默认情况下，所选要素为 样式不同，因此此交互可用于视觉突出显示， 以及为其他操作选择功能，例如修改或 输出。</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> DragBox <span class="token keyword">from</span> <span class="token string">&#39;ol/interaction/DragBox.js&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,16),sn={href:"https://openlayers.org/en/latest/apidoc/module-ol_events_condition.html",target:"_blank",rel:"noopener noreferrer"},an=n("code",null,"ol/events/condition",-1),tn=p(`<div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>addLayer()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加图层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removeLayer()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>移除图层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>addInteraction()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加交互<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removeInteraction()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>移除交互<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token string">&quot;ol/ol.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Map <span class="token keyword">from</span> <span class="token string">&quot;ol/Map&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> View <span class="token keyword">from</span> <span class="token string">&quot;ol/View&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">OSM</span><span class="token punctuation">,</span> Vector <span class="token keyword">as</span> VectorSource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defaults <span class="token keyword">as</span> defaultControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/control&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ZoomSlider <span class="token keyword">from</span> <span class="token string">&quot;ol/control/ZoomSlider&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Select <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction/Select&quot;</span><span class="token punctuation">;</span><span class="token comment">//</span>
<span class="token keyword">import</span> DragBox <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction/DragBox&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> platformModifierKeyOnly <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/events/condition&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      <span class="token literal-property property">select</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dragBox</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">vectorSource</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">vectorLayer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">selectedFeatures</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>vectorLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vectorSource<span class="token punctuation">,</span>
        <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">removeLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vectorLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">addInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>select <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>dragBox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DragBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">condition</span><span class="token operator">:</span> platformModifierKeyOnly <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dragBox<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//在拖动框结束时触发。</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dragBox<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;boxend&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> extent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dragBox<span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//forEachFeatureIntersectingExtent:遍历几何与所提供范围相交的所有要素， 使用每个功能调用回调。如果回调返回“真实” 值，迭代将停止，函数将返回相同的值。</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>vectorSource<span class="token punctuation">.</span><span class="token function">forEachFeatureIntersectingExtent</span><span class="token punctuation">(</span>
          extent<span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//拖动框启动时触发。</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dragBox<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;boxstart&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">removeInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dragBox<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
 
    <span class="token comment">// 初始化地图</span>
    <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">115</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">visible</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;OSM&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> vectorSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;sichuan.json&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>vectorSource <span class="token operator">=</span> vectorSource<span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>layer<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> view<span class="token punctuation">,</span>
        <span class="token literal-property property">controls</span><span class="token operator">:</span> <span class="token function">defaultControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">ZoomSlider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#map</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+O+`" alt="添加交互" tabindex="0" loading="lazy"><figcaption>添加交互</figcaption></figure><p>如果要设置点击多选的效果，需要设置select对象的属性：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code>multi<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
condition<span class="token operator">:</span> click<span class="token punctuation">,</span> <span class="token comment">//单击选择。点击空白处，会取消选择</span>
toggleCondition<span class="token operator">:</span> click<span class="token punctuation">,</span><span class="token comment">//点击空白处，不会取消选择</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将上述代码进行更改：</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> click <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/events/condition&quot;</span><span class="token punctuation">;</span>

<span class="token function">addInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>select <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span> condition<span class="token operator">:</span> click<span class="token punctuation">,</span> toggleCondition<span class="token operator">:</span> click <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">.</span><span class="token function">getFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">removeInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>selectedFeatures<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>select<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+G+`" alt="多选" tabindex="0" loading="lazy"><figcaption>多选</figcaption></figure><h3 id="_4-5、测量与定位" tabindex="-1"><a class="header-anchor" href="#_4-5、测量与定位"><span>4.5、测量与定位</span></a></h3><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>measureDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button-group</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span> 10px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beginMeasure<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>大地线测量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stopMeasure<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>停止测量<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button-group</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Feature<span class="token punctuation">,</span> Map<span class="token punctuation">,</span> Overlay <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&quot;@/utils/bus.ts&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Geometry<span class="token punctuation">,</span> LineString<span class="token punctuation">,</span> Point <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/geom&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Draw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> turf <span class="token keyword">from</span> <span class="token string">&quot;@turf/turf&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Coordinate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/coordinate&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> unByKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/Observable&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EventsKey <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/events&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> transform <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/proj&quot;</span><span class="token punctuation">;</span>

<span class="token comment">//监听获取map数据</span>
<span class="token keyword">let</span> <span class="token literal-property property">mapCopy</span><span class="token operator">:</span> Map<span class="token punctuation">;</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mapToChecked&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> Map</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 传参由回调函数中的形参接受</span>
  mapCopy <span class="token operator">=</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">drawLine</span><span class="token operator">:</span> Draw<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">drawGeometry</span><span class="token operator">:</span> LineString<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">drawFeature</span><span class="token operator">:</span> Feature<span class="token operator">&lt;</span>Geometry<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//定义一个全局获取绘制的要素</span>
<span class="token keyword">let</span> <span class="token literal-property property">toolTipElement</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span> <span class="token comment">//提示信息dom元素</span>
<span class="token keyword">let</span> <span class="token literal-property property">toolTip</span><span class="token operator">:</span> Overlay<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">distancePopupElement</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span> <span class="token comment">//距离弹窗dom元素</span>
<span class="token keyword">let</span> <span class="token literal-property property">distancePopup</span><span class="token operator">:</span> Overlay<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">listener</span><span class="token operator">:</span> EventsKey <span class="token operator">|</span> EventsKey<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//接收地图监听</span>
<span class="token comment">//开始测量</span>
<span class="token keyword">const</span> <span class="token function-variable function">beginMeasure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//创建一个矢量图层接收绘制的多线段</span>
  <span class="token keyword">const</span> lineSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lineLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> lineSource<span class="token punctuation">,</span>
    <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;lineLayer&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;测量图层&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VectorLayer&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//将矢量图层加载到地图实例</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>lineLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//创建一个Draw对象，绘制距离线段</span>
  drawLine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Draw</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> lineSource<span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;LineString&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  drawLine<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Draw&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addInteraction</span><span class="token punctuation">(</span>drawLine<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//创建toolTipElement</span>
  <span class="token function">creatToolTip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//创建距离弹窗</span>
  <span class="token function">createDistancePopup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//监听地图的鼠标移动事件，设置提示信息弹窗</span>
  listener <span class="token operator">=</span> mapCopy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> helpMsg <span class="token operator">=</span> <span class="token string">&quot;点击开始测量&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>drawFeature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      helpMsg <span class="token operator">=</span> <span class="token string">&quot;双击结束测量&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    toolTipElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> helpMsg<span class="token punctuation">;</span> <span class="token comment">//设置提示文字</span>
    toolTip<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>evt<span class="token punctuation">.</span>coordinate<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置提示位置跟着鼠标走</span>
    toolTipElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示提示框</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//监听开始绘制事件</span>
  drawLine<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;drawstart&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取绘制的要素</span>
    drawFeature <span class="token operator">=</span> evt<span class="token punctuation">.</span>feature<span class="token punctuation">;</span> <span class="token comment">//多线段</span>
    <span class="token comment">//监听几何变化事件</span>
    drawFeature<span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">//获取绘制的几何对象</span>
      drawGeometry <span class="token operator">=</span> evt<span class="token punctuation">.</span>target <span class="token keyword">as</span> LineString<span class="token punctuation">;</span>
      <span class="token comment">//获取多线段的点的坐标数组长度</span>
      <span class="token keyword">const</span> length <span class="token operator">=</span> drawGeometry<span class="token punctuation">.</span><span class="token function">getCoordinates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token comment">//获取多线段上最后一个点坐标</span>
      <span class="token keyword">const</span> <span class="token literal-property property">bottomCoord</span><span class="token operator">:</span> Coordinate <span class="token operator">=</span> drawGeometry<span class="token punctuation">.</span><span class="token function">getLastCoordinate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//计算多线段的长度,点的坐标为4548坐标系，需要转换到4326地理坐标系</span>
      <span class="token keyword">const</span> <span class="token literal-property property">lineCoordArr</span><span class="token operator">:</span> Coordinate<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      drawGeometry<span class="token punctuation">.</span><span class="token function">getCoordinates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">coord</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        lineCoordArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">transform</span><span class="token punctuation">(</span>coord<span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> line <span class="token operator">=</span> turf<span class="token punctuation">.</span><span class="token function">lineString</span><span class="token punctuation">(</span>lineCoordArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> distance <span class="token operator">=</span> turf<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">units</span><span class="token operator">:</span> <span class="token string">&quot;kilometers&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//将计算距离结果加载到提示框上</span>
      distancePopupElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>distance<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> km</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span> <span class="token comment">//对距离保留两位小数</span>
      distancePopup<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>bottomCoord<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置距离弹窗位置</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//监听双击绘制完成事件</span>
  drawLine<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;drawend&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    distancePopupElement<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;toolTip distancePopupEnd&quot;</span><span class="token punctuation">;</span>
    distancePopup<span class="token punctuation">.</span><span class="token function">setOffset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    drawFeature <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    toolTipElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;hidden&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//创建toolTipElement</span>
<span class="token keyword">const</span> <span class="token function-variable function">creatToolTip</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>toolTipElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//如果已经存在就先初始化</span>
    toolTipElement<span class="token punctuation">.</span>parentNode<span class="token operator">?.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>toolTipElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//创建dom元素--提示信息</span>
  toolTipElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  toolTipElement<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;toolTip hidden&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">//创建Overlay弹窗</span>
  toolTip <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Overlay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> toolTipElement<span class="token punctuation">,</span>
    <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">positioning</span><span class="token operator">:</span> <span class="token string">&quot;center-left&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//添加Overlay</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>toolTip<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//创建dom元素--距离弹窗</span>
<span class="token keyword">const</span> <span class="token function-variable function">createDistancePopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>distancePopupElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    distancePopupElement<span class="token punctuation">.</span>parentNode<span class="token operator">?.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>distancePopupElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  distancePopupElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  distancePopupElement<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;toolTip distancePopupStart&quot;</span><span class="token punctuation">;</span>
  distancePopup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Overlay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> distancePopupElement<span class="token punctuation">,</span>
    <span class="token literal-property property">offset</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">positioning</span><span class="token operator">:</span> <span class="token string">&quot;bottom-center&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">stopEvent</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">insertFirst</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>distancePopup<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//停止测量</span>
<span class="token keyword">const</span> <span class="token function-variable function">stopMeasure</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//如果draw为空不执行删除，防止删除了默认交互</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeInteraction</span><span class="token punctuation">(</span>drawLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">removeOverlay</span><span class="token punctuation">(</span>toolTip<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭信息弹窗</span>
  <span class="token function">unByKey</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//移除监听</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.measureDiv</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.hidden</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.toolTip</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 4px 8px<span class="token punctuation">;</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0.7<span class="token punctuation">;</span>
  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">cursor</span><span class="token punctuation">:</span> default<span class="token punctuation">;</span>
  <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.distancePopupStart</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.distancePopupEnd</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> #ffcc33<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid white<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.distancePopupStart:before,
.distancePopupEnd:before</span> <span class="token punctuation">{</span>
  <span class="token property">border-top</span><span class="token punctuation">:</span> 6px solid <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">border-right</span><span class="token punctuation">:</span> 6px solid transparent<span class="token punctuation">;</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> 6px solid transparent<span class="token punctuation">;</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> -6px<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> -7px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.distancePopupEnd:before</span> <span class="token punctuation">{</span>
  <span class="token property">border-top-color</span><span class="token punctuation">:</span> #ffcc33<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6、弹窗" tabindex="-1"><a class="header-anchor" href="#_4-6、弹窗"><span>4.6、弹窗</span></a></h3><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>olPopup<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectState<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popupCloser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>olPopupCloser<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removePopup<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>popupContent<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>featureAmount &gt; -1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>当前坐标:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ lonAndLat }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>featureAmount &gt; 0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>矢量类型:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ type[layerIndex] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>图层名称:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ name[layerIndex] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>featureAmount &gt; 1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changePopup<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">&gt;</span></span>切换<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span>
        <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Feature<span class="token punctuation">,</span> Map <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toLonLat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/proj&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Overlay <span class="token keyword">from</span> <span class="token string">&quot;ol/Overlay.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">&quot;@/utils/bus.ts&quot;</span><span class="token punctuation">;</span> <span class="token comment">//定义声明文件再引入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Coordinate<span class="token punctuation">,</span> toStringHDMS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/coordinate&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FeatureLike <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/Feature&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Pixel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/pixel&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token literal-property property">mapCopy</span><span class="token operator">:</span> Map<span class="token punctuation">;</span>

<span class="token keyword">let</span> <span class="token literal-property property">popupContainer</span><span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token literal-property property">popup</span><span class="token operator">:</span> Overlay<span class="token punctuation">;</span>
<span class="token keyword">let</span> lonAndLat <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//经纬度</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//图层名称</span>
<span class="token keyword">const</span> type <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//矢量类型</span>
<span class="token keyword">const</span> selectState <span class="token operator">=</span> ref<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//弹窗状态</span>
<span class="token keyword">let</span> featureAmount <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//选中矢量要素个数</span>
<span class="token keyword">let</span> layerIndex <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//图层显示索引</span>

<span class="token comment">// 添加弹窗</span>
<span class="token keyword">const</span> <span class="token function-variable function">addPopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">clickCrd</span><span class="token operator">:</span> Coordinate<span class="token punctuation">,</span> <span class="token literal-property property">clickPixel</span><span class="token operator">:</span> Pixel</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//获取弹出框DOM</span>
  popupContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;popup&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>
  <span class="token comment">//创建弹出层并绑定DOM</span>
  popup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Overlay</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> popupContainer <span class="token keyword">as</span> HTMLElement<span class="token punctuation">,</span>
    <span class="token literal-property property">autoPan</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">animation</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  lonAndLat<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">toStringHDMS</span><span class="token punctuation">(</span><span class="token function">toLonLat</span><span class="token punctuation">(</span>clickCrd<span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4548&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//转换为经纬度坐标</span>
  <span class="token comment">// 判断点击位置的要素</span>
  <span class="token keyword">let</span> <span class="token literal-property property">featuresVector</span><span class="token operator">:</span> Feature<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">forEachFeatureAtPixel</span><span class="token punctuation">(</span>clickPixel<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">f</span><span class="token operator">:</span> FeatureLike</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    featuresVector<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>f <span class="token keyword">as</span> Feature<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  featureAmount<span class="token punctuation">.</span>value <span class="token operator">=</span> featuresVector<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token comment">//获取到的元素的个数</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> featureAmount<span class="token punctuation">.</span>value<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//循环获取元素名称与类型</span>
    name<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>featuresVector<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;district&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    type<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>featuresVector<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>popup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//设置位置</span>
  popup<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span>clickCrd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//关闭弹窗</span>
<span class="token keyword">const</span> <span class="token function-variable function">removePopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  popup<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  selectState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">//关闭弹窗状态</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//切换要素信息弹窗</span>
<span class="token keyword">const</span> <span class="token function-variable function">changePopup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>layerIndex<span class="token punctuation">.</span>value <span class="token operator">&lt;</span> featureAmount<span class="token punctuation">.</span>value <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    layerIndex<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;已经没有更多图层了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//监听map数据</span>
bus<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;mapToChecked&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">res</span><span class="token operator">:</span> Map</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 传参由回调函数中的形参接受</span>
  mapCopy <span class="token operator">=</span> res<span class="token punctuation">;</span>
  <span class="token comment">//监听click事件</span>
  mapCopy<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//更新弹窗状态为开启</span>
    selectState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//判断地图实例上是否存在绘制交互，如果存在，关闭弹窗</span>
    mapCopy
      <span class="token punctuation">.</span><span class="token function">getInteractions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;Draw&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          selectState<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token literal-property property">clickCoordinate</span><span class="token operator">:</span> Coordinate <span class="token operator">=</span> event<span class="token punctuation">.</span>coordinate<span class="token punctuation">;</span> <span class="token comment">//获取点击坐标</span>
    <span class="token keyword">const</span> <span class="token literal-property property">clickPixel</span><span class="token operator">:</span> Pixel <span class="token operator">=</span> event<span class="token punctuation">.</span>pixel<span class="token punctuation">;</span> <span class="token comment">//获取点击位置</span>
    featureAmount<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//每次点击都置空个数</span>
    name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//置空名称数组</span>
    type<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//置空类型数组</span>
    layerIndex<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//归零显示图层索引</span>
    <span class="token function">addPopup</span><span class="token punctuation">(</span>clickCoordinate<span class="token punctuation">,</span> clickPixel<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//挂载添加弹窗函数</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.olPopup</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 1px 4px <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #cccccc<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> -50px<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 350px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.olPopup:after,
.olPopup:before</span> <span class="token punctuation">{</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> solid transparent<span class="token punctuation">;</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.olPopup:after</span> <span class="token punctuation">{</span>
  <span class="token property">border-top-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token property">border-width</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> -10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.olPopup:before</span> <span class="token punctuation">{</span>
  <span class="token property">border-top-color</span><span class="token punctuation">:</span> #cccccc<span class="token punctuation">;</span>
  <span class="token property">border-width</span><span class="token punctuation">:</span> 11px<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 48px<span class="token punctuation">;</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.olPopupCloser</span> <span class="token punctuation">{</span>
  <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>
  <span class="token property">right</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.olPopupCloser:after</span> <span class="token punctuation">{</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;✖&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-7、图层遮罩" tabindex="-1"><a class="header-anchor" href="#_4-7、图层遮罩"><span>4.7、图层遮罩</span></a></h3><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> ol <span class="token keyword">from</span> <span class="token string">&#39;ol&#39;</span><span class="token punctuation">;</span> <span class="token comment">// 地图实例方法、视图方法</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&#39;ol/layer/Vector&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&#39;ol/source/Vector&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromExtent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/geom/Polygon&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> LinearRing <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/geom&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GeoJSON <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/format&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Tile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/layer&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">XYZ</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/source&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Fill<span class="token punctuation">,</span> Stroke <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;ol/style&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getJsonData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/api/getData/getData&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> map<span class="token operator">:</span> ol<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        target<span class="token operator">:</span> <span class="token string">&#39;js-map&#39;</span><span class="token punctuation">,</span>
        layers<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">XYZ</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    url<span class="token operator">:</span> <span class="token string">&#39;https://wprd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;style=7&amp;x={x}&amp;y={y}&amp;z={z}&#39;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        view<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            projection<span class="token operator">:</span> <span class="token string">&#39;EPSG:4326&#39;</span><span class="token punctuation">,</span>
            center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.06</span><span class="token punctuation">,</span> <span class="token number">30.67</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            zoom<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">showChengDuArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">showChengDuArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个适量图层</span>
        <span class="token keyword">let</span> initLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            source<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 设置图层样式</span>
            style<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token comment">// 平铺颜色</span>
                fill<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    color<span class="token operator">:</span> <span class="token string">&#39;rgba( 0, 0, 0, 1)&#39;</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// 擦除后的图形边框颜色</span>
                stroke<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    color<span class="token operator">:</span> <span class="token string">&#39;#f4b49f&#39;</span><span class="token punctuation">,</span>
                    width<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//  获取地区数据:http://datav.aliyun.com/portal/school/atlas/area_selector#&amp;lat=22.65267050733856&amp;lng=114.18983459472656&amp;zoom=10</span>
        map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>initLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getJsonData</span><span class="token punctuation">(</span>
            <span class="token string">&#39;https://geo.datav.aliyun.com/areas_v3/bound/510100_full.json&#39;</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">addConver</span><span class="token punctuation">(</span>initLayer<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//添加遮罩</span>
    <span class="token keyword">function</span> <span class="token function">addConver</span><span class="token punctuation">(</span>converLayer<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> converGeom <span class="token operator">=</span> <span class="token function">erase</span><span class="token punctuation">(</span>fts<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> convertFt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol</span><span class="token punctuation">.</span><span class="token function">Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            geometry<span class="token operator">:</span> converGeom<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        converLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFeature</span><span class="token punctuation">(</span>convertFt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//擦除操作，生成遮罩范围</span>
    <span class="token keyword">function</span> <span class="token function">erase</span><span class="token punctuation">(</span>geom<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> extent <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> polygonRing <span class="token operator">=</span> <span class="token function">fromExtent</span><span class="token punctuation">(</span>extent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 擦除操作</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> geom<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> g <span class="token operator">=</span> geom<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> coords <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">getCoordinates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            coords<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>coord<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> linearRing <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearRing</span><span class="token punctuation">(</span>coord<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 将所有多边形数据组放到一个数据组中</span>
                polygonRing<span class="token punctuation">.</span><span class="token function">appendLinearRing</span><span class="token punctuation">(</span>linearRing<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> polygonRing<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-8、聚合" tabindex="-1"><a class="header-anchor" href="#_4-8、聚合"><span>4.8、聚合</span></a></h3><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 100vh</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token string">&quot;ol/ol.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Fill<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> Circle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Cluster <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clusterLayer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">geojsonData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;成都市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.061902</span><span class="token punctuation">,</span> <span class="token number">30.609503</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;广安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">106.619126</span><span class="token punctuation">,</span> <span class="token number">30.474142</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;绵阳市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.673612</span><span class="token punctuation">,</span> <span class="token number">31.492565</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;雅安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">555</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">103.031653</span><span class="token punctuation">,</span> <span class="token number">30.018895</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;自贡市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.797794</span><span class="token punctuation">,</span> <span class="token number">29.368322</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;宜宾市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.610964</span><span class="token punctuation">,</span> <span class="token number">28.781347</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;内江市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">777</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">105.064555</span><span class="token punctuation">,</span> <span class="token number">29.581632</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pointerMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
 
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.065735</span><span class="token punctuation">,</span> <span class="token number">30.659462</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">pointerMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isHover <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">hasFeatureAtPixel</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getTargetElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> isHover <span class="token operator">?</span> <span class="token string">&quot;pointer&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">addCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cluster</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">distance</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>geojsonData<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          feature<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;features&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> value<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
              <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(124,144,255,100)&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token string">&quot;12px Calibri,sans-serif&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> style<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+T+`" alt="普通聚合" tabindex="0" loading="lazy"><figcaption>普通聚合</figcaption></figure><p>根据不同的数值，聚合标注显示不同的颜色:</p><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 1800px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 900px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token string">&quot;ol/ol.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Fill<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> Circle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defaults <span class="token keyword">as</span> defaultControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/control&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Cluster <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">geojsonData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;成都市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.061902</span><span class="token punctuation">,</span> <span class="token number">30.609503</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;广安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">106.619126</span><span class="token punctuation">,</span> <span class="token number">30.474142</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;绵阳市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">236</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.673612</span><span class="token punctuation">,</span> <span class="token number">31.492565</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;雅安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">555</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">103.031653</span><span class="token punctuation">,</span> <span class="token number">30.018895</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;自贡市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">155</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.797794</span><span class="token punctuation">,</span> <span class="token number">29.368322</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;宜宾市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.610964</span><span class="token punctuation">,</span> <span class="token number">28.781347</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;内江市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">777</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">105.064555</span><span class="token punctuation">,</span> <span class="token number">29.581632</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">&lt;</span> <span class="token number">700</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
 
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cluster</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">distance</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>geojsonData<span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
              feature<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;features&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                total <span class="token operator">+=</span> value<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token comment">// color: &quot;blue&quot;,</span>
                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token comment">// color: &quot;rgba(124,144,255,100)&quot;,</span>
                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
                  <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token string">&quot;12px Calibri,sans-serif&quot;</span><span class="token punctuation">,</span>
                  <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> style<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.065735</span><span class="token punctuation">,</span> <span class="token number">30.659462</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">controls</span><span class="token operator">:</span> <span class="token function">defaultControls</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+V+`" alt="image-20230714153516516" tabindex="0" loading="lazy"><figcaption>image-20230714153516516</figcaption></figure><p>动态添加移除聚合图层:</p><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 100vh</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span> <span class="token property">top</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span> <span class="token property">left</span><span class="token punctuation">:</span> 100px</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>addClusterLayer()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>添加聚类图层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>removeClusterLayer()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>移除聚类图层<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token string">&quot;ol/ol.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Fill<span class="token punctuation">,</span> Icon<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> Circle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Cluster <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clusterLayer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">geojsonData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;成都市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.061902</span><span class="token punctuation">,</span> <span class="token number">30.609503</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;广安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">106.619126</span><span class="token punctuation">,</span> <span class="token number">30.474142</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;绵阳市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.673612</span><span class="token punctuation">,</span> <span class="token number">31.492565</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;雅安市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">555</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">103.031653</span><span class="token punctuation">,</span> <span class="token number">30.018895</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;自贡市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.797794</span><span class="token punctuation">,</span> <span class="token number">29.368322</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;宜宾市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.610964</span><span class="token punctuation">,</span> <span class="token number">28.781347</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;内江市&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">777</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">105.064555</span><span class="token punctuation">,</span> <span class="token number">29.581632</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pointerMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
 
        <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">104.065735</span><span class="token punctuation">,</span> <span class="token number">30.659462</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4.5</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">pointerMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;pointermove&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isHover <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">hasFeatureAtPixel</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getTargetElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> isHover <span class="token operator">?</span> <span class="token string">&quot;pointer&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">addClusterLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//防止重复添加聚类图层</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
 
      <span class="token comment">// 添加聚类图层</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Cluster</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">distance</span><span class="token operator">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>geojsonData<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">feature</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
          feature<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;features&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> value<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
              <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgba(124,144,255,100)&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;white&quot;</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token string">&quot;12px Calibri,sans-serif&quot;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> style<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">removeClusterLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 防止移除空图层报错</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token keyword">this</span><span class="token punctuation">.</span>clusterLayer <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//一定要设为{}空对象</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+E+'" alt="image-20230714153609781" tabindex="0" loading="lazy"><figcaption>image-20230714153609781</figcaption></figure>',22),pn={href:"https://blog.csdn.net/BADAO_LIUMANG_QIZHI/article/details/122143275",target:"_blank",rel:"noopener noreferrer"},en=p(`<h3 id="_4-9、轨迹线" tabindex="-1"><a class="header-anchor" href="#_4-9、轨迹线"><span>4.9、轨迹线</span></a></h3><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 100vh</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> VectorSource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> Feature <span class="token keyword">from</span> <span class="token string">&quot;ol/Feature&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Draw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/interaction&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Fill<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Circle<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> transform<span class="token punctuation">,</span> fromLonLat<span class="token punctuation">,</span> toLonLat <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/proj&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> Point<span class="token punctuation">,</span> LineString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/geom&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View<span class="token punctuation">,</span> interaction<span class="token punctuation">,</span> events <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token punctuation">{</span> defaults <span class="token keyword">as</span> defaultControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/control&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">import</span> <span class="token constant">XYZ</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/XYZ&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">featureMove</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">carPoints</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//车还要走的点</span>
                <span class="token literal-property property">routeIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//当前小车所在的路段</span>
                <span class="token literal-property property">timer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token number">10836932.628965743</span><span class="token punctuation">,</span> <span class="token number">4998172.218425438</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">10638182.82599503</span><span class="token punctuation">,</span> <span class="token number">3781582.515392581</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">10897159.841987172</span><span class="token punctuation">,</span> <span class="token number">3552719.105911153</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11120000.530166456</span><span class="token punctuation">,</span> <span class="token number">4986126.775821152</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11360909.382252172</span><span class="token punctuation">,</span> <span class="token number">4895785.956289009</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11053750.595842887</span><span class="token punctuation">,</span> <span class="token number">3420219.23726401</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11294659.4479286</span><span class="token punctuation">,</span> <span class="token number">3257605.7621061527</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11565681.906525029</span><span class="token punctuation">,</span> <span class="token number">4823513.300663294</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11866817.971632171</span><span class="token punctuation">,</span> <span class="token number">4757263.366339724</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11535568.300014313</span><span class="token punctuation">,</span> <span class="token number">3185333.1064804387</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">11812613.479912885</span><span class="token punctuation">,</span> <span class="token number">3058855.959135439</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12125794.987624314</span><span class="token punctuation">,</span> <span class="token number">4721127.038526867</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12402840.167522885</span><span class="token punctuation">,</span> <span class="token number">4684990.710714009</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12023408.725487886</span><span class="token punctuation">,</span> <span class="token number">2926356.090488296</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12300453.905386457</span><span class="token punctuation">,</span> <span class="token number">2860106.1561647244</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12643749.0196086</span><span class="token punctuation">,</span> <span class="token number">4630786.218994724</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12866589.707787886</span><span class="token punctuation">,</span> <span class="token number">4510331.792951867</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12547385.478774315</span><span class="token punctuation">,</span> <span class="token number">2878174.3200711533</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12932839.642111458</span><span class="token punctuation">,</span> <span class="token number">2878174.3200711533</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">13113521.281175744</span><span class="token punctuation">,</span> <span class="token number">3751468.908881867</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">13125566.723780029</span><span class="token punctuation">,</span> <span class="token number">4739195.202433295</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">13691702.526181456</span><span class="token punctuation">,</span> <span class="token number">5425785.43087758</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">13553179.936232172</span><span class="token punctuation">,</span> <span class="token number">6112375.659321865</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12920794.199507171</span><span class="token punctuation">,</span> <span class="token number">5407717.266971151</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12065567.774602886</span><span class="token punctuation">,</span> <span class="token number">4974081.3332168665</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12788294.330860028</span><span class="token punctuation">,</span> <span class="token number">4895785.956289009</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">routeLayer</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化地图方法</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自动开启功能</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">//初始化地图</span>
            <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">XYZ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}&quot;</span><span class="token punctuation">,</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">108.522097</span><span class="token punctuation">,</span> <span class="token number">37.272848</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">4.7</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//添加矢量图层</span>
            <span class="token keyword">async</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//画轨迹线</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//开始动</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//轨迹线  把每个点连起来</span>
            <span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routeLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">VectorSource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routeLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">let</span> comDots <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> wireFeature <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>coordinates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    comDots<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    wireFeature <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">LineString</span><span class="token punctuation">(</span>comDots<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    wireFeature<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Stroke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token comment">// 设置边的样式</span>
                                <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;rgb(21, 106, 158)&quot;</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>routeLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFeatures</span><span class="token punctuation">(</span><span class="token punctuation">[</span>wireFeature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//创建小车这个要素</span>
            <span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//坐标转换</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>dotsData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>coordinates<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token function">transform</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">&quot;EPSG:3857&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//深复制车的位置，不在原数组改变，方便重新播放</span>
                <span class="token comment">// this.carPoints = JSON.parse(JSON.stringify(this.dotsData));</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>dotsData<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token comment">//小车最初位置在第一个坐标点</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>featureMove <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Feature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>featureMove<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>
                    <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">&quot;https://openlayers.org/en/v4.6.5/examples/data/icon.png&quot;</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">scale</span><span class="token operator">:</span> <span class="token number">0.85</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">anchor</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">rotation</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countRotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//添加车辆元素到图层</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>routeLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFeature</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>featureMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//计时器开始</span>
            <span class="token function">timeStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//重头开始</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        <span class="token comment">//移除要素</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>routeLayer<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeFeature</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>featureMove<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//重复运动</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自动开启功能</span>
                        <span class="token keyword">return</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//到转折点旋转角度</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex<span class="token operator">++</span><span class="token punctuation">;</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>featureMove
                            <span class="token punctuation">.</span><span class="token function">getStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">setRotation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">countRotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//改变坐标点</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>featureMove
                        <span class="token punctuation">.</span><span class="token function">getGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setCoordinates</span><span class="token punctuation">(</span><span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//计算下一个点的位置</span>
            <span class="token comment">//这里的算法是计算了两点之间的点   两点之间的连线可能存在很多个计算出来的点</span>
            <span class="token function">nextPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> routeIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex<span class="token punctuation">;</span>
                <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getPixelFromCoordinate</span><span class="token punctuation">(</span>
                    <span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>routeIndex<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取在屏幕的像素位置</span>
                <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getPixelFromCoordinate</span><span class="token punctuation">(</span>
                    <span class="token function">fromLonLat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>routeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> dx <span class="token operator">=</span> p2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> p1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> dy <span class="token operator">=</span> p2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//打印可见  在没有走到下一个点之前，下一个点是不变的，前一个点以这个点为终点向其靠近</span>
                <span class="token keyword">let</span> distance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>dx <span class="token operator">*</span> dx <span class="token operator">+</span> dy <span class="token operator">*</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>distance <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>routeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> x <span class="token operator">=</span> p1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> dx <span class="token operator">/</span> distance<span class="token punctuation">;</span>
                    <span class="token keyword">let</span> y <span class="token operator">=</span> p1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> dy <span class="token operator">/</span> distance<span class="token punctuation">;</span>
                    <span class="token keyword">let</span> coor <span class="token operator">=</span> <span class="token function">transform</span><span class="token punctuation">(</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">getCoordinateFromPixel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;EPSG:3857&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;EPSG:4326&quot;</span>
                    <span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>routeIndex<span class="token punctuation">]</span> <span class="token operator">=</span> coor<span class="token punctuation">;</span> <span class="token comment">//这里会将前一个点重新赋值  要素利用这个坐标变化进行移动</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>routeIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//计算两点之间的角度  算旋转角度</span>
            <span class="token function">countRotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeIndex<span class="token punctuation">,</span>
                    j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    i<span class="token operator">--</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carPoints<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>p2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> p1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+z+`" alt="轨迹" tabindex="0" loading="lazy"><figcaption>轨迹</figcaption></figure><h3 id="_4-10、地图下钻" tabindex="-1"><a class="header-anchor" href="#_4-10、地图下钻"><span>4.10、地图下钻</span></a></h3><h3 id="_4-11、热力图" tabindex="-1"><a class="header-anchor" href="#_4-11、热力图"><span>4.11、热力图</span></a></h3><h3 id="_4-12、动态图标" tabindex="-1"><a class="header-anchor" href="#_4-12、动态图标"><span>4.12、动态图标</span></a></h3><h3 id="_4-13、图层管理" tabindex="-1"><a class="header-anchor" href="#_4-13、图层管理"><span>4.13、图层管理</span></a></h3><h2 id="五、性能优化" tabindex="-1"><a class="header-anchor" href="#五、性能优化"><span>五、性能优化</span></a></h2><h3 id="_5-1、加载海量数据点性能优化" tabindex="-1"><a class="header-anchor" href="#_5-1、加载海量数据点性能优化"><span>5.1、加载海量数据点性能优化</span></a></h3><p>Openlayers中地图通常加载方式是利用canvas加载，在Openlayers 6.0版本之后引入了WebGL绘制，在绘制海量数据的时候，使用GPU减少CPU的负载。</p><h4 id="_1、canvas绘制" tabindex="-1"><a class="header-anchor" href="#_1、canvas绘制"><span>1、canvas绘制</span></a></h4><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token comment">&lt;!--
 * @Author: tangwenjian
 * @Date: 2023-12-05 15:39:51
 * @LastEditTime: 2023-12-05 18:28:34
 * @Description: OL加载海量数据
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vectorsource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Circle<span class="token punctuation">,</span> Fill <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> point <span class="token keyword">from</span> <span class="token string">&quot;./assets/point.json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WebGLPointsLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/WebGLPoints&quot;</span><span class="token punctuation">;</span> <span class="token comment">//使用webgl渲染</span>

<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//地图实例对象</span>
<span class="token keyword">let</span> pointLayer<span class="token punctuation">;</span> <span class="token comment">//point图层</span>

<span class="token comment">//GeoJSON数据源</span>
<span class="token keyword">const</span> geojsonSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vectorsource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//GeoJSON图层</span>
<span class="token keyword">const</span> geojsonLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VectorLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">source</span><span class="token operator">:</span> geojsonSource<span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Style</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">image</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 点半径</span>
      <span class="token literal-property property">radius</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token comment">// 缩放比</span>
      <span class="token literal-property property">scale</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token comment">// 填充色</span>
      <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化OL地图</span>
<span class="token keyword">const</span> <span class="token function-variable function">initMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">108.84</span><span class="token punctuation">,</span> <span class="token number">34.26</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//缩放级别</span>
      <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>geojsonLayer<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//在onMounted钩子函数上挂载初始化函数</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#map</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载结果：</p><figure><img src="`+I+`" alt="image-20231206162314667" tabindex="0" loading="lazy"><figcaption>image-20231206162314667</figcaption></figure><h4 id="_2、webgl绘制" tabindex="-1"><a class="header-anchor" href="#_2、webgl绘制"><span>2、WebGL绘制</span></a></h4><div class="language-vue line-numbers-mode" data-ext="vue" data-title="vue"><pre class="language-vue"><code><span class="token comment">&lt;!--
 * @Author: tangwenjian
 * @Date: 2023-12-05 15:39:51
 * @LastEditTime: 2023-12-05 18:28:34
 * @Description: OL加载海量数据
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Map<span class="token punctuation">,</span> View <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> TileLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Tile.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VectorLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/Vector.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vectorsource <span class="token keyword">from</span> <span class="token string">&quot;ol/source/Vector&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Style<span class="token punctuation">,</span> Stroke<span class="token punctuation">,</span> Circle<span class="token punctuation">,</span> Fill <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/style&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token constant">OSM</span> <span class="token keyword">from</span> <span class="token string">&quot;ol/source/OSM.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GeoJSON <span class="token keyword">from</span> <span class="token string">&quot;ol/format/GeoJSON&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> point <span class="token keyword">from</span> <span class="token string">&quot;./assets/point.json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> WebGLPointsLayer <span class="token keyword">from</span> <span class="token string">&quot;ol/layer/WebGLPoints&quot;</span><span class="token punctuation">;</span> <span class="token comment">//使用webgl渲染</span>

<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//地图实例对象</span>

<span class="token comment">//样式表达式配置样式</span>
<span class="token keyword">const</span> predefinedStyles <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">circles</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;circle-radius&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;interpolate&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;linear&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;population&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token number">40000</span><span class="token punctuation">,</span>
      <span class="token number">4</span><span class="token punctuation">,</span>
      <span class="token number">2000000</span><span class="token punctuation">,</span>
      <span class="token number">14</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-fill-color&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;interpolate&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;linear&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;latitude&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span>
      <span class="token string">&quot;#ff14c3&quot;</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token string">&quot;#ff621d&quot;</span><span class="token punctuation">,</span>
      <span class="token number">20</span><span class="token punctuation">,</span>
      <span class="token string">&quot;#ffed02&quot;</span><span class="token punctuation">,</span>
      <span class="token number">80</span><span class="token punctuation">,</span>
      <span class="token string">&quot;#00ff67&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-rotate-with-view&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-displacement&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;circle-opacity&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;interpolate&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;linear&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;population&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token number">40000</span><span class="token punctuation">,</span>
      <span class="token number">0.6</span><span class="token punctuation">,</span>
      <span class="token number">2000000</span><span class="token punctuation">,</span>
      <span class="token number">0.92</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newStyle <span class="token operator">=</span> predefinedStyles<span class="token punctuation">[</span><span class="token string">&quot;circles&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//图层样式</span>
<span class="token keyword">let</span> pointLayer<span class="token punctuation">;</span><span class="token comment">//point图层</span>

<span class="token comment">//GeoJSON数据源</span>
<span class="token keyword">const</span> geojsonSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vectorsource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">features</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFeatures</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//刷新图层</span>
<span class="token keyword">const</span> <span class="token function-variable function">refreshLayer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> previousLayer <span class="token operator">=</span> pointLayer<span class="token punctuation">;</span>
  pointLayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebGLPointsLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">source</span><span class="token operator">:</span> geojsonSource<span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> newStyle<span class="token punctuation">,</span>
    <span class="token comment">// disableHitDetection: true,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  map<span class="token punctuation">.</span><span class="token function">addLayer</span><span class="token punctuation">(</span>pointLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>previousLayer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">.</span><span class="token function">removeLayer</span><span class="token punctuation">(</span>previousLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    previousLayer<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//优化动画</span>
<span class="token keyword">const</span> <span class="token function-variable function">animate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  map<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//初始化OL地图</span>
<span class="token keyword">const</span> <span class="token function-variable function">initMap</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">108.84</span><span class="token punctuation">,</span> <span class="token number">34.26</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//缩放级别</span>
      <span class="token literal-property property">projection</span><span class="token operator">:</span> <span class="token string">&quot;EPSG:4326&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">TileLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">refreshLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//在onMounted钩子函数上挂载初始化函数</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">#map</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100vw<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载结果：</p><figure><img src="`+W+'" alt="image-20231206162829592" tabindex="0" loading="lazy"><figcaption>image-20231206162829592</figcaption></figure><blockquote><p>注意：</p><p>可以使用Chrome浏览器自带的实时帧率进行监测。</p><p><img src="'+j+'" alt="image-20231206163335871" style="zoom:50%;"><img src="'+D+'" alt="image-20231206163355407" style="zoom:50%;"></p></blockquote><h4 id="_3、数据聚类" tabindex="-1"><a class="header-anchor" href="#_3、数据聚类"><span>3、数据聚类</span></a></h4><p>通过空间上相邻活近似的数据点聚合成为单个聚类点，可以降低数据量，提高地图渲染性能，同时保留数据关键信息。可以使用openlayers自带的聚类类型，也可以让后端进行聚类筛选数据。</p><h4 id="_4、数据抽稀" tabindex="-1"><a class="header-anchor" href="#_4、数据抽稀"><span>4、数据抽稀</span></a></h4><p>通过减少数据点的数量来降低数据集大小，一般通过计算当前可视范围内的数据，超过当前可视范围就选择不加载。</p>',23);function on(cn,ln){const a=o("ExternalLinkIcon");return c(),l("div",null,[A,n("p",null,[s("其余控件具体用法可以查询"),B,s("官网API"),n("a",Z,[s("OpenLayers v7.4.0 API - Class: Control"),t(a)])]),J,n("p",null,[s("关于瓦片详情："),n("a",R,[s("万能瓦片地图加载秘籍"),t(a)])]),X,n("p",null,[s("关于WMS元数据详解请看："),n("a",Y,[s("OpenLayers教程十六：多源数据加载之WMS"),t(a)])]),K,n("p",null,[s("关于WMTS详情请看："),n("a",H,[s("OpenLayers教程：多源数据加载之WMTS"),t(a)])]),n("p",null,[s("此处从 GetCapabilities 响应访问 WMTS 的配置。更多加载WMTS方式请看："),n("a",U,[s("OpenLayers Examples——加载WMTS"),t(a)])]),Q,n("p",null,[s("WFS详情请看："),n("a",$,[s("OGC的网络要素服务（WFS）(持续更新。。。）"),t(a)])]),nn,n("p",null,[s("允许用户通过在地图上单击和拖动来绘制矢量框， 通常与"),n("a",sn,[an,t(a)]),s("限制 它到按住 shift 或其他键时。")]),tn,n("p",null,[s("更多聚合请看："),n("a",pn,[s("Openlayers中使用Cluster实现缩放地图时图层聚合与取消聚合-霸道流氓气质的博客-CSDN博客"),t(a)])]),en])}const kn=e(N,[["render",on],["__file","Openlayers笔记.html.vue"]]),dn=JSON.parse(`{"path":"/studyNotes/Openlayers%E7%AC%94%E8%AE%B0/Openlayers%E7%AC%94%E8%AE%B0.html","title":"Openlayers笔记","lang":"zh-CN","frontmatter":{"category":["Openlayers"],"description":"Openlayers笔记 一、基础配置 1、准备工作 1.1、安装openlayers 1.2、导入ol 2、初始化 2.1、准备地图容器 2.2、初始化地图 3、view视图中常用配置 二、地图控件 OpenLayers封装了很多地图控件用于操作地图内容、显示地图信息等。具体来说，控件是一个地图上可见的一个小部件，其DOM元素位于屏幕的固定位置，使用...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/studyNotes/Openlayers%E7%AC%94%E8%AE%B0/Openlayers%E7%AC%94%E8%AE%B0.html"}],["meta",{"property":"og:site_name","content":"歪脖祭司"}],["meta",{"property":"og:title","content":"Openlayers笔记"}],["meta",{"property":"og:description","content":"Openlayers笔记 一、基础配置 1、准备工作 1.1、安装openlayers 1.2、导入ol 2、初始化 2.1、准备地图容器 2.2、初始化地图 3、view视图中常用配置 二、地图控件 OpenLayers封装了很多地图控件用于操作地图内容、显示地图信息等。具体来说，控件是一个地图上可见的一个小部件，其DOM元素位于屏幕的固定位置，使用..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-03-22T17:23:42.000Z"}],["meta",{"property":"article:author","content":"祭司唐"}],["meta",{"property":"article:modified_time","content":"2024-03-22T17:23:42.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Openlayers笔记\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-03-22T17:23:42.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"祭司唐\\",\\"url\\":\\"\\"}]}"]]},"headers":[{"level":2,"title":"一、基础配置","slug":"一、基础配置","link":"#一、基础配置","children":[{"level":3,"title":"1、准备工作","slug":"_1、准备工作","link":"#_1、准备工作","children":[]},{"level":3,"title":"2、初始化","slug":"_2、初始化","link":"#_2、初始化","children":[]},{"level":3,"title":"3、view视图中常用配置","slug":"_3、view视图中常用配置","link":"#_3、view视图中常用配置","children":[]}]},{"level":2,"title":"二、地图控件","slug":"二、地图控件","link":"#二、地图控件","children":[{"level":3,"title":"1、普通缩放控件","slug":"_1、普通缩放控件","link":"#_1、普通缩放控件","children":[]},{"level":3,"title":"2、滑块缩放控件","slug":"_2、滑块缩放控件","link":"#_2、滑块缩放控件","children":[]},{"level":3,"title":"3、缩放至特定位置控件","slug":"_3、缩放至特定位置控件","link":"#_3、缩放至特定位置控件","children":[]},{"level":3,"title":"4、修改控件样式","slug":"_4、修改控件样式","link":"#_4、修改控件样式","children":[]},{"level":3,"title":"5、控件列表","slug":"_5、控件列表","link":"#_5、控件列表","children":[]}]},{"level":2,"title":"三、图层","slug":"三、图层","link":"#三、图层","children":[{"level":3,"title":"1、瓦片地图","slug":"_1、瓦片地图","link":"#_1、瓦片地图","children":[]},{"level":3,"title":"2、加载在线瓦片地图","slug":"_2、加载在线瓦片地图","link":"#_2、加载在线瓦片地图","children":[]},{"level":3,"title":"3、XYZ加载瓦片地图","slug":"_3、xyz加载瓦片地图","link":"#_3、xyz加载瓦片地图","children":[]},{"level":3,"title":"4、静态地图","slug":"_4、静态地图","link":"#_4、静态地图","children":[]},{"level":3,"title":"5、矢量地图","slug":"_5、矢量地图","link":"#_5、矢量地图","children":[]},{"level":3,"title":"6、地图服务","slug":"_6、地图服务","link":"#_6、地图服务","children":[]}]},{"level":2,"title":"四、交互","slug":"四、交互","link":"#四、交互","children":[{"level":3,"title":"4.1、绘制图形","slug":"_4-1、绘制图形","link":"#_4-1、绘制图形","children":[]},{"level":3,"title":"4.2、编辑图形","slug":"_4-2、编辑图形","link":"#_4-2、编辑图形","children":[]},{"level":3,"title":"4.3、查询图形","slug":"_4-3、查询图形","link":"#_4-3、查询图形","children":[]},{"level":3,"title":"4.4、框选图形","slug":"_4-4、框选图形","link":"#_4-4、框选图形","children":[]},{"level":3,"title":"4.5、测量与定位","slug":"_4-5、测量与定位","link":"#_4-5、测量与定位","children":[]},{"level":3,"title":"4.6、弹窗","slug":"_4-6、弹窗","link":"#_4-6、弹窗","children":[]},{"level":3,"title":"4.7、图层遮罩","slug":"_4-7、图层遮罩","link":"#_4-7、图层遮罩","children":[]},{"level":3,"title":"4.8、聚合","slug":"_4-8、聚合","link":"#_4-8、聚合","children":[]},{"level":3,"title":"4.9、轨迹线","slug":"_4-9、轨迹线","link":"#_4-9、轨迹线","children":[]},{"level":3,"title":"4.10、地图下钻","slug":"_4-10、地图下钻","link":"#_4-10、地图下钻","children":[]},{"level":3,"title":"4.11、热力图","slug":"_4-11、热力图","link":"#_4-11、热力图","children":[]},{"level":3,"title":"4.12、动态图标","slug":"_4-12、动态图标","link":"#_4-12、动态图标","children":[]},{"level":3,"title":"4.13、图层管理","slug":"_4-13、图层管理","link":"#_4-13、图层管理","children":[]}]},{"level":2,"title":"五、性能优化","slug":"五、性能优化","link":"#五、性能优化","children":[{"level":3,"title":"5.1、加载海量数据点性能优化","slug":"_5-1、加载海量数据点性能优化","link":"#_5-1、加载海量数据点性能优化","children":[]}]}],"git":{"createdTime":1711128222000,"updatedTime":1711128222000,"contributors":[{"name":"tangwenjian","email":"tangwenjian@qq.com","commits":1}]},"readingTime":{"minutes":60.53,"words":18158},"filePathRelative":"studyNotes/Openlayers笔记/Openlayers笔记.md","localizedDate":"2024年3月22日","excerpt":"\\n<h2>一、基础配置</h2>\\n<h3>1、准备工作</h3>\\n<h4>1.1、安装openlayers</h4>\\n<div class=\\"language-typescript\\" data-ext=\\"ts\\" data-title=\\"ts\\"><pre class=\\"language-typescript\\"><code>npm install ol\\n</code></pre></div><h4>1.2、导入ol</h4>\\n<div class=\\"language-typescript\\" data-ext=\\"ts\\" data-title=\\"ts\\"><pre class=\\"language-typescript\\"><code><span class=\\"token keyword\\">import</span> <span class=\\"token string\\">'ol/ol.css'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 在main.ts引入地图样式</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token operator\\">*</span> <span class=\\"token keyword\\">as</span> ol <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'ol'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 在地图组件页面中一级属性可一次性全部导入</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span> Map<span class=\\"token punctuation\\">,</span> View<span class=\\"token punctuation\\">,</span> Feature <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'ol'</span> <span class=\\"token comment\\">// 在地图组件页面中一级属性也可按需导入</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span> Tile <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">'ol/layer'</span><span class=\\"token punctuation\\">;</span> <span class=\\"token comment\\">// 二级属性必须由ol/xxx(一级属性名)进行按需导入</span>\\n</code></pre></div>","autoDesc":true}`);export{kn as comp,dn as data};
