<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.31" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/studyNotes/Cesium%E7%AC%94%E8%AE%B0/11%E3%80%81Cesium%E8%BF%9B%E9%98%B6%E4%B8%80%EF%BC%9A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html"><meta property="og:site_name" content="æ­ªè„–ç¥­å¸"><meta property="og:title" content="11ã€Cesiumæºç "><meta property="og:description" content="11ã€Cesiumæºç  1ã€Vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹ 1.1ã€è·å–æºç  githubä¸‹è½½ Releases Â· CesiumGS/cesium (github.com) ç¼–è¾‘å™¨æ‰“å¼€ 1.2ã€Viewerçš„æ„é€ å‡½æ•° è¿™ä¸€æ­¥ï¼ŒæŸ¥çœ‹DOMå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨getElement_defaultæ¨¡å—åˆ¤æ–­domIDæˆ–DOMå…ƒç´ å˜é‡å¹¶è¿”å›ã€‚ 1.2.1ã€å·¥å…·æ¨¡å—ï¼š..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-23T11:02:41.000Z"><meta property="article:author" content="ç¥­å¸å”"><meta property="article:modified_time" content="2024-03-23T11:02:41.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"11ã€Cesiumæºç ","image":[""],"dateModified":"2024-03-23T11:02:41.000Z","author":[{"@type":"Person","name":"ç¥­å¸å”","url":""}]}</script><title>11ã€Cesiumæºç  | æ­ªè„–ç¥­å¸</title><meta name="description" content="11ã€Cesiumæºç  1ã€Vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹ 1.1ã€è·å–æºç  githubä¸‹è½½ Releases Â· CesiumGS/cesium (github.com) ç¼–è¾‘å™¨æ‰“å¼€ 1.2ã€Viewerçš„æ„é€ å‡½æ•° è¿™ä¸€æ­¥ï¼ŒæŸ¥çœ‹DOMå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨getElement_defaultæ¨¡å—åˆ¤æ–­domIDæˆ–DOMå…ƒç´ å˜é‡å¹¶è¿”å›ã€‚ 1.2.1ã€å·¥å…·æ¨¡å—ï¼š...">
    <link rel="preload" href="/assets/style-DHUGEkQH.css" as="style"><link rel="stylesheet" href="/assets/style-DHUGEkQH.css">
    <link rel="modulepreload" href="/assets/app-DVIbrNyI.js"><link rel="modulepreload" href="/assets/11ã€Cesiumè¿›é˜¶ä¸€ï¼šæºç è§£æ.html-Btxy-AkS.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DXKKyxNO.js" as="script"><link rel="prefetch" href="/assets/intro.html-CsZUivGL.js" as="script"><link rel="prefetch" href="/assets/index.html-BfQTXmum.js" as="script"><link rel="prefetch" href="/assets/Openlayersç¬”è®°.html-umTsV5vr.js" as="script"><link rel="prefetch" href="/assets/01ã€CesiumåŸºç¡€ä¸€ï¼šç¯å¢ƒæ­å»º.html-BswSJe7Q.js" as="script"><link rel="prefetch" href="/assets/02ã€CesiumåŸºç¡€äºŒï¼šviewerè¯¦è§£ .html-BglcvlxY.js" as="script"><link rel="prefetch" href="/assets/03ã€CesiumåŸºç¡€ä¸‰ï¼šæ·»åŠ å›¾å±‚.html-UWt81Y-N.js" as="script"><link rel="prefetch" href="/assets/04ã€CesiumåŸºç¡€å››ï¼šAPIæ¶æ„.html-CeQ-0oNQ.js" as="script"><link rel="prefetch" href="/assets/05ã€CesiumåŸºç¡€äº”ï¼šcamera.html-DK1Xrjxa.js" as="script"><link rel="prefetch" href="/assets/06ã€CesiumåŸºç¡€å…­ï¼šå®ä½“Entity.html-BZVwZ4ja.js" as="script"><link rel="prefetch" href="/assets/07ã€CesiumåŸºç¡€ä¸ƒï¼šå›¾å…ƒPrimitive.html-hd8WyaG4.js" as="script"><link rel="prefetch" href="/assets/08ã€CesiumåŸºç¡€å…«ï¼šé¼ æ ‡äº‹ä»¶ScreenSpaceEventHandler.html-BYHVBwWe.js" as="script"><link rel="prefetch" href="/assets/09ã€CesiumåŸºç¡€ä¹ï¼šæè´¨.html-VG8wcGkb.js" as="script"><link rel="prefetch" href="/assets/10ã€CesiumåŸºç¡€åï¼šåŠ è½½å¤šæºæ•°æ®.html-DIANhLbe.js" as="script"><link rel="prefetch" href="/assets/12ã€Cesiumå®æˆ˜ä¸€ï¼šåˆ›å»ºåœ°çƒ.html-7fVpdrm2.js" as="script"><link rel="prefetch" href="/assets/13ã€Cesiumå®æˆ˜äºŒï¼šç»˜åˆ¶å·¥å…·.html-bh4qFJLt.js" as="script"><link rel="prefetch" href="/assets/14ã€Cesiumå®æˆ˜ä¸‰ï¼šé£è¡Œèˆªçº¿åŠ¨ç”».html-DQ6PotiU.js" as="script"><link rel="prefetch" href="/assets/15ã€Cesiumå®æˆ˜å››ï¼šè½¨è¿¹è¿½è¸ª.html-BCWuNU99.js" as="script"><link rel="prefetch" href="/assets/16ã€Cesiumå®æˆ˜äº”ï¼šåœºæ™¯ç²’å­æ¸²æŸ“.html-DSYakMsX.js" as="script"><link rel="prefetch" href="/assets/17ã€Cesiumå®æˆ˜å…­ï¼šæµ‹é‡å·¥å…·.html-CvxGdu8Y.js" as="script"><link rel="prefetch" href="/assets/18ã€Cesiumå®æˆ˜ä¸ƒï¼šæ ‡ç»˜å·¥å…·.html-DXvANhlp.js" as="script"><link rel="prefetch" href="/assets/19ã€Cesiumå®æˆ˜å…«ï¼šçƒ­åŠ›å›¾.html-3XQY_03z.js" as="script"><link rel="prefetch" href="/assets/20ã€Cesiumå®æˆ˜ä¹ï¼šæœåŠ¡åŠ è½½ä¸æŸ¥è¯¢.html-B0KcRP1B.js" as="script"><link rel="prefetch" href="/assets/21ã€Cesiumå®æˆ˜åï¼šå¤©é™…çº¿åˆ†æ.html-CHouqIkR.js" as="script"><link rel="prefetch" href="/assets/22ã€Cesiumå®æˆ˜åä¸€ï¼šå¯è§†åŸŸåˆ†æ.html-DslBqsjd.js" as="script"><link rel="prefetch" href="/assets/23ã€Cesiumå®æˆ˜åäºŒï¼šæŒ–æ–¹åˆ†æ.html-wrJHDakW.js" as="script"><link rel="prefetch" href="/assets/24ã€Cesiumå®æˆ˜åä¸‰ï¼šæ·¹æ²¡åˆ†æ.html-uZm_IApb.js" as="script"><link rel="prefetch" href="/assets/25ã€Cesiumå®æˆ˜åå››ï¼šå‰–é¢åˆ†æ.html-BYTGnt9H.js" as="script"><link rel="prefetch" href="/assets/26ã€Cesiumå®æˆ˜åäº”ï¼šé›·è¾¾æ‰«æ.html-Cu4c2fs0.js" as="script"><link rel="prefetch" href="/assets/27ã€Cesiumså®æˆ˜åå…­ï¼šå·å¸˜åˆ†å±.html-oLiFUv2n.js" as="script"><link rel="prefetch" href="/assets/28ã€Cesiumå®æˆ˜åä¸ƒï¼šç”µå­å›´æ .html-o2oZHafQ.js" as="script"><link rel="prefetch" href="/assets/29ã€CesiumåŸºç¡€åä¸€ï¼šå±æ€§Property.html-BrS6PxZr.js" as="script"><link rel="prefetch" href="/assets/30ã€CesiumåŸºç¡€åäºŒï¼šç²’å­ç³»ç»ŸParticleSystem.html-s2gyDZd7.js" as="script"><link rel="prefetch" href="/assets/31ã€Ceisumå®æˆ˜åå…«ï¼šåé€‰é®ç½©.html-Cu7bbVwV.js" as="script"><link rel="prefetch" href="/assets/050ã€Cesiumä¸­çš„removeAll().html-BWfOU8du.js" as="script"><link rel="prefetch" href="/assets/404.html-COLCfszs.js" as="script"><link rel="prefetch" href="/assets/index.html-DkuVlEH4.js" as="script"><link rel="prefetch" href="/assets/index.html-BoHXyaon.js" as="script"><link rel="prefetch" href="/assets/index.html-BX6biGcI.js" as="script"><link rel="prefetch" href="/assets/index.html-D_hRvhxx.js" as="script"><link rel="prefetch" href="/assets/index.html-BUfqUnHy.js" as="script"><link rel="prefetch" href="/assets/index.html-iV7xThBm.js" as="script"><link rel="prefetch" href="/assets/index.html-DRlBN9JP.js" as="script"><link rel="prefetch" href="/assets/index.html-DjLhCKFi.js" as="script"><link rel="prefetch" href="/assets/index.html-B8j18eP4.js" as="script"><link rel="prefetch" href="/assets/index.html-BsdscDOw.js" as="script"><link rel="prefetch" href="/assets/index.html-BNvOfQkW.js" as="script"><link rel="prefetch" href="/assets/index.html-DLZgSJ6Q.js" as="script"><link rel="prefetch" href="/assets/index.html-DxjCzubT.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">æ­ªè„–ç¥­å¸</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ç¬”è®°"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>ç¬”è®°</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¼€å‘è¿‡ç¨‹é—®é¢˜æ±‡æ€»</span></h4><ul class="dropdown-subitem-wrapper"></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/demo/" aria-label="ä»£ç æ¡ˆä¾‹"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span>ä»£ç æ¡ˆä¾‹<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="é¡¹ç›®æ¼”ç¤º"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span>é¡¹ç›®æ¼”ç¤º</span><span class="arrow"></span><ul class="nav-dropdown"></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/" aria-label="ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">å­¦ä¹ ç¬”è®°</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Cesiumç¬”è®°</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/01%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%B8%80%EF%BC%9A%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" aria-label="01ã€cesiumåŠ è½½åœ°çƒä¸ç¯å¢ƒæ­å»º"><!---->01ã€cesiumåŠ è½½åœ°çƒä¸ç¯å¢ƒæ­å»º<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/02%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%BA%8C%EF%BC%9Aviewer%E8%AF%A6%E8%A7%A3%20.html" aria-label="02ã€cesiumä¸­viewerè¯¦è§£"><!---->02ã€cesiumä¸­viewerè¯¦è§£<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/03%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%B8%89%EF%BC%9A%E6%B7%BB%E5%8A%A0%E5%9B%BE%E5%B1%82.html" aria-label="03ã€cesiumæ·»åŠ å›¾å±‚"><!---->03ã€cesiumæ·»åŠ å›¾å±‚<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/04%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%9B%9B%EF%BC%9AAPI%E6%9E%B6%E6%9E%84.html" aria-label="04ã€cesiumä¸­çš„API å…³ç³»"><!---->04ã€cesiumä¸­çš„API å…³ç³»<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/05%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%BA%94%EF%BC%9Acamera.html" aria-label="05ã€camera"><!---->05ã€camera<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/06%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%85%AD%EF%BC%9A%E5%AE%9E%E4%BD%93Entity.html" aria-label="06ã€å®ä½“Entity"><!---->06ã€å®ä½“Entity<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/07%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%B8%83%EF%BC%9A%E5%9B%BE%E5%85%83Primitive.html" aria-label="07ã€å›¾å…ƒPrimitive"><!---->07ã€å›¾å…ƒPrimitive<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/08%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%85%AB%EF%BC%9A%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6ScreenSpaceEventHandler.html" aria-label="08ã€ScreenSpaceEventHandler"><!---->08ã€ScreenSpaceEventHandler<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/09%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E4%B9%9D%EF%BC%9A%E6%9D%90%E8%B4%A8.html" aria-label="09ã€æè´¨"><!---->09ã€æè´¨<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/10%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%8D%81%EF%BC%9A%E5%8A%A0%E8%BD%BD%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE.html" aria-label="10ã€CesiumåŠ è½½å¤šæºæ•°æ®"><!---->10ã€CesiumåŠ è½½å¤šæºæ•°æ®<!----></a></li><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/11%E3%80%81Cesium%E8%BF%9B%E9%98%B6%E4%B8%80%EF%BC%9A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.html" aria-label="11ã€Cesiumæºç "><!---->11ã€Cesiumæºç <!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/12%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%B8%80%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%9C%B0%E7%90%83.html" aria-label="12ã€åˆ›å»ºåœ°çƒ"><!---->12ã€åˆ›å»ºåœ°çƒ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/13%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%BA%8C%EF%BC%9A%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7.html" aria-label="13ã€ç»˜åˆ¶å·¥å…·"><!---->13ã€ç»˜åˆ¶å·¥å…·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/14%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%B8%89%EF%BC%9A%E9%A3%9E%E8%A1%8C%E8%88%AA%E7%BA%BF%E5%8A%A8%E7%94%BB.html" aria-label="14ã€é£è¡Œèˆªçº¿è¿½è¸ª"><!---->14ã€é£è¡Œèˆªçº¿è¿½è¸ª<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/15%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%9B%9B%EF%BC%9A%E8%BD%A8%E8%BF%B9%E8%BF%BD%E8%B8%AA.html" aria-label="15ã€è½¨è¿¹è¿½è¸ª"><!---->15ã€è½¨è¿¹è¿½è¸ª<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/16%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%BA%94%EF%BC%9A%E5%9C%BA%E6%99%AF%E7%B2%92%E5%AD%90%E6%B8%B2%E6%9F%93.html" aria-label="16ã€åœºæ™¯ç²’å­æ¸²æŸ“"><!---->16ã€åœºæ™¯ç²’å­æ¸²æŸ“<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/17%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%85%AD%EF%BC%9A%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7.html" aria-label="17ã€æµ‹é‡å·¥å…·"><!---->17ã€æµ‹é‡å·¥å…·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/18%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%B8%83%EF%BC%9A%E6%A0%87%E7%BB%98%E5%B7%A5%E5%85%B7.html" aria-label="18ã€æ ‡ç»˜å·¥å…·"><!---->18ã€æ ‡ç»˜å·¥å…·<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/19%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%85%AB%EF%BC%9A%E7%83%AD%E5%8A%9B%E5%9B%BE.html" aria-label="19ã€çƒ­åŠ›å›¾"><!---->19ã€çƒ­åŠ›å›¾<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/20%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%B9%9D%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%8A%A0%E8%BD%BD%E4%B8%8E%E6%9F%A5%E8%AF%A2.html" aria-label="20ã€æœåŠ¡åŠ è½½ä¸æŸ¥è¯¢"><!---->20ã€æœåŠ¡åŠ è½½ä¸æŸ¥è¯¢<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/21%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%EF%BC%9A%E5%A4%A9%E9%99%85%E7%BA%BF%E5%88%86%E6%9E%90.html" aria-label="21ã€å¤©é™…çº¿åˆ†æ"><!---->21ã€å¤©é™…çº¿åˆ†æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/22%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E4%B8%80%EF%BC%9A%E5%8F%AF%E8%A7%86%E5%9F%9F%E5%88%86%E6%9E%90.html" aria-label="22ã€å¯è§†åŸŸåˆ†æ"><!---->22ã€å¯è§†åŸŸåˆ†æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/23%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E4%BA%8C%EF%BC%9A%E6%8C%96%E6%96%B9%E5%88%86%E6%9E%90.html" aria-label="23ã€æŒ–æ–¹åˆ†æ"><!---->23ã€æŒ–æ–¹åˆ†æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/24%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E4%B8%89%EF%BC%9A%E6%B7%B9%E6%B2%A1%E5%88%86%E6%9E%90.html" aria-label="24ã€æ·¹æ²¡åˆ†æ"><!---->24ã€æ·¹æ²¡åˆ†æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/25%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E5%9B%9B%EF%BC%9A%E5%89%96%E9%9D%A2%E5%88%86%E6%9E%90.html" aria-label="25ã€å‰–é¢åˆ†æ"><!---->25ã€å‰–é¢åˆ†æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/26%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E4%BA%94%EF%BC%9A%E9%9B%B7%E8%BE%BE%E6%89%AB%E6%8F%8F.html" aria-label="26ã€é›·è¾¾æ‰«æ"><!---->26ã€é›·è¾¾æ‰«æ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/27%E3%80%81Cesiums%E5%AE%9E%E6%88%98%E5%8D%81%E5%85%AD%EF%BC%9A%E5%8D%B7%E5%B8%98%E5%88%86%E5%B1%8F.html" aria-label="27ã€å·å¸˜åˆ†å±"><!---->27ã€å·å¸˜åˆ†å±<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/28%E3%80%81Cesium%E5%AE%9E%E6%88%98%E5%8D%81%E4%B8%83%EF%BC%9A%E7%94%B5%E5%AD%90%E5%9B%B4%E6%A0%8F.html" aria-label="28ã€ç”µå­å›´æ "><!---->28ã€ç”µå­å›´æ <!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/29%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%8D%81%E4%B8%80%EF%BC%9A%E5%B1%9E%E6%80%A7Property.html" aria-label="29ã€å±æ€§Property"><!---->29ã€å±æ€§Property<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/30%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%8D%81%E4%BA%8C%EF%BC%9A%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9FParticleSystem.html" aria-label="30ã€ç²’å­ç³»ç»Ÿ"><!---->30ã€ç²’å­ç³»ç»Ÿ<!----></a></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/31%E3%80%81Ceisum%E5%AE%9E%E6%88%98%E5%8D%81%E5%85%AB%EF%BC%9A%E5%8F%8D%E9%80%89%E9%81%AE%E7%BD%A9.html" aria-label="31ã€åé€‰é®ç½©"><!---->31ã€åé€‰é®ç½©<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Openlayersç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">å¼€å‘è¿‡ç¨‹é—®é¢˜</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/intro.html" aria-label="ä»‹ç»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>ä»‹ç»é¡µ<!----></a></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->11ã€Cesiumæºç </h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">ç¥­å¸å”</span></span><span property="author" content="ç¥­å¸å”"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-03-23T11:02:41.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 31 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT31M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_1ã€vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹">1ã€Vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_2ã€cesiumwidgetæ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹">2ã€CesiumWidgetæ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_3ã€requestanimationframeå¾ªç¯è§¦å‘å¸§åŠ¨ç”»">3ã€requestAnimationFrameå¾ªç¯è§¦å‘å¸§åŠ¨ç”»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_4ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“primitive">4ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“Primitive</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/#_5ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“entity">5ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“Entity</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="_11ã€cesiumæºç " tabindex="-1"><a class="header-anchor" href="#_11ã€cesiumæºç "><span>11ã€Cesiumæºç </span></a></h1><h3 id="_1ã€vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_1ã€vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹"><span>1ã€Vieweræ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹</span></a></h3><h4 id="_1-1ã€è·å–æºç " tabindex="-1"><a class="header-anchor" href="#_1-1ã€è·å–æºç "><span>1.1ã€è·å–æºç </span></a></h4><ul><li>githubä¸‹è½½</li></ul><p><a href="https://github.com/CesiumGS/cesium/releases" target="_blank" rel="noopener noreferrer">Releases Â· CesiumGS/cesium (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><figure><img src="/assets/image-20230717101440525-DBHjeTBL.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>ç¼–è¾‘å™¨æ‰“å¼€</li></ul><figure><img src="/assets/image-20230717101535831-DtHoVIqC.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_1-2ã€viewerçš„æ„é€ å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_1-2ã€viewerçš„æ„é€ å‡½æ•°"><span>1.2ã€Viewerçš„æ„é€ å‡½æ•°</span></a></h4><figure><img src="/assets/image-20230717101728415-Be0FhO3c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//245548è¡Œï¼›æŸ¥çœ‹æ˜¯å¦å­˜åœ¨DOM</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DeveloperError_default</span><span class="token punctuation">(</span><span class="token string">&quot;container is required.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    container <span class="token operator">=</span> <span class="token function">getElement_default</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥ï¼ŒæŸ¥çœ‹DOMå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä½¿ç”¨getElement_defaultæ¨¡å—åˆ¤æ–­domIDæˆ–DOMå…ƒç´ å˜é‡å¹¶è¿”å›ã€‚</p><h5 id="_1-2-1ã€å·¥å…·æ¨¡å—-defaultvalue-default" tabindex="-1"><a class="header-anchor" href="#_1-2-1ã€å·¥å…·æ¨¡å—-defaultvalue-default"><span>1.2.1ã€å·¥å…·æ¨¡å—ï¼šdefaultValue_default</span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//245552è¡Œ</span>
options <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> defaultValue_default<span class="token punctuation">.</span><span class="token constant">EMPTY_OBJECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥æ˜¯åˆ¤æ–­ä¼ è¿›æ¥çš„optionså¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œé‚£å°±ä½¿ç”¨ç©ºå¯¹è±¡é¢„è®¾å€¼<code>defaultValue_default.EMPTY_OBJECT</code>ã€‚å…¶ä¸­ï¼Œ<code>defaultValue_default</code>æ˜¯ä¸€ä¸ªé‡è¦çš„æ¨¡å—ï¼Œå®ƒåˆ¤æ–­ç¬¬ä¸€ä¸ªå‚æ•°å¦‚æœæ˜¯<strong>undefined</strong>ï¼Œå°±æŠŠç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºå®ƒçš„å€¼è¿”å›ï¼Œå¦‚æœä¸æ˜¯<strong>undefined</strong>ï¼Œé‚£å°±è¿”å›å®ƒæœ¬èº«ã€‚</p><h5 id="_1-2-2ã€å·¥å…·æ¨¡å—-defined-default" tabindex="-1"><a class="header-anchor" href="#_1-2-2ã€å·¥å…·æ¨¡å—-defined-default"><span>1.2.2ã€å·¥å…·æ¨¡å—ï¼šdefined_default</span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//245553è¡Œ</span>
<span class="token keyword">const</span> createBaseLayerPicker <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>globe<span class="token punctuation">)</span> <span class="token operator">||</span> options<span class="token punctuation">.</span>globe <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>baseLayerPicker<span class="token punctuation">)</span> <span class="token operator">||</span> options<span class="token punctuation">.</span>baseLayerPicker <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ­¥é€šè¿‡<code>defined_default</code>æ¨¡å—åˆ¤æ–­æ„é€ å‚æ•°<strong>options</strong>æ˜¯å¦æœ‰<strong>globe</strong>å±æ€§ã€<strong>baseLayerPicker</strong>å±æ€§æ¥å†³å®šæ˜¯å¦åˆ›å»ºåº•å›¾é€‰æ‹©å™¨æ§ä»¶ã€‚<code>defined_default</code>æ¨¡å—çš„ä½œç”¨å°±æ˜¯ï¼Œåˆ¤æ–­ä¼ å…¥å€¼æ˜¯å¦å®šä¹‰ï¼Œå®šä¹‰äº†å°±è¿”å›<strong>true</strong>ã€‚</p><h5 id="_1-2-3ã€åˆ›å»ºdomå’Œåˆ¤æ–­ä¼ å…¥å‚æ•°option" tabindex="-1"><a class="header-anchor" href="#_1-2-3ã€åˆ›å»ºdomå’Œåˆ¤æ–­ä¼ å…¥å‚æ•°option"><span>1.2.3ã€åˆ›å»ºDOMå’Œåˆ¤æ–­ä¼ å…¥å‚æ•°option</span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//245564è¡Œ</span>
<span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> viewerContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
viewerContainer<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;cesium-viewer&quot;</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>viewerContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cesiumWidgetContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cesiumWidgetContainer<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;cesium-viewer-cesiumWidgetContainer&quot;</span><span class="token punctuation">;</span>
viewerContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cesiumWidgetContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bottomContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bottomContainer<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&quot;cesium-viewer-bottom&quot;</span><span class="token punctuation">;</span>
viewerContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>bottomContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> scene3DOnly <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>scene3DOnly<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> clock<span class="token punctuation">;</span>
<span class="token keyword">let</span> clockViewModel<span class="token punctuation">;</span>
<span class="token keyword">let</span> destroyClockViewModel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>clockViewModel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	clockViewModel <span class="token operator">=</span> options<span class="token punctuation">.</span>clockViewModel<span class="token punctuation">;</span>
	clock <span class="token operator">=</span> clockViewModel<span class="token punctuation">.</span>clock<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Clock_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	clockViewModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClockViewModel_default</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span><span class="token punctuation">;</span>
	destroyClockViewModel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>shouldAnimate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	clock<span class="token punctuation">.</span>shouldAnimate <span class="token operator">=</span> options<span class="token punctuation">.</span>shouldAnimate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†<strong>Viewer</strong>å®ä¾‹çš„<strong>this</strong>æŒ‡å‘å˜é‡èµ‹äºˆç»™<strong>that</strong>å˜é‡ï¼Œå¹¶ä¸ºæ§ä»¶çš„<strong>div</strong>åˆ›å»º<strong>DOM</strong>å…ƒç´ ã€‚</p><p>åˆ©ç”¨<code>defaultValue_default</code>æ¨¡å—å’Œ<code>defined_default</code>æ¨¡å—ï¼Œå®ç°ï¼š</p><ul><li>åˆ¤æ–­ä¼ å…¥å‚æ•°<strong>options</strong>ä¸­<strong>scene3DOnly</strong>å‚æ•°æ˜¯å¦èµ‹å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸º<strong>false</strong>ï¼Œå³æ˜¯å¦ä»…ä½¿ç”¨3dåœºæ™¯çš„æ„æ€ï¼›</li><li>åˆ¤æ–­ä¼ å…¥å‚æ•°<strong>options</strong>ä¸­çš„æ—¶é’Ÿæ¨¡å‹å±æ€§<strong>clockViewModel</strong>æ˜¯å¦å­˜åœ¨ï¼Œæ¥å†³å®šæ˜¯ç”¨ä¼ å…¥çš„æ—¶é’Ÿæ¨¡å‹ï¼Œäº¦æˆ–è€…æ˜¯ç”¨ç³»ç»Ÿçš„æ—¶é’Ÿæ¨¡å‹ï¼›</li><li>åˆ¤æ–­ä¼ å…¥å‚æ•°<strong>options</strong>ä¸­æ˜¯å¦å®šä¹‰äº†<strong>shouldAnimate</strong>å±æ€§ï¼Œå¦‚æœå®šä¹‰äº†ï¼Œåˆ™å°†æ—¶é’Ÿçš„åŒåå±æ€§è®¾ä¸ºåŒæ ·çš„å€¼ã€‚</li></ul><h5 id="_1-2-4ã€åˆ›å»ºcesiumwidget" tabindex="-1"><a class="header-anchor" href="#_1-2-4ã€åˆ›å»ºcesiumwidget"><span>1.2.4ã€åˆ›å»ºCesiumWidget</span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//225489è¡Œ</span>
<span class="token keyword">const</span> cesiumWidget <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CesiumWidget_default</span><span class="token punctuation">(</span>cesiumWidgetContainer<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">baseLayer</span><span class="token operator">:</span> createBaseLayerPicker <span class="token operator">||</span> <span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>baseLayer<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>imageryProvider<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
      clock<span class="token punctuation">,</span>
      <span class="token literal-property property">skyBox</span><span class="token operator">:</span> options<span class="token punctuation">.</span>skyBox<span class="token punctuation">,</span>
      <span class="token literal-property property">skyAtmosphere</span><span class="token operator">:</span> options<span class="token punctuation">.</span>skyAtmosphere<span class="token punctuation">,</span>
      <span class="token literal-property property">sceneMode</span><span class="token operator">:</span> options<span class="token punctuation">.</span>sceneMode<span class="token punctuation">,</span>
      <span class="token literal-property property">mapProjection</span><span class="token operator">:</span> options<span class="token punctuation">.</span>mapProjection<span class="token punctuation">,</span>
      <span class="token literal-property property">globe</span><span class="token operator">:</span> options<span class="token punctuation">.</span>globe<span class="token punctuation">,</span>
      <span class="token literal-property property">orderIndependentTranslucency</span><span class="token operator">:</span> options<span class="token punctuation">.</span>orderIndependentTranslucency<span class="token punctuation">,</span>
      <span class="token literal-property property">contextOptions</span><span class="token operator">:</span> options<span class="token punctuation">.</span>contextOptions<span class="token punctuation">,</span>
      <span class="token literal-property property">useDefaultRenderLoop</span><span class="token operator">:</span> options<span class="token punctuation">.</span>useDefaultRenderLoop<span class="token punctuation">,</span>
      <span class="token literal-property property">targetFrameRate</span><span class="token operator">:</span> options<span class="token punctuation">.</span>targetFrameRate<span class="token punctuation">,</span>
      <span class="token literal-property property">showRenderLoopErrors</span><span class="token operator">:</span> options<span class="token punctuation">.</span>showRenderLoopErrors<span class="token punctuation">,</span>
      <span class="token literal-property property">useBrowserRecommendedResolution</span><span class="token operator">:</span> options<span class="token punctuation">.</span>useBrowserRecommendedResolution<span class="token punctuation">,</span>
      <span class="token literal-property property">creditContainer</span><span class="token operator">:</span> <span class="token function">defined_default</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>creditContainer<span class="token punctuation">)</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>creditContainer <span class="token operator">:</span> bottomContainer<span class="token punctuation">,</span>
      <span class="token literal-property property">creditViewport</span><span class="token operator">:</span> options<span class="token punctuation">.</span>creditViewport<span class="token punctuation">,</span>
      scene3DOnly<span class="token punctuation">,</span>
      <span class="token literal-property property">shadows</span><span class="token operator">:</span> options<span class="token punctuation">.</span>shadows<span class="token punctuation">,</span>
      <span class="token literal-property property">terrainShadows</span><span class="token operator">:</span> options<span class="token punctuation">.</span>terrainShadows<span class="token punctuation">,</span>
      <span class="token literal-property property">mapMode2D</span><span class="token operator">:</span> options<span class="token punctuation">.</span>mapMode2D<span class="token punctuation">,</span>
      <span class="token literal-property property">blurActiveElementOnCanvasFocus</span><span class="token operator">:</span> options<span class="token punctuation">.</span>blurActiveElementOnCanvasFocus<span class="token punctuation">,</span>
      <span class="token literal-property property">requestRenderMode</span><span class="token operator">:</span> options<span class="token punctuation">.</span>requestRenderMode<span class="token punctuation">,</span>
      <span class="token literal-property property">maximumRenderTimeChange</span><span class="token operator">:</span> options<span class="token punctuation">.</span>maximumRenderTimeChange<span class="token punctuation">,</span>
      <span class="token literal-property property">depthPlaneEllipsoidOffset</span><span class="token operator">:</span> options<span class="token punctuation">.</span>depthPlaneEllipsoidOffset<span class="token punctuation">,</span>
      <span class="token literal-property property">msaaSamples</span><span class="token operator">:</span> options<span class="token punctuation">.</span>msaaSamples
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é«˜é¢‘APIã€<strong>Scene</strong>ã€<strong>imageryProvider</strong>ã€<strong>Globe</strong>ç­‰å‡åœ¨<strong>CesiumWidget</strong>å®ä¾‹åŒ–è¿™ä¸€æ­¥åˆ›å»ºã€‚</p><h5 id="_1-2-5ã€å…¶ä»–çš„åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_1-2-5ã€å…¶ä»–çš„åˆå§‹åŒ–"><span>1.2.5ã€å…¶ä»–çš„åˆå§‹åŒ–</span></a></h5><p>ç´§éšå…¶åçš„å°±æ˜¯é˜Ÿ<strong>Viewer</strong>çš„å…¶ä»–çš„ä¸€äº›å±æ€§çš„åˆå§‹åŒ–ï¼Œåˆ†åˆ«æ˜¯ç•Œé¢ä¸Šçš„æŒ‰é’®ã€æ—¶é—´è½´ç­‰æ§ä»¶çš„åˆå§‹åŒ–ã€äº‹ä»¶æ€»ç®¡ç†è€…<code>EventHelper</code>æ¨¡å—çš„åˆå§‹åŒ–ã€é‡è¦çš„<code>DataSourceCollection/DataSourceDisplay</code>çš„åˆå§‹åŒ–ã€‚</p><p>æœ€åï¼Œä»¥ä¸Šåˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå…¨éƒ¨æ³¨å†Œä¸ºå½“å‰<strong>Viewer</strong>å®ä¾‹ä¸Šçš„å±æ€§ï¼Œå¹¶å°†å…¶ä¸­ä¸€äº›å¯¹è±¡ä¾‹å¦‚ï¼š<strong>DataSourceCollection</strong>çš„ä¸€äº›äº‹ä»¶ä¸€å¹¶æ³¨å†Œåˆ°<strong>Viewer</strong>çš„åŸå‹ä¸Šã€‚</p><p>é™¤äº†ä»¥ä¸Šåˆå§‹åŒ–ä¹‹å¤–ï¼Œ<strong>Cesium</strong>è¿˜é»˜è®¤ä¸º<strong>cesiumWidget</strong>æ³¨å†Œäº†å±å¹•æ“ä½œäº‹ä»¶çš„ç‚¹å‡»ã€åŒå‡»äº‹ä»¶ï¼Œæ–¹ä¾¿åˆå§‹åŒ–å®Œæˆåèƒ½é€šè¿‡ç‚¹å‡»æ¥æ‹¾å–åœºæ™¯ä¸­çš„<strong>Entity</strong>ï¼ˆåœºæ™¯<strong>Scene</strong>ã€å®ä½“<strong>Entity</strong>æ˜¯æ•°æ®èŒƒå›´ï¼Œä¸ä½œè¯¦ç»†ä»‹ç»äº†ï¼‰ï¼Œè¿™ä¸¤ä¸ªäº‹ä»¶ä½¿ç”¨<code>cesiumWidget.screenSpaceEventHandler.setInputAction</code>æ–¹æ³•æ¥æ³¨å†Œã€‚</p><h5 id="_1-2-6ã€åŸå‹å®šä¹‰æ–¹æ³•-object-defineproperties" tabindex="-1"><a class="header-anchor" href="#_1-2-6ã€åŸå‹å®šä¹‰æ–¹æ³•-object-defineproperties"><span>1.2.6ã€åŸå‹å®šä¹‰æ–¹æ³•ï¼š Object.defineProperties</span></a></h5><figure><img src="/assets/image-20230717202354595-CC5xXN8w.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åœ¨<strong>Viewer</strong>çš„åŸå‹ä¸Šå®šä¹‰çš„è®¸å¤šå±æ€§ï¼ŒåŒ…æ‹¬ä¸Šæ–‡æåŠçš„åˆå§‹åŒ–çš„å¤šä¸ªå¯¹è±¡ã€äº‹ä»¶ç­‰ã€‚è¿˜åŒ…æ‹¬ä¸Šæ–‡åˆ›å»ºçš„å„ä¸ªåˆå§‹åŒ–çš„å¯¹è±¡çš„ä¸€äº›<strong>å±æ€§å¿«æ·è¿æ¥</strong>ï¼Œä»¥ä¾¿<strong>Viewer</strong>å®ä¾‹ä¸Šç›´æ¥è®¿é—®<strong>å…¶ä»–æ¨¡å—çš„å±æ€§</strong>ã€‚</p><p>ä¾‹å¦‚ä½ æ—¢èƒ½åœ¨<strong>Viewer</strong>ä¸Šè·å–<strong>camera</strong>ï¼Œä¹Ÿèƒ½åœ¨<strong>Scene</strong>æ¨¡å—è·å–<strong>camera</strong>ï¼Œåªä¸è¿‡<strong>Viewer</strong>ä¸Šè¿”å›çš„<strong>camera</strong>ä¹Ÿè¦å…ˆè®¿é—®<strong>scene</strong>ç½¢äº†ã€‚</p><p>è¿˜åœ¨Viewerçš„åŸå‹ä¸Šå®šä¹‰äº†è®¸å¤šå…¬å…±æ–¹æ³•å’Œç§æœ‰æ–¹æ³•ã€‚</p><figure><img src="/assets/image-20230717202642537-eToYxKv-.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="/assets/image-20230717202814203-CFqp_iU-.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2ã€cesiumwidgetæ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2ã€cesiumwidgetæ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹"><span>2ã€CesiumWidgetæ¨¡å—å®ä¾‹åŒ–è¿‡ç¨‹</span></a></h3><p>å®ä¾‹åŒ–<strong>Viewer</strong>å¿…å®šä¼šå®ä¾‹åŒ–ä¸€ä¸ª<strong>CesiumWidget</strong>ã€‚<strong>CesiumWidget</strong>å®é™…ä¸Šä»£è¡¨çš„æ˜¯<strong>ä¸‰ç»´æ•°æ®å¯è§†åŒºåŸŸ</strong>ï¼Œè€Œ<strong>Viewer</strong>é™¤äº†åŒ…æ‹¬å¯è§†åŒºåŸŸï¼Œè¿˜åŒ…æ‹¬å„ç§æ§ä»¶ï¼ˆæ—¶é—´è½´ã€å³ä¸Šè§’å„ç§æŒ‰é’®ã€æœç´¢æ¡†ã€æ—¶é—´æ‹¨ç›˜ç­‰ï¼‰ï¼Œæ›´åƒæ˜¯ä¸€ä¸ª<strong>æ€»ä½“æ‰¿è½½å®¹å™¨</strong>ã€‚<strong>Viewer</strong>èƒ½é€šè¿‡<code>extend</code>()æ–¹æ³•æ‰©å……è‡ªå®šä¹‰çš„æ§ä»¶ã€‚</p><p><a href="https://zhuanlan.zhihu.com/p/121935766" target="_blank" rel="noopener noreferrer">CesiumWidgetæ¨¡å—çš„å®ä¾‹åŒ–è¿‡ç¨‹ ver1.67 - çŸ¥ä¹ (zhihu.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>åœ¨<strong>cesium</strong>ä¸­ï¼Œè™½ç„¶<strong>CesiumWidget</strong>æ˜¯ä¸‰ç»´æ•°æ®å¯è§†åŒºåŸŸï¼Œä½†æ˜¯çœŸæ­£è°ƒç”¨<strong>WebGL</strong>è¿›è¡Œç»˜å›¾çš„æ˜¯<strong>CesiumWidget</strong>ä¸­å®ä¾‹åŒ–çš„<strong>Scene</strong>ï¼Œ<strong>CesiumWidget</strong>ä¼šå°†æ„é€ æ—¶ä¼ é€’çš„<strong>DOM</strong>å…ƒç´ ä¸­å†…éƒ¨<strong>åµŒå…¥</strong>ä¸€ä¸ª<strong>canvas</strong>ï¼Œå†å°†è¿™ä¸ª<strong>canvaså…ƒç´ </strong>ä¼ é€’ç»™<strong>Sceneå®ä¾‹</strong>ï¼Œè®©<strong>Scene</strong>è¿›è¡Œç»˜åˆ¶ã€‚</p><figure><img src="/assets/image-20230718093934218-DGaNXaAK.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_2-1ã€åœºæ™¯åŠæœ‰å…³å¯¹è±¡æ„é€ " tabindex="-1"><a class="header-anchor" href="#_2-1ã€åœºæ™¯åŠæœ‰å…³å¯¹è±¡æ„é€ "><span>2.1ã€åœºæ™¯åŠæœ‰å…³å¯¹è±¡æ„é€ </span></a></h4><p><strong>CesiumWidget</strong>æ¨¡å—çš„æ„é€ å‡½æ•°é€šè¿‡ä¸€ä¸ª<code>try/catch</code>å—ï¼Œå®Œæˆ<strong>Scene</strong>ã€<strong>Globe</strong>ã€<strong>SkyBox</strong>ã€<strong>SkyAtmosphere</strong>æ¨¡å—çš„å®ä¾‹åŒ–ã€‚è€Œæœ€ç»ˆæš´éœ²åˆ°<strong>CesiumWidget</strong>çš„<strong>API</strong>ä¸­çš„ï¼Œæœ‰<strong>cameraã€terrainProviderã€imageryLayersã€sceneã€screenSpaceEventHandlerã€clock</strong>è¿™å‡ ä¸ªä¸»è¦çš„å¯¹è±¡</p><figure><img src="/assets/image-20230718102509248-LmtWbd-X.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä½†åœ¨<strong>Cesium</strong>ä¸­ï¼ŒæŸä¸ªæ¨¡å—çš„å±æ€§å¹¶ä¸ä¸€å®šæ˜¯å…¶åŸå‹ä¸Šçš„ï¼Œè€Œæ˜¯<strong>è¿™ä¸ªæ¨¡å—åˆ«çš„å±æ€§çš„åŸå‹ä¸Šçš„</strong>ã€‚ä¾‹å¦‚ï¼š<strong>CesiumWidget</strong>çš„å±æ€§<strong>Camera</strong>æ˜¯<strong>Scene</strong>ä¸Šçš„ã€‚</p><p>æ‰€ä»¥æƒ³è¦çŸ¥é“<strong>API</strong>ä¹‹é—´çš„<strong>åŒ…å«å…³ç³»</strong>ï¼Œåªèƒ½é€šè¿‡æºç äº†è§£ã€‚</p><figure><img src="/assets/image-20230718093944151-CiQPgAOh.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// CesiumWidget.jsæ¨¡å—</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">CesiumWidget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token literal-property property">camera</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">get</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scene<span class="token punctuation">.</span>camera<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230718093839974-BRZYo5vD.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_2-2ã€sceneå®ä¾‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-2ã€sceneå®ä¾‹åŒ–"><span>2.2ã€Sceneå®ä¾‹åŒ–</span></a></h4><p>å®ä¾‹åŒ–<strong>Scene</strong>å¯¹è±¡ï¼Œä¼ é€’ä¸»è¦çš„æ„é€ å‚æ•°å¤§éƒ¨åˆ†æ¥è‡ªäº<strong>CesiumWidget</strong>çš„æ„é€ å‚æ•°<strong>options</strong>ä¸­ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//å®ä¾‹åŒ–Sceneå¯¹è±¡</span>
<span class="token keyword">var</span> scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scene</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">canvas</span> <span class="token operator">:</span> canvas<span class="token punctuation">,</span>
    <span class="token literal-property property">contextOptions</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>contextOptions<span class="token punctuation">,</span>
    <span class="token literal-property property">creditContainer</span> <span class="token operator">:</span> innerCreditContainer<span class="token punctuation">,</span>
    <span class="token literal-property property">creditViewport</span><span class="token operator">:</span> creditViewport<span class="token punctuation">,</span>
    <span class="token literal-property property">mapProjection</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>mapProjection<span class="token punctuation">,</span>
    <span class="token comment">// å¤ªé•¿äº†ä¸è´´äº†</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_scene <span class="token operator">=</span> scene<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‡å®šæ‘„åƒæœºçš„çº¦æŸè½´ä¸ºZè½´ï¼Œè§¦å‘ç§æœ‰å‡½æ•°è°ƒæ•´åƒç´ æ¯”ä¾‹å’Œæ‘„åƒæœºè§†é”¥ä½“ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>scene<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>constrainedAxis <span class="token operator">=</span> Cartesian3_default<span class="token punctuation">.</span><span class="token constant">UNIT_Z</span><span class="token punctuation">;</span>
<span class="token function">configurePixelRatio</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">configureCameraFrustum</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»º<strong>ellipsoid</strong>å’Œ<strong>globe</strong>ï¼Œå¹¶ä¼ é€’ç»™<strong>scene</strong>.</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>      <span class="token keyword">const</span> ellipsoid <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>
        scene<span class="token punctuation">.</span>mapProjection<span class="token punctuation">.</span>ellipsoid<span class="token punctuation">,</span>
        Ellipsoid_default<span class="token punctuation">.</span><span class="token constant">WGS84</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> globe <span class="token operator">=</span> options<span class="token punctuation">.</span>globe<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>globe<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        globe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Globe_default</span><span class="token punctuation">(</span>ellipsoid<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>globe <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scene<span class="token punctuation">.</span>globe <span class="token operator">=</span> globe<span class="token punctuation">;</span>
        scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>shadows <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>
          options<span class="token punctuation">.</span>terrainShadows<span class="token punctuation">,</span>
          ShadowMode_default<span class="token punctuation">.</span><span class="token constant">RECEIVE_ONLY</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åç»­ä¸»è¦åˆ›å»ºï¼š</p><ul><li>ç¯å¢ƒå› ç´ ï¼šä¸»è¦æ˜¯å¤©ç©ºç›’å’Œå¤ªé˜³ã€æœˆäº®ã€å¤§æ°”ç¯å¢ƒã€‚</li><li>å½±åƒæ•°æ®æºï¼šï¼ˆè‹¥æ— ï¼Œåˆ™è°ƒç”¨<strong>createWorldImagery</strong>æ¨¡å—åˆ›å»ºä¸–ç•Œå½±åƒï¼Œå’Œ<strong>CesiumION</strong>çš„<strong>token</strong>æœ‰å…³ï¼‰å’Œåœ°å½¢æ•°æ®æºï¼Œå¹¶ä¼ é€’ç»™<strong>scene</strong>ã€‚å½±åƒæ•°æ®æºå’Œåœ°å½¢æ•°æ®æºå‡å¯ä»¥ä»<strong>options</strong>ä¸­è·å–ï¼Œè‹¥<strong>options</strong>æ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨<strong>Cesium</strong>å®˜æ–¹ç»™çš„ï¼Œéœ€è¦æ³¨æ„<strong>token</strong>é—®é¢˜ã€‚</li><li>è§†å›¾æ¨¡å¼ï¼šç¡®å®š<strong>scene</strong>å¯¹è±¡çš„è§†å›¾æ¨¡å¼æ˜¯äºŒç»´çš„ã€ä¸‰ç»´çš„è¿˜æ˜¯å“¥ä¼¦å¸ƒçš„ï¼ˆ2.5Dï¼‰ã€‚</li><li>ç»™<strong>scene</strong>ç»‘å®šäº†æ¸²æŸ“é”™è¯¯äº‹ä»¶å¤„ç†å‡½æ•°ã€‚</li><li>ç¡®è®¤æ˜¯å¦ä½¿ç”¨é»˜è®¤çš„å¾ªç¯æ¸²æŸ“æœºåˆ¶ï¼ˆ<strong>useDefaultRenderLoop</strong>å±æ€§ï¼‰ï¼Œè¿™ä¸ªå±æ€§è‹¥ä¸º<strong>false</strong>ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨<code>CesiumWidget.render()</code>æ¸²æŸ“ã€‚è¿˜ç¡®å®šäº†åœ¨é»˜è®¤å¾ªç¯æ¸²æŸ“æœºåˆ¶æ—¶ï¼Œç›®æ ‡å¸§é€Ÿç‡ï¼ˆ<strong>targetFrameRate</strong>å±æ€§ï¼‰ã€‚</li></ul><h4 id="_2-3ã€åŸå‹ä¸Šçš„æ–¹æ³•å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_2-3ã€åŸå‹ä¸Šçš„æ–¹æ³•å®šä¹‰"><span>2.3ã€åŸå‹ä¸Šçš„æ–¹æ³•å®šä¹‰</span></a></h4><figure><img src="/assets/image-20230718110813429-BSWqN44V.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3ã€requestanimationframeå¾ªç¯è§¦å‘å¸§åŠ¨ç”»" tabindex="-1"><a class="header-anchor" href="#_3ã€requestanimationframeå¾ªç¯è§¦å‘å¸§åŠ¨ç”»"><span>3ã€requestAnimationFrameå¾ªç¯è§¦å‘å¸§åŠ¨ç”»</span></a></h3><h4 id="_3-1ã€cesiumwidgetç±»æ˜¯æ§åˆ¶åœºæ™¯å¯¹è±¡è§¦å‘æ¸²æŸ“çš„è°ƒåº¦å™¨" tabindex="-1"><a class="header-anchor" href="#_3-1ã€cesiumwidgetç±»æ˜¯æ§åˆ¶åœºæ™¯å¯¹è±¡è§¦å‘æ¸²æŸ“çš„è°ƒåº¦å™¨"><span>3.1ã€CesiumWidgetç±»æ˜¯æ§åˆ¶åœºæ™¯å¯¹è±¡è§¦å‘æ¸²æŸ“çš„è°ƒåº¦å™¨</span></a></h4><p><strong>Scene</strong> ç±»æ˜¯ä¸€ä¸ªä¸‰ç»´ç©ºé—´å¯¹è±¡çš„å®¹å™¨ï¼Œå®ƒåœ¨åŸå‹é“¾ä¸Šæœ‰ä¸€ä¸ª <strong>render</strong> æ–¹æ³•ï¼Œå¯¥å¯¥ç™¾è¡Œï¼Œæ§åˆ¶äº†ä¸‰ç»´åœºæ™¯ä¸­è‹¥å¹²ç‰©ä½“çš„æ›´æ–°ã€æ¸²æŸ“ã€‚</p><p><code>Scene.prototype.render</code> æ–¹æ³•è°ƒç”¨ä¸€æ¬¡ï¼Œåªæ›´æ–°å¹¶æ¸²æŸ“<strong>ä¸€å¸§</strong>ã€‚</p><p><strong>WebGL</strong> ä¸€èˆ¬ä¼šå’Œ <strong>requestAnimationFrame, (rAF)</strong> è¿™ä¸ª API å¾ªç¯è°ƒç”¨æ¸²æŸ“å‡½æ•°ã€‚è€Œè®© <strong>canvas</strong> ä¸­åœºæ™¯èƒ½è¿ç»­å¤šå¸§å¾ªç¯å¾€å¤è¿è¡Œçš„è°ƒåº¦è€…ï¼Œæ˜¯ <strong>CesiumWidget</strong> ç±»ã€‚</p><p>åœ¨<strong>CesiumWidget</strong>ç±»ä¸­æœ‰ä¸€ä¸ªä½¿ç”¨<code>Object.defineProperties()</code>æ–¹æ³•å®šä¹‰çš„<code>setter</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//ä½¿ç”¨é»˜è®¤å¾ªç¯è°ƒåº¦    </span>
<span class="token literal-property property">useDefaultRenderLoop</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_useDefaultRenderLoop<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_useDefaultRenderLoop <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_useDefaultRenderLoop <span class="token operator">=</span> value<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_renderLoopRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">startRenderLoop</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨<strong>å®ä¾‹åŒ–CesiumWidget</strong>æ—¶ï¼Œä¼šä½¿ç”¨ä¼ å…¥çš„å€¼ï¼Œè‹¥æ²¡æœ‰ï¼Œåˆ™æ˜¯<strong>true</strong>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>_useDefaultRenderLoop <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>useDefaultRenderLoop <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>
	options<span class="token punctuation">.</span>useDefaultRenderLoop<span class="token punctuation">,</span>
	<span class="token boolean">true</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦èµ‹å€¼ï¼Œå°±å¼€å§‹<strong>CesiumJS</strong>çš„<strong>æ¸²æŸ“å¾ªç¯</strong>ï¼Œç”±ä¸€ä¸ªåœ¨æ¨¡å—å†…çš„å‡½æ•°<strong>startRenderLoop</strong>è´Ÿè´£æ§åˆ¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">startRenderLoop</span><span class="token punctuation">(</span><span class="token parameter">widget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    widget<span class="token punctuation">.</span>_renderLoopRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastFrameTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">render2</span><span class="token punctuation">(</span><span class="token parameter">frameTime</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//frameTimeè¡¨ç¤ºå¸§æ—¶é—´ï¼ˆå³ä¸Šä¸€å¸§å’Œå½“å‰å¸§ä¹‹é—´çš„æ—¶é—´å·®ï¼‰</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span><span class="token function">isDestroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//è¿™é‡Œé¦–å…ˆæ£€æŸ¥åœºæ™¯æ‰€å±çš„ widgetï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªCesium Vieweræˆ–å…¶ä»–æ¸²æŸ“å®¹å™¨ï¼‰æ˜¯å¦å·²è¢«é”€æ¯ã€‚å¦‚æœå·²è¢«é”€æ¯ï¼Œåˆ™ç›´æ¥é€€å‡ºå‡½æ•°ï¼Œä¸å†æ‰§è¡Œæ¸²æŸ“æ“ä½œã€‚</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>_useDefaultRenderLoop<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ£€æŸ¥ widget æ˜¯å¦ä½¿ç”¨é»˜è®¤çš„æ¸²æŸ“å¾ªç¯ã€‚è¿™æ„å‘³ç€å®ƒæ˜¯å¦ä¼šè‡ªåŠ¨è¿›è¡Œæ¸²æŸ“ï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨è°ƒç”¨è¯¥å‡½æ•°æ¥æ¸²æŸ“åœºæ™¯ã€‚</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> targetFrameRate <span class="token operator">=</span> widget<span class="token punctuation">.</span>_targetFrameRate<span class="token punctuation">;</span><span class="token comment">//è·å–ç›®æ ‡å¸§ç‡ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„æœŸæœ›å¸§ç‡å€¼ã€‚</span>
         <span class="token comment">//ç”¨äºæ£€æŸ¥å˜é‡æ˜¯å¦å·²å®šä¹‰ä¸”ä¸ä¸ºnullçš„å‡½æ•°ã€‚å¦‚æœç›®æ ‡å¸§ç‡æœªå®šä¹‰ï¼Œè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰è®¾ç½®ç‰¹å®šçš„ç›®æ ‡å¸§ç‡ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>targetFrameRate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒæ•´ widget çš„å¤§å°ï¼Œç¡®ä¿å®ƒé€‚åº”å®¹å™¨çš„å°ºå¯¸ã€‚</span>
            widget<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨ widget çš„æ¸²æŸ“æ–¹æ³•ï¼Œå¼€å§‹è¿›è¡Œåœºæ™¯çš„æ¸²æŸ“ã€‚</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ä½¿ç”¨æµè§ˆå™¨çš„rAFæ–¹æ³•æ¥è¯·æ±‚ä¸‹ä¸€å¸§çš„æ¸²æŸ“ï¼Œä»¥å½¢æˆè¿ç»­çš„æ¸²æŸ“å¾ªç¯ã€‚</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token number">1e3</span> <span class="token operator">/</span> targetFrameRate<span class="token punctuation">;</span><span class="token comment">//è®¡ç®—æ¯å¸§ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿åœ¨è¾¾åˆ°ç›®æ ‡å¸§ç‡æ—¶æ§åˆ¶æ¸²æŸ“é¢‘ç‡ã€‚</span>
            <span class="token keyword">const</span> delta <span class="token operator">=</span> frameTime <span class="token operator">-</span> lastFrameTime<span class="token punctuation">;</span><span class="token comment">//è®¡ç®—å½“å‰å¸§ä¸ä¸Šä¸€å¸§ä¹‹é—´çš„æ—¶é—´å·®</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&gt;</span> interval<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å¦‚æœæ—¶é—´å·®è¶…è¿‡äº†ç›®æ ‡é—´éš”ï¼Œè¯´æ˜å¯ä»¥è¿›è¡Œä¸‹ä¸€å¸§æ¸²æŸ“ã€‚</span>
              widget<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              widget<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//æ›´æ–° lastFrameTimeï¼Œä½¿å…¶ä¸ºä¸Šä¸€å¸§çš„æ—¶é—´ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶è®¡ç®—æ—¶é—´å·®ã€‚</span>
              lastFrameTime <span class="token operator">=</span> frameTime <span class="token operator">-</span> delta <span class="token operator">%</span> interval<span class="token punctuation">;</span><span class="token comment">//</span>
            <span class="token punctuation">}</span>
            <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render2<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å¦‚æœåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œå°†æ•è·å¼‚å¸¸å¹¶æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span>
          widget<span class="token punctuation">.</span>_useDefaultRenderLoop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°† _useDefaultRenderLoop æ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºä¸å†ä½¿ç”¨é»˜è®¤çš„æ¸²æŸ“å¾ªç¯</span>
          widget<span class="token punctuation">.</span>_renderLoopRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°† _renderLoopRunning æ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ¸²æŸ“å¾ªç¯å·²åœæ­¢</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>widget<span class="token punctuation">.</span>_showRenderLoopErrors<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å¦‚æœå…è®¸æ˜¾ç¤ºæ¸²æŸ“å¾ªç¯é”™è¯¯ï¼Œå°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span>
            <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token string">&quot;An error occurred while rendering.  Rendering has stopped.&quot;</span><span class="token punctuation">;</span><span class="token comment">//æ˜¾ç¤ºé”™è¯¯é¢æ¿ï¼Œå‘ç”¨æˆ·å±•ç¤ºå‘ç”Ÿçš„é”™è¯¯</span>
            widget<span class="token punctuation">.</span><span class="token function">showErrorPanel</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        widget<span class="token punctuation">.</span>_renderLoopRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°† _renderLoopRunning æ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ¸²æŸ“å¾ªç¯å·²åœæ­¢</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¼ å…¥çš„<strong>widget</strong>æ˜¯<strong>CesiumWidget</strong>çš„å®ä¾‹ï¼Œå®ç°äº†ä¸€ä¸ªçµæ´»çš„æ¸²æŸ“å¾ªç¯ï¼Œå…è®¸æ ¹æ®ç›®æ ‡å¸§ç‡æ§åˆ¶æ¸²æŸ“é¢‘ç‡ï¼ŒåŒæ—¶å¤„ç†å¯èƒ½å‘ç”Ÿçš„æ¸²æŸ“é”™è¯¯ã€‚åœ¨æ¸²æŸ“å‰ä¼šæ£€æŸ¥<strong>widget</strong>æ˜¯å¦å·²è¢«é”€æ¯ï¼Œä»¥é¿å…æ¸²æŸ“è¢«æ‰§è¡Œåˆ°å·²ä¸å†éœ€è¦çš„åœºæ™¯ã€‚æœ€åï¼Œé€šè¿‡<strong>é€’å½’</strong>è°ƒç”¨<code>requestAnimationFrame</code>å®ç°è¿ç»­çš„æ¸²æŸ“å¾ªç¯ï¼Œç›´åˆ°æ¸²æŸ“åœæ­¢æˆ–<strong>widget</strong>è¢«é”€æ¯ã€‚</p><h4 id="_3-2ã€sceneå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_3-2ã€sceneå¯¹è±¡"><span>3.2ã€Sceneå¯¹è±¡</span></a></h4><p>å¯¹äº<strong>å…¨å±€</strong>è€Œè¨€ï¼Œ<strong>CesiumWidget</strong>è´Ÿè´£æ§åˆ¶<strong>DOM</strong>çš„å˜åŒ–æƒ…å†µï¼Œä¾‹å¦‚çª—å£å°ºå¯¸å˜åŒ–å¯¼è‡´<strong>DIV</strong>çš„å˜åŒ–ç­‰ï¼Œå¹¶è´Ÿè´£èµ·<strong>æ¸²æŸ“å¾ªç¯çš„è°ƒåº¦</strong>ã€‚</p><p>å¯¹äº<strong>å•å¸§</strong>è€Œè¨€ï¼Œ<strong>Scene</strong>ç±»éœ€è¦ä½¿ç”¨è‡ªå·±åŸå‹é“¾ä¸Šçš„<strong>render</strong>æ–¹æ³•å®Œæˆè‡ªæˆ‘çŠ¶æ€ã€æ•°æ®å¯¹è±¡çš„æ›´æ–°;</p><p>ä»¥åŠ<code>Scene.js</code>æ¨¡å—å†…çš„<strong>render</strong>å‡½æ•°<strong>è§¦å‘WebGLç»˜åˆ¶</strong>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//Sceneç±»åŸå‹é“¾ä¸Šçš„render</span>
<span class="token class-name">Scene</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_preUpdate<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº‹ä»¶è§¦å‘ï¼Œä¼šåœ¨æ¸²æŸ“å‰è¢«è°ƒç”¨ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨æ¸²æŸ“ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œã€‚</span>
    <span class="token keyword">const</span> frameState <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_frameState<span class="token punctuation">;</span><span class="token comment">//è·å–å½“å‰åœºæ™¯çš„å¸§çŠ¶æ€å¯¹è±¡</span>
    frameState<span class="token punctuation">.</span>newFrame <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°†newFrameæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºå½“å‰å¸§ä¸æ˜¯ä¸€ä¸ªæ–°å¸§</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//æ£€æŸ¥æ—¶é—´å‚æ•°æ˜¯å¦å·²å®šä¹‰ï¼Œå¦‚æœæœªå®šä¹‰ï¼Œåˆ™ä½¿ç”¨å½“å‰çš„JulianDateï¼ˆå„’ç•¥æ—¥æœŸï¼‰ä½œä¸ºæ—¶é—´</span>
      time <span class="token operator">=</span> JulianDate_default<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      <span class="token comment">//æ£€æŸ¥ç›¸æœºæ˜¯å¦æœ‰æ›´æ–°ã€‚å¦‚æœæœ‰ç›¸æœºæ›´æ–°ï¼Œä¼šè¿”å›trueï¼Œå¦åˆ™è¿”å›false</span>
    <span class="token keyword">const</span> cameraChanged <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_view<span class="token punctuation">.</span><span class="token function">checkForCameraUpdates</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token doc-comment comment">/**åˆ¤æ–­æ˜¯å¦éœ€è¦æ¸²æŸ“åœºæ™¯
   !this.requestRenderMode: å¦‚æœæ²¡æœ‰è®¾ç½®requestRenderModeå±æ€§ï¼Œè¡¨ç¤ºå§‹ç»ˆè¦è¿›è¡Œæ¸²æŸ“ã€‚
	this._renderRequested: å¦‚æœ_renderRequestedå±æ€§ä¸ºtrueï¼Œè¡¨ç¤ºå·²ç»è¯·æ±‚è¿‡æ¸²æŸ“ã€‚
	cameraChanged: å¦‚æœç›¸æœºæœ‰æ›´æ–°ï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œæ¸²æŸ“ã€‚
	this._logDepthBufferDirty: å¦‚æœæ·±åº¦ç¼“å†²åŒºæœ‰æ›´æ–°ï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œæ¸²æŸ“ã€‚
	this._hdrDirty: å¦‚æœé«˜åŠ¨æ€èŒƒå›´(HDR)è®¾ç½®æœ‰æ›´æ–°ï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œæ¸²æŸ“ã€‚
	this.mode === SceneMode_default.MORPHING: å¦‚æœåœºæ™¯æ¨¡å¼ä¸ºâ€œMORPHINGâ€ï¼Œè¡¨ç¤ºéœ€è¦è¿›è¡Œæ¸²æŸ“ã€‚*/</span>
    <span class="token keyword">let</span> shouldRender <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestRenderMode <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_renderRequested <span class="token operator">||</span> cameraChanged <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_logDepthBufferDirty <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_hdrDirty <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">===</span> SceneMode_default<span class="token punctuation">.</span><span class="token constant">MORPHING</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœshouldRenderä¸ºfalseï¼Œå¹¶ä¸”å®šä¹‰äº†maximumRenderTimeChangeå±æ€§å’Œ_lastRenderTimeå±æ€§ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†æœ€å¤§æ¸²æŸ“æ—¶é—´é—´éš”ï¼Œå¦‚æœè¶…è¿‡åˆ™éœ€è¦è¿›è¡Œæ¸²æŸ“</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldRender <span class="token operator">&amp;&amp;</span> <span class="token function">defined_default</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maximumRenderTimeChange<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">defined_default</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_lastRenderTime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> difference <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>
        JulianDate_default<span class="token punctuation">.</span><span class="token function">secondsDifference</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_lastRenderTime<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      shouldRender <span class="token operator">=</span> shouldRender <span class="token operator">||</span> difference <span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maximumRenderTimeChange<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldRender<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å¦‚æœéœ€è¦è¿›è¡Œæ¸²æŸ“ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œ</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_lastRenderTime <span class="token operator">=</span> JulianDate_default<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> 		<span class="token keyword">this</span><span class="token punctuation">.</span>_lastRenderTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å°†å½“å‰æ—¶é—´å…‹éš†åˆ°_lastRenderTimeï¼Œç”¨äºè®¡ç®—ä¸‹ä¸€æ¬¡æ¸²æŸ“çš„æ—¶é—´é—´éš”</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_renderRequested <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°†_renderRequestedå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ¸²æŸ“å·²ç»è¢«å¤„ç†</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_logDepthBufferDirty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//å°†_logDepthBufferDirtyå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ·±åº¦ç¼“å†²åŒºå·²æ›´æ–°ã€‚</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_hdrDirty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// å°†_hdrDirtyå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºHDRè®¾ç½®å·²æ›´æ–°</span>
      <span class="token keyword">const</span> frameNumber <span class="token operator">=</span> Math_default<span class="token punctuation">.</span><span class="token function">incrementWrap</span><span class="token punctuation">(</span>
        frameState<span class="token punctuation">.</span>frameNumber<span class="token punctuation">,</span>
        <span class="token number">15e6</span><span class="token punctuation">,</span>
        <span class="token number">1</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ›´æ–°å¸§å·ï¼Œå°†frameState.frameNumberé€’å¢ï¼Œå¹¶åœ¨è¾¾åˆ°æœ€å¤§å€¼æ—¶å¾ªç¯å›æ¥ï¼ˆ15e6è¡¨ç¤ºæœ€å¤§å€¼ï¼‰</span>
      <span class="token function">updateFrameNumber</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> frameNumber<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ›´æ–°åœºæ™¯çš„å¸§æ•°ç›¸å…³å‚æ•°</span>
      frameState<span class="token punctuation">.</span>newFrame <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> prePassesUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æ¸²æŸ“å‰å°è¯•æ‰§è¡ŒprePassesUpdateå‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>primitives<span class="token punctuation">.</span>show<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//å¦‚æœåœºæ™¯ä¸­çš„å›¾å…ƒï¼ˆprimitivesï¼‰æ˜¾ç¤ºï¼ˆå³å¯è§ï¼‰ï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹æ“ä½œ</span>
      <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> updateMostDetailedRayPicks<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æ¸²æŸ“å‰å°è¯•æ‰§è¡ŒupdateMostDetailedRayPickså‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
      <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> updatePreloadPass<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æ¸²æŸ“å‰å°è¯•æ‰§è¡ŒupdatePreloadPasså‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
      <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> updatePreloadFlightPass<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æ¸²æŸ“å‰å°è¯•æ‰§è¡ŒupdatePreloadFlightPasså‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldRender<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœä¸éœ€è¦æ¸²æŸ“ï¼ˆå³shouldRenderä¸ºfalseï¼‰ï¼Œå°è¯•æ‰§è¡ŒupdateRequestRenderModeDeferCheckPasså‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
        <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> updateRequestRenderModeDeferCheckPass<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_postUpdate<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº‹ä»¶è§¦å‘ï¼Œä¼šåœ¨æ¸²æŸ“åè¢«è°ƒç”¨ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨æ¸²æŸ“ä¹‹åæ‰§è¡Œä¸€äº›æ“ä½œ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_preRender<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº‹ä»¶è§¦å‘ï¼Œåœ¨æ¸²æŸ“å‰è¢«è°ƒç”¨ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨æ¸²æŸ“ä¹‹å‰æ‰§è¡Œä¸€äº›æ“ä½œ</span>
      frameState<span class="token punctuation">.</span>creditDisplay<span class="token punctuation">.</span><span class="token function">beginFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¼€å§‹å¸§å¤„ç†ï¼Œç”¨äºæ˜¾ç¤ºç›¸åº”çš„ä¿¡ç”¨ä¿¡æ¯ï¼ˆä¾‹å¦‚Cesium logoï¼‰</span>
      <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> render<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å°è¯•æ‰§è¡Œæ¸²æŸ“æ“ä½œï¼Œäº¤ç»™Scene.jsæ¨¡å—çš„renderå‡½æ•°è§¦å‘WebGLç»˜åˆ¶ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
    <span class="token punctuation">}</span>
    <span class="token function">updateDebugShowFramesPerSecond</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> shouldRender<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ›´æ–°æ˜¯å¦æ˜¾ç¤ºå¸§ç‡çš„è°ƒè¯•ä¿¡æ¯ï¼Œæ ¹æ®æ˜¯å¦è¿›è¡Œäº†æ¸²æŸ“æ¥ç¡®å®š</span>
    <span class="token function">tryAndCatchError</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> postPassesUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åœ¨æ¸²æŸ“åå°è¯•æ‰§è¡ŒpostPassesUpdateå‡½æ•°ï¼Œå¹¶æ•è·å¯èƒ½å‘ç”Ÿçš„é”™è¯¯</span>
    <span class="token function">callAfterRenderFunctions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è°ƒç”¨åœ¨æ¸²æŸ“åæ‰§è¡Œçš„å‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_postRender<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº‹ä»¶è§¦å‘ï¼Œåœ¨æ¸²æŸ“åè¢«è°ƒç”¨ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨æ¸²æŸ“ä¹‹åæ‰§è¡Œä¸€äº›æ“ä½œ</span>
      frameState<span class="token punctuation">.</span>creditDisplay<span class="token punctuation">.</span><span class="token function">endFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç»“æŸå¸§å¤„ç†ï¼Œæ¸…é™¤ä¹‹å‰æ˜¾ç¤ºçš„ä¿¡ç”¨ä¿¡æ¯</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°äº†ä¸€ä¸ªçµæ´»çš„åœºæ™¯æ¸²æŸ“æµç¨‹ï¼Œæ ¹æ®<strong>åœºæ™¯ä¸­çš„å˜åŒ–æƒ…å†µå’Œç”¨æˆ·è®¾ç½®çš„å‚æ•°</strong>æ¥ç¡®å®šæ˜¯å¦è¿›è¡Œæ¸²æŸ“ã€‚åœ¨æ¸²æŸ“å‰å’Œæ¸²æŸ“åè§¦å‘äº†å¤šä¸ªäº‹ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡<strong>ç›‘å¬</strong>è¿™äº›äº‹ä»¶æ¥æ‰©å±•åœºæ™¯æ¸²æŸ“çš„åŠŸèƒ½ã€‚åŒæ—¶ï¼Œä»£ç ä¸­å¯¹é”™è¯¯çš„æ•è·å’Œå¤„ç†ä¹Ÿæœ‰ä¸€å®šçš„ä¿éšœ</p><p><strong>Scene</strong> ç±»æ˜¯ä¸€ä¸ªåœºæ™¯å¯¹è±¡å®¹å™¨ï¼Œå…¶<code>Scene.prototype.render()</code> æ–¹æ³•è´Ÿè´£ï¼š</p><ul><li>ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆ<strong>preUpdateã€preRenderã€postUpdateã€postRender</strong>ï¼‰å›è°ƒè§¦å‘ï¼›</li><li>æ›´æ–°å¸§çŠ¶æ€å’Œå¸§å·</li><li>æ›´æ–° <strong>Scene</strong> ä¸­çš„ <strong>Primitive</strong></li><li>ç§»äº¤æ¸²æŸ“æƒç»™æ¨¡å—å†…çš„ <strong>render</strong> å‡½æ•°è§¦å‘ <strong>WebGL</strong> ç»˜åˆ¶</li></ul><p><code>Scene.prototype.render()</code>å¹¶æ²¡æœ‰æ›´æ–°æ¤­çƒä½“ï¼Œæ²¡æœ‰è¯·æ±‚åœ°å½¢å››å‰æ ‘ç“¦ç‰‡ï¼Œè€Œæ˜¯ç­‰å¾…æ›´é‡è¦çš„ <strong>Primitive</strong> ç­‰ä¸‰ç»´ç‰©ä½“çš„æ›´æ–°åï¼Œæ‰åˆ¤æ–­ <strong>globe</strong> æ˜¯å¦å­˜åœ¨ï¼Œä»è€Œå†³å®šè¦ä¸è¦ç”»åœ°çƒï¼ˆçš„çš®è‚¤ï¼‰ï¼Œæœ€ç»ˆæ‰æ›´æ–°å¹¶æ‰§è¡Œ <strong>Command</strong>ï¼Œä¹Ÿå°±æ˜¯ <code>scene.updateAndExecuteCommands(passState, backgroundColor)</code>;</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//Scene.jsæ¨¡å—å†…çš„renderå‡½æ•°ï¼Œè§¦å‘WebGLç»˜åˆ¶ </span>
<span class="token keyword">var</span> scratchBackgroundColor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">scene</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> frameState <span class="token operator">=</span> scene<span class="token punctuation">.</span>_frameState<span class="token punctuation">;</span>
    <span class="token keyword">const</span> context <span class="token operator">=</span> scene<span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">const</span> us <span class="token operator">=</span> context<span class="token punctuation">.</span>uniformState<span class="token punctuation">;</span>
    <span class="token keyword">const</span> view <span class="token operator">=</span> scene<span class="token punctuation">.</span>_defaultView<span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span>_view <span class="token operator">=</span> view<span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">updateFrameState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    frameState<span class="token punctuation">.</span>passes<span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    frameState<span class="token punctuation">.</span>passes<span class="token punctuation">.</span>postProcess <span class="token operator">=</span> scene<span class="token punctuation">.</span>postProcessStages<span class="token punctuation">.</span>hasSelected<span class="token punctuation">;</span>
    frameState<span class="token punctuation">.</span>tilesetPassState <span class="token operator">=</span> renderTilesetPassState<span class="token punctuation">;</span>
    <span class="token keyword">let</span> backgroundColor <span class="token operator">=</span> <span class="token function">defaultValue_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>backgroundColor<span class="token punctuation">,</span> Color_default<span class="token punctuation">.</span><span class="token constant">BLACK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scene<span class="token punctuation">.</span>_hdr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      backgroundColor <span class="token operator">=</span> Color_default<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">,</span> scratchBackgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      backgroundColor<span class="token punctuation">.</span>red <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">.</span>red<span class="token punctuation">,</span> scene<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span><span class="token punctuation">;</span>
      backgroundColor<span class="token punctuation">.</span>green <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">.</span>green<span class="token punctuation">,</span> scene<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span><span class="token punctuation">;</span>
      backgroundColor<span class="token punctuation">.</span>blue <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">.</span>blue<span class="token punctuation">,</span> scene<span class="token punctuation">.</span>gamma<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    frameState<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> backgroundColor<span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span>fog<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>frameState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    us<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>frameState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> shadowMap <span class="token operator">=</span> scene<span class="token punctuation">.</span>shadowMap<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined_default</span><span class="token punctuation">(</span>shadowMap<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> shadowMap<span class="token punctuation">.</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>light<span class="token punctuation">)</span> <span class="token operator">||</span> scene<span class="token punctuation">.</span>light <span class="token keyword">instanceof</span> <span class="token class-name">SunLight_default</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Cartesian3_default<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span>us<span class="token punctuation">.</span>sunDirectionWC<span class="token punctuation">,</span> scene<span class="token punctuation">.</span>_shadowMapCamera<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Cartesian3_default<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>light<span class="token punctuation">.</span>direction<span class="token punctuation">,</span> scene<span class="token punctuation">.</span>_shadowMapCamera<span class="token punctuation">.</span>direction<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      frameState<span class="token punctuation">.</span>shadowMaps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>shadowMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    scene<span class="token punctuation">.</span>_computeCommandList<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span>_overlayCommandList<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> viewport <span class="token operator">=</span> view<span class="token punctuation">.</span>viewport<span class="token punctuation">;</span>
    viewport<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    viewport<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    viewport<span class="token punctuation">.</span>width <span class="token operator">=</span> context<span class="token punctuation">.</span>drawingBufferWidth<span class="token punctuation">;</span>
    viewport<span class="token punctuation">.</span>height <span class="token operator">=</span> context<span class="token punctuation">.</span>drawingBufferHeight<span class="token punctuation">;</span>
    <span class="token keyword">const</span> passState <span class="token operator">=</span> view<span class="token punctuation">.</span>passState<span class="token punctuation">;</span>
    passState<span class="token punctuation">.</span>framebuffer <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    passState<span class="token punctuation">.</span>blendingEnabled <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    passState<span class="token punctuation">.</span>scissorTest <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    passState<span class="token punctuation">.</span>viewport <span class="token operator">=</span> BoundingRectangle_default<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span>viewport<span class="token punctuation">,</span> passState<span class="token punctuation">.</span>viewport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span><span class="token function">beginFrame</span><span class="token punctuation">(</span>frameState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    scene<span class="token punctuation">.</span><span class="token function">updateEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">updateAndExecuteCommands</span><span class="token punctuation">(</span>passState<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ›´æ–°å¹¶æ‰§è¡Œ Command</span>
    scene<span class="token punctuation">.</span><span class="token function">resolveFramebuffers</span><span class="token punctuation">(</span>passState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    passState<span class="token punctuation">.</span>framebuffer <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">executeOverlayCommands</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> passState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span><span class="token function">endFrame</span><span class="token punctuation">(</span>frameState<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span>tilesLoaded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scene<span class="token punctuation">.</span>_renderRequested <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    context<span class="token punctuation">.</span><span class="token function">endFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/image-20230718144435169-Domp5rMw.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_3-3ã€ä¸‰ç»´åœ°çƒæ„æˆ" tabindex="-1"><a class="header-anchor" href="#_3-3ã€ä¸‰ç»´åœ°çƒæ„æˆ"><span>3.3ã€ä¸‰ç»´åœ°çƒæ„æˆ</span></a></h4><p>CesiumJS çš„ä¸‰ç»´åœ°çƒï¼Œå®é™…ä¸Šåˆ†ä¸¤å¤§éƒ¨åˆ†ï¼š</p><ul><li>åœ°çƒæ¤­çƒä½“ä¸è¡¨é¢çš„ GIS å½±åƒæœåŠ¡</li><li>åœºæ™¯ä¸­çš„ä¸‰ç»´ç‰©ä½“</li></ul><p>CesiumJS å†…ç½®äº†å¤§é‡çš„é»˜è®¤å€¼ï¼ŒåŒ…æ‹¬åœ°çƒæ¤­çƒä½“ä»¥åŠå½±åƒæœåŠ¡ï¼ˆé»˜è®¤ç”¨çš„å¿…åº”ç“¦ç‰‡æœåŠ¡ï¼Œè¦ tokenï¼‰ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šå¯ä»¥ä¸éœ€è¦åœ°çƒæ¤­çƒä½“å’Œåº•å›¾çš„ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">defined</span><span class="token punctuation">(</span>scene<span class="token punctuation">.</span>globe<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     scene<span class="token punctuation">.</span>globe<span class="token punctuation">.</span><span class="token function">beginFrame</span><span class="token punctuation">(</span>frameState<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç‰‡æ®µæ˜¯ <code>Scene.js</code> æ¨¡å—å†…çš„ <strong>render</strong> å‡½æ•°çš„ä¸€å°æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥æ²¡æœ‰å®šä¹‰ <strong>globe</strong>ï¼Œé‚£å°±ä¸ç»˜åˆ¶æ¤­çƒä¸Šçš„å¸§ã€‚</p><figure><img src="/assets/å¾®ä¿¡å›¾ç‰‡_20230717205915(1)-Ch-KbyiU.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_4ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“primitive" tabindex="-1"><a class="header-anchor" href="#_4ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“primitive"><span>4ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“Primitive</span></a></h3><p><strong>Scene.js</strong> æ¨¡å—å†…çš„ <strong>render</strong> å‡½æ•°ä¼šå°†æ§åˆ¶æƒäº¤ç»™ <strong>WebGL</strong>ï¼Œæ‰§è¡Œ CesiumJS è‡ªå·±å°è£…çš„<strong>æŒ‡ä»¤å¯¹è±¡</strong>ï¼Œç”»å‡º<strong>æ¯ä¸€å¸§</strong>æ¥ã€‚</p><p>æ¨¡å—å†…çš„ <strong>render</strong> å‡½æ•°é¦–å…ˆä¼šæ›´æ–°ä¸€æ‰¹çŠ¶æ€ä¿¡æ¯ï¼Œè­¬å¦‚å¸§çŠ¶æ€ã€é›¾æ•ˆã€Uniform å€¼ã€é€šé“çŠ¶æ€ã€ä¸‰ç»´åœºæ™¯ä¸­çš„ç¯å¢ƒä¿¡æ¯ç­‰ï¼Œç„¶åå°±å¼€å§‹æ›´æ–°å¹¶æ‰§è¡ŒæŒ‡ä»¤ï¼Œè°ƒç”¨çš„æ˜¯ <strong>Scene</strong> åŸå‹é“¾ä¸Šçš„ <code>updateAndExecuteCommands</code> æ–¹æ³•ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¤§è‡´è°ƒç”¨ä¸ºï¼š</p><figure><img src="/assets/image-20230718164936833-CsCHT8P_.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_4-1ã€æŒ‡ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-1ã€æŒ‡ä»¤"><span>4.1ã€æŒ‡ä»¤</span></a></h4><figure><img src="/assets/image-20230718155522084-C5csem9W.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>CesiumJS æœ‰ä¸‰ç±»æŒ‡ä»¤ï¼š</p><ul><li><strong>DrawCommand</strong> ç»˜å›¾æŒ‡ä»¤</li><li><strong>ClearCommand</strong> æ¸…å±æŒ‡ä»¤</li><li><strong>ComputeCommand</strong> è®¡ç®—æŒ‡ä»¤</li></ul><p>ç»˜å›¾æŒ‡ä»¤æœ€ç»ˆä¼šæŠŠæ§åˆ¶æƒäº¤ç»™ <code>Context</code> å¯¹è±¡ï¼Œæ ¹æ®è‡ªèº«çš„ç€è‰²å™¨å¯¹è±¡ï¼Œç»˜åˆ¶è‡ªå·±èº«ä¸Šçš„æ•°æ®èµ„æº;</p><p>æ¸…å±æŒ‡ä»¤æ¯”è¾ƒç®€å•ï¼Œç›®çš„å°±æ˜¯è°ƒç”¨ WebGL çš„æ¸…å±å‡½æ•°ï¼Œæ¸…ç©ºå„ç±»ç¼“å†²åŒºå¹¶å¡«å……æ¸…ç©ºåçš„é¢œè‰²å€¼ï¼Œä¾æ—§ä¼šæŠŠæ§åˆ¶æƒä¼ é€’ç»™ <code>Context</code> å¯¹è±¡;</p><p>è®¡ç®—æŒ‡ä»¤åˆ™å€ŸåŠ© WebGL å¹¶è¡Œè®¡ç®—çš„ç‰¹ç‚¹ï¼Œå°†æŒ‡ä»¤å¯¹è±¡ä¸Šçš„æ•°æ®åœ¨ç€è‰²å™¨ä¸­ç¼–ç ã€è®¡ç®—ã€è§£ç ï¼Œæœ€åå†™å…¥åˆ°è¾“å‡ºç¼“å†²ï¼ˆé€šå¸¸æ˜¯å¸§ç¼“å†²çš„çº¹ç†ä¸Šï¼‰ï¼ŒåŒæ ·æ§åˆ¶æƒä¼šç»™åˆ° <code>Context</code> å¯¹è±¡ã€‚</p><h4 id="_4-2ã€é€šé“" tabindex="-1"><a class="header-anchor" href="#_4-2ã€é€šé“"><span>4.2ã€é€šé“</span></a></h4><p>ä¸€å¸§æ˜¯ç”±å¤šä¸ªé€šé“é¡ºåºç»˜åˆ¶æ„æˆçš„ï¼Œåœ¨ CesiumJS ä¸­ï¼Œé€šé“è‹±æ–‡å•è¯æ˜¯ <strong>Pass</strong></p><p>æ—¢ç„¶é€šé“çš„ç»˜åˆ¶æ˜¯æœ‰é¡ºåºçš„ï¼Œå…¶é¡ºåºä¿å­˜åœ¨ <code>Renderer/Pass.js</code> æ¨¡å—å¯¼å‡ºçš„å†»ç»“å¯¹è±¡ä¸­ï¼Œç›®å‰ï¼ˆ1.107ç‰ˆæœ¬ï¼‰æœ‰ 10 ä¸ªä¼˜å…ˆé¡ºåºç­‰çº§ï¼ˆæœ€å <code>NUMBER_OF_PASSES</code> æ˜¯é€šé“çš„æ•°é‡ï¼‰</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>  <span class="token keyword">var</span> Pass <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">ENVIRONMENT</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token constant">COMPUTE</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token constant">GLOBE</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token constant">TERRAIN_CLASSIFICATION</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token constant">CESIUM_3D_TILE</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token constant">CESIUM_3D_TILE_CLASSIFICATION</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token constant">CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token constant">OPAQUE</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token constant">TRANSLUCENT</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
    <span class="token constant">VOXELS</span><span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token constant">OVERLAY</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token constant">NUMBER_OF_PASSES</span><span class="token operator">:</span> <span class="token number">11</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šä¸ºä¾‹ï¼Œç¬¬ä¸€ä¼˜å…ˆè¢«ç»˜åˆ¶çš„æŒ‡ä»¤ï¼Œæ˜¯ç¯å¢ƒï¼ˆ<code>ENVIRONMENT: 0</code>ï¼‰æ–¹é¢çš„å¯¹è±¡ã€ç‰©ä½“ã€‚è€Œä¸é€æ˜ï¼ˆ<code>OPAQUE: 7</code>ï¼‰çš„ä¸‰ç»´å¯¹è±¡çš„ç»˜åˆ¶æŒ‡ä»¤ï¼Œåˆ™è¦å…ˆäºé€æ˜ï¼ˆ<code>TRANSLUCENT: 8</code>ï¼‰ç‰©ä½“è¢«æ‰§è¡Œã€‚</p><p><strong>CesiumJS</strong> ä¼šåœ¨<strong>æ¯ä¸€å¸§å³å°†å¼€å§‹ç»˜åˆ¶å‰ï¼Œå¯¹æ‰€æœ‰å·²ç»æ”¶é›†å¥½çš„æŒ‡ä»¤æ ¹æ®é€šé“è¿›è¡Œæ’åºï¼Œå®ç°é¡ºåºç»˜åˆ¶</strong>ã€‚</p><h4 id="_4-3ã€ç”Ÿæˆå¹¶æ‰§è¡ŒæŒ‡ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-3ã€ç”Ÿæˆå¹¶æ‰§è¡ŒæŒ‡ä»¤"><span>4.3ã€ç”Ÿæˆå¹¶æ‰§è¡ŒæŒ‡ä»¤</span></a></h4><p>åŸå‹é“¾ä¸Šçš„ <code>updateAndExecuteCommands</code> æ–¹æ³•ä¼šåšæ¨¡å¼åˆ¤æ–­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ä¸‰ç»´æ¨¡å¼ï¼ˆ<code>SceneMode.SCENE3D</code>ï¼‰ï¼Œæ‰€ä»¥åªéœ€è¦çœ‹ <code>else if</code> åˆ†æ”¯å³å¯ï¼Œä¹Ÿå°±æ˜¯</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token function">executeCommandsInViewport</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> passState<span class="token punctuation">,</span> backgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤å¤„ï¼Œ<strong>this</strong> å°±æ˜¯ <strong>Scene</strong> è‡ªå·±ã€‚</p><p><code>executeCommandsInViewport()</code> æ˜¯ä¸€ä¸ª <code>Scene.js</code> æ¨¡å—å†…çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¯”è¾ƒçŸ­ï¼Œå¯¹äºå½“å‰æˆ‘ä»¬å…³å¿ƒçš„ä¸œè¥¿ï¼Œåªéœ€è¦çœ‹å®ƒè°ƒç”¨çš„ <code>updateAndRenderPrimitives()</code> å’Œæœ€åçš„ <code>executeCommands2()</code> å‡½æ•°è°ƒç”¨å³å¯ã€‚</p><h5 id="_4-3-1ã€primitive-ç”ŸæˆæŒ‡ä»¤" tabindex="-1"><a class="header-anchor" href="#_4-3-1ã€primitive-ç”ŸæˆæŒ‡ä»¤"><span>4.3.1ã€Primitive ç”ŸæˆæŒ‡ä»¤</span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token punctuation">[</span>Module Scene<span class="token punctuation">.</span>js<span class="token punctuation">]</span>
 <span class="token operator">-</span> fn <span class="token function">updateAndRenderPrimitives</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">[</span>Module Primitive<span class="token punctuation">.</span>js<span class="token punctuation">]</span>
   <span class="token operator">-</span> fn <span class="token function">createCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token operator">-</span> fn <span class="token function">updateAndQueueCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Scene.js</code> æ¨¡å—å†…çš„å‡½æ•° <code>updateAndRenderPrimitives()</code> è´Ÿè´£æ›´æ–° <strong>Scene</strong> ä¸Šæ‰€æœ‰çš„ <strong>Primitive</strong>ã€‚</p><p>æœŸé—´ï¼Œæ§åˆ¶æƒä¼šé€šè¿‡ <strong>PrimitiveCollection</strong> è½¬ç§»åˆ° <strong>Primitive</strong> ç±»ï¼ˆæˆ–è€…æœ‰ç±»ä¼¼ç»“æ„çš„ç±»ï¼Œè­¬å¦‚ <strong>Cesium3DTileset</strong> ç­‰ï¼‰ä¸Šï¼Œä»¤å…¶æ›´æ–°æœ¬èº«çš„æ•°æ®èµ„æºï¼Œæ ¹æ®æƒ…å†µåˆ›å»ºæ–°çš„ç€è‰²å™¨ï¼Œå¹¶éšä¹‹åˆ›å»º <strong>ç»˜å›¾æŒ‡ä»¤</strong>ï¼Œæœ€ç»ˆåœ¨ <code>Primitive.js</code> æ¨¡å—å†…çš„ <code>updateAndQueueCommands()</code> å‡½æ•°æ’åºã€å¹¶æ¨å…¥å¸§çŠ¶æ€å¯¹è±¡çš„æŒ‡ä»¤åˆ—è¡¨ä¸Šã€‚</p><h5 id="_4-3-2ã€contextå¯¹è±¡æ‰§è¡Œwebglåº•å±‚ä»£ç " tabindex="-1"><a class="header-anchor" href="#_4-3-2ã€contextå¯¹è±¡æ‰§è¡Œwebglåº•å±‚ä»£ç "><span>4.3.2ã€Contextå¯¹è±¡æ‰§è¡ŒWebGLåº•å±‚ä»£ç </span></a></h5><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token punctuation">[</span>Module Scene<span class="token punctuation">.</span>js<span class="token punctuation">]</span>
 <span class="token operator">-</span> fn <span class="token function">executeCommands2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token operator">-</span> fn <span class="token function">executeCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ”¶åˆ° Command å’Œ Context</span>
   <span class="token punctuation">[</span>Module Context<span class="token punctuation">.</span>js<span class="token punctuation">]</span>
   <span class="token operator">-</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ä¸ªæ¨¡å—å†…çš„å‡½æ•° <code>executeCommands2()</code> åˆ™è´Ÿè´£æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼ˆä¸­é—´è¿˜æœ‰ä¸€äº›å°æ’æ›²ï¼Œä¸‹æ–‡å†æï¼‰ã€‚</p><p>æ­¤æ—¶ï¼Œä¸Šæ–‡çš„â€œé€šé“â€å†æ¬¡èµ·ä½œç”¨ï¼Œæ­¤å‡½æ•°å†…ä¼šæ ¹æ® <strong>Pass</strong> çš„ä¼˜å…ˆé¡ºåºä¾æ¬¡æ›´æ–°å”¯ä¸€å€¼çŠ¶æ€ï¼ˆ<strong>UniformState</strong>ï¼‰ï¼Œç„¶åä¸‹å‘ç»™ <code>executeCommand()</code> å‡½æ•°ï¼ˆæ³¨æ„å°‘äº†ä¸ª<code>s</code>ï¼‰ä»¥å…·ä½“çš„æŸä¸ªæŒ‡ä»¤å¯¹è±¡ä»¥åŠ <code>Context</code> å¯¹è±¡ã€‚</p><blockquote><p>é™¤äº† <code>executeCommand()</code> å‡½æ•°å¤–ï¼Œ<code>Scene.js</code> æ¨¡å—å†…ä»è¿˜æœ‰å…¶å®ƒç±»ä¼¼çš„å‡½æ•°ï¼Œä¾‹å¦‚ <code>executeIdCommand()</code> è´Ÿè´£æ‰§è¡Œç»˜åˆ¶ ID ä¿¡æ¯çº¹ç†çš„æŒ‡ä»¤ï¼Œ</p><p><code>executeTranslucentCommandsBackToFront()</code> / <code>executeTranslucentCommandsFrontToBack()</code> å‡½æ•°è´Ÿè´£é€æ˜ç‰©ä½“çš„æŒ‡ä»¤ç­‰ã€‚</p><p>ç”šè‡³åœ¨ Scene å¯¹è±¡è‡ªå·±çš„å±æ€§ä¸­ï¼Œå°±æœ‰æ¸…å±æŒ‡ä»¤å­—æ®µï¼Œä¼šåœ¨ <code>executeCommands()</code> å‡½æ•°ä¸­ç›´æ¥æ‰§è¡Œï¼Œä¸ç»è¿‡ä¸Šè¿°å‡ ä¸ªæ‰§è¡Œå…·ä½“æŒ‡ä»¤çš„å‡½æ•°ã€‚</p></blockquote><p><strong>Context</strong> å¯¹è±¡æ˜¯å¯¹ <code>WebGL(2)RenderingContext</code> ç­‰ <strong>WebGL</strong> åŸç”Ÿæ¥å£ã€å‚æ•°çš„å°è£…ï¼Œæ‰€æœ‰æŒ‡ä»¤å¯¹è±¡æœ€ç»ˆéƒ½ä¼šç”±å…¶è¿›è¡Œæ‹†åŒ…è£…ã€ç»„è£… WebGL å‡½æ•°è°ƒç”¨å¹¶æ‰§è¡Œç»˜å›¾ã€è®¡ç®—ã€æ¸…å±ã€‚</p><h4 id="_4-4ã€æŒ‡ä»¤å¯¹è±¡è½¬ç§»" tabindex="-1"><a class="header-anchor" href="#_4-4ã€æŒ‡ä»¤å¯¹è±¡è½¬ç§»"><span>4.4ã€æŒ‡ä»¤å¯¹è±¡è½¬ç§»</span></a></h4><p>æŒ‡ä»¤å¯¹è±¡åœ¨ Primitiveï¼ˆæˆ–ç±»ä¼¼çš„ç±»ï¼‰ç”Ÿæˆåï¼Œç”± æ¨¡å—å†…çš„ <code>updateAndQueueCommands()</code> å‡½æ•°æ’åºå¹¶æ¨å…¥å¸§çŠ¶æ€å¯¹è±¡çš„æŒ‡ä»¤åˆ—è¡¨ä¸Šï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// updateAndQueueCommands å‡½æ•°ä¸­ï¼Œå‡½æ•°æ¥æ”¶æ¥è‡ª Scene é€çº§ä¼ å…¥çš„å¸§çŠ¶æ€å¯¹è±¡ -- frameState</span>
 <span class="token keyword">const</span> commandList <span class="token operator">=</span> frameState<span class="token punctuation">.</span>commandList<span class="token punctuation">;</span>
 <span class="token keyword">const</span> passes <span class="token operator">=</span> frameState<span class="token punctuation">.</span>passes<span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>passes<span class="token punctuation">.</span>render <span class="token operator">||</span> passes<span class="token punctuation">.</span>pick<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ... çœç•¥éƒ¨åˆ†ä»£ç </span>
   commandList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>colorCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>frameState.commandList</code> å°±æ˜¯ä¸ªæ™®é€šçš„æ•°ç»„ã€‚</p><p>è€Œåœ¨æ‰§è¡Œæ—¶ï¼Œå´æ˜¯ä» <strong>View</strong> å¯¹è±¡ä¸Šçš„ <strong>frustumCommandsList</strong> ä¸Šå–çš„æŒ‡ä»¤ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// Scene.js æ¨¡å—çš„ executeCommands2() å‡½æ•°ä¸­</span>
 <span class="token keyword">const</span> frustumCommandsList <span class="token operator">=</span> view<span class="token punctuation">.</span>frustumCommandsList<span class="token punctuation">;</span>
 <span class="token keyword">const</span> numFrustums <span class="token operator">=</span> frustumCommandsList<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
 <span class="token comment">//...</span>
 <span class="token keyword">let</span> j<span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numFrustums<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> index <span class="token operator">=</span> numFrustums <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> frustumCommands <span class="token operator">=</span> frustumCommandsList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
   
   <span class="token comment">// ...</span>
   
   <span class="token comment">// æˆªå–ä¸é€æ˜ç‰©ä½“çš„é€šé“æŒ‡ä»¤æ‰§è¡Œä»£ç ç‰‡æ®µ</span>
   us<span class="token punctuation">.</span><span class="token function">updatePass</span><span class="token punctuation">(</span>Pass<span class="token punctuation">.</span><span class="token constant">OPAQUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   commands <span class="token operator">=</span> frustumCommands<span class="token punctuation">.</span>commands<span class="token punctuation">[</span>Pass<span class="token punctuation">.</span><span class="token constant">OPAQUE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   length <span class="token operator">=</span> frustumCommands<span class="token punctuation">.</span>indices<span class="token punctuation">[</span>Pass<span class="token punctuation">.</span><span class="token constant">OPAQUE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">executeCommand</span><span class="token punctuation">(</span>commands<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> scene<span class="token punctuation">,</span> context<span class="token punctuation">,</span> passState<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œä¸‹å‘ç»™ <code>executeCommand()</code> å‡½æ•°çš„ <code>commands[j]</code> å‚æ•°ï¼Œå°±æ˜¯å…·ä½“çš„æŸä¸ªæŒ‡ä»¤å¯¹è±¡ã€‚</p><p>è€Œåœ¨è¿™ä¸ªä¼ é€’ä¸‹å‘çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯é€šè¿‡ <code>View.prototype.createPotentiallyVisibleSet</code>å®ç°çš„ã€‚</p><h5 id="_4-4-1ã€ç­›é€‰å¯è§é›†" tabindex="-1"><a class="header-anchor" href="#_4-4-1ã€ç­›é€‰å¯è§é›†"><span>4.4.1ã€ç­›é€‰å¯è§é›†</span></a></h5><p><strong>View</strong> å¯¹è±¡æ˜¯ <strong>Scene</strong>ã€<strong>Camera</strong> ä¹‹é—´çš„çº½å¸¦ï¼Œè´Ÿè´£â€œçœ¼ç›â€ä¸â€œä¸–ç•Œâ€ä¹‹é—´ä¿¡æ¯çš„å¤„ç†ï¼Œå³è§†å›¾ã€‚</p><p><code>View.prototype.createPotentiallyVisibleSet</code>çš„ä½œç”¨ï¼Œå°±æ˜¯æŠŠ <strong>Scene</strong> ä¸Šçš„è®¡ç®—æŒ‡ä»¤ã€è¦†ç›–ç‰©æŒ‡ä»¤ï¼Œå¸§çŠ¶æ€ä¸Šçš„æŒ‡ä»¤åˆ—è¡¨ï¼Œæ ¹æ® <strong>View</strong> çš„å¯è§èŒƒå›´åšä¸€æ¬¡ç­›é€‰ï¼Œå‡å°‘è¦æ‰§è¡ŒæŒ‡ä»¤ä¸ªæ•°æå‡æ€§èƒ½ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æŠŠåˆ†æ•£åœ¨å„å¤„çš„æŒ‡ä»¤ï¼Œç­›é€‰åç»‘è‡³ <strong>View</strong> å¯¹è±¡çš„ <strong>frustumCommandsList</strong> åˆ—è¡¨ä¸­ï¼Œå€ŸåŠ© <code>View.js</code> æ¨¡å—å†…çš„ <code>insertIntoBin()</code> å‡½æ•°å®Œæˆï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// View.js æ¨¡å—å†…</span>
 
 <span class="token keyword">function</span> <span class="token function">insertIntoBin</span><span class="token punctuation">(</span><span class="token parameter">view<span class="token punctuation">,</span> scene<span class="token punctuation">,</span> command<span class="token punctuation">,</span> commandNear<span class="token punctuation">,</span> commandFar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   
   <span class="token keyword">const</span> frustumCommandsList <span class="token operator">=</span> view<span class="token punctuation">.</span>frustumCommandsList<span class="token punctuation">;</span>
   <span class="token keyword">const</span> length <span class="token operator">=</span> frustumCommandsList<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// ...</span>
     
     frustumCommands<span class="token punctuation">.</span>commands<span class="token punctuation">[</span>pass<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> command<span class="token punctuation">;</span>
    
     <span class="token comment">// ...</span>
   <span class="token punctuation">}</span>
   
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°å†…åšäº†å¯¹<strong>æŒ‡ä»¤çš„ç­›é€‰åˆ¤æ–­</strong>ã€‚</p><h3 id="_5ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“entity" tabindex="-1"><a class="header-anchor" href="#_5ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“entity"><span>5ã€æ¸²æŸ“åŸç†ä¹‹æ¸²æŸ“Entity</span></a></h3><blockquote><p>Entityå‚æ•°å¯¹è±¡æœ€ç»ˆä¼šè¢«è§£æå˜æˆPrimitiveï¼Œå‡ ä½•ç±»å‹çš„Entityè½¬å˜ä¸ºå‡ ä½•ç±»å‹çš„Primitiveï¼Œä½†æ˜¯å…¶ä»–ç±»å‹çš„å‘¢ï¼Ÿä¾‹å¦‚ï¼šLabelã€Modelã€Wallã€tilesetè¿™äº›åˆè¯¥å¦‚ä½•è½¬åŒ–ä¸ºPrimitiveï¼Ÿï¼Ÿ</p><p>è§£ç­”ï¼š</p><ol><li>ä¸åŒçš„Entityä¼šè§¦å‘ç”Ÿæˆä¸åŒçš„Visualizerï¼ˆå¯è§†åŒ–å™¨ï¼‰</li><li>å…¶ä¸­GeometryVisualizerä¼šé€šè¿‡GeometryUpdaterSetåˆ›å»ºUpdaterï¼ˆæ›´æ–°å™¨ï¼‰ï¼Œç„¶åè¿›è¡Œåˆ†æ‰¹ã€æ›´æ–°ã€‚</li><li>å…¶ä¸­Cesium3Dtilesä¼šåœ¨ <code>Cesium3DTilesetVisualizer.prototype.update</code>è°ƒç”¨ <code>createTileset(resource, tilesetHash, entity, primitives)</code>æ–¹æ³•</li><li>Modelä¼šåœ¨ <code>ModelVisualizer.prototype.update</code>è°ƒç”¨ <code>createModelPrimitive(this, entity, resource, incrementallyLoadTextures)</code>æ–¹æ³•</li><li>å…¶ä½™çš„å¯ä»¥è¯¦çœ‹æºç ä¸­å¯¹åº”çš„<code>xxxx.prototype.update</code>æ–¹æ³•ã€‚</li></ol></blockquote><p>åœ¨åˆ›å»ºä¸‰ç»´å‡ ä½•ä½“æˆ–ä¸‰ç»´æ¨¡å‹çš„æ—¶å€™ï¼Œåªéœ€è¦ä¼ å…¥å‚æ•°å¯¹è±¡ï¼Œå°±å¯ä»¥å®ç°Entityçš„åˆ›å»ºã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> modelEntity <span class="token operator">=</span> viewer<span class="token punctuation">.</span>entites<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;some-entitiy&#39;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;some-name&#39;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">position</span><span class="token operator">:</span> Cartesian3<span class="token punctuation">.</span><span class="token function">fromDegrees</span><span class="token punctuation">(</span><span class="token number">112.5</span><span class="token punctuation">,</span> <span class="token number">22.3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">uri</span><span class="token operator">:</span> <span class="token string">&#39;path/to/model.glb&#39;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³äºEntityä¸Primitiveä¹‹é—´çš„å¯¹æ¯”ï¼š</p><ul><li>å‰è€…ä½¿ç”¨ Property API ä½¿å¾—åŠ¨æ€æ•ˆæœç®€å•åŒ–ï¼Œåè€…éœ€è¦è‡ªå·±ç¼–å†™ç€è‰²å™¨ï¼›</li><li>ä¸ªä½“æ•°é‡è¾ƒå¤šæ—¶ï¼Œå‰è€…çš„æ€§èƒ½ä¸å¦‚åè€…ï¼›</li><li>åè€…æ”¯æŒè¾ƒåº•å±‚çš„ç”¨æ³•ï¼Œå¯ä»¥è‡ªå·±æ§åˆ¶æè´¨ç€è‰²å™¨ã€å‡ ä½•æ•°æ®å¹¶æ‰¹ä¼˜åŒ–ï¼›</li><li>...</li></ul><blockquote><p><strong>ä½†æ˜¯Entityæœ€ç»ˆä¼šå˜æˆPrimitiveï¼Œå…¶ä¸­Entity APIæ˜¯å¦‚ä½•ä»å‚æ•°åŒ–å¯¹è±¡åˆ°WebGLæ¸²æŸ“ï¼Ÿ</strong></p></blockquote><p>ä¸Šè¿°ä»£ç å¯ä»¥å¾—å‡ºï¼Œ<strong>Entity API</strong>çš„å…¥å£æ˜¯<strong>Viewer</strong>ï¼Œè€Œä¸æ˜¯åƒ<strong>Primitive API</strong>æ˜¯ä»<strong>Scene</strong>è®¿é—®çš„ï¼Œå³ï¼š</p><p><strong>Entity APIå¿…é¡»ä¾èµ–Viewerå®¹å™¨ã€‚</strong></p><h4 id="_5-1ã€entity-apiå¿…é¡»ä¾èµ–viewerå®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_5-1ã€entity-apiå¿…é¡»ä¾èµ–viewerå®¹å™¨"><span>5.1ã€Entity APIå¿…é¡»ä¾èµ–Viewerå®¹å™¨</span></a></h4><p><strong>Viewer</strong> å…¶å®æ˜¯ <strong>CesiumJS</strong> é•¿æœŸç»´æŠ¤çš„ä¸€ä¸ªæˆæœï¼Œå®ƒåœ¨å¤§å¤šæ•°æ—¶å€™æ‰®æ¼”çš„æ˜¯ <strong>Web3D GIS</strong> åœ°çƒçš„æ€»å…¥å£å¯¹è±¡ã€‚</p><p><strong>Scene</strong> æš´éœ²å‡ºæ¥çš„ Primitive API æ˜¯ä¸€ç§æ¯”è¾ƒæ¥è¿‘ WebGL æ•°æ®æ¥å£çš„ APIï¼Œé¢å¯¹æ¥è¿‘ä¸šåŠ¡å±‚çš„æ•°æ®æ ¼å¼ï¼Œè­¬å¦‚ GeoJSONã€KMLã€GPX ç­‰ï¼ŒPrimitive API å°±æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>è™½ç„¶å¯ä»¥åšä¸€äº›è½¬æ¢æ¥å£ï¼Œä¸è¿‡ <strong>Cesium</strong> å›¢é˜Ÿç»“åˆè‡ªå·±ç ”å‘çš„æ•°æ®æ ‡è®°è¯­è¨€ -- <strong>CZML</strong>ï¼Œé…ä¸Š<strong>å†…ç½®çš„æ—¶é’Ÿ</strong>ï¼Œå°è£…å‡ºäº†æ›´é«˜çº§åˆ«çš„æ¶æ„ã€‚</p><p><strong>CesiumJS</strong> ä½¿ç”¨ <strong>DataSource API</strong> å’Œ <strong>Entity API</strong> è¿™å¥—ç»„åˆå®ç°äº†å¤æ‚ã€åŠ¨æ€ç©ºé—´åœ°ç†æ•°æ®æ ¼å¼çš„æ¥å…¥ã€‚</p><h5 id="_5-1-1ã€é«˜å±‚æ•°æ®æ¨¡å‹çš„å°è£…-datasource-api" tabindex="-1"><a class="header-anchor" href="#_5-1-1ã€é«˜å±‚æ•°æ®æ¨¡å‹çš„å°è£…-datasource-api"><span>5.1.1ã€é«˜å±‚æ•°æ®æ¨¡å‹çš„å°è£… - DataSource API</span></a></h5><p>Entity APIçš„åŸºç¡€è®¾æ–½ã€‚</p><p>é¦–å…ˆï¼Œåˆ†åˆ«çœ‹å®šä¹‰åœ¨ <code>Viewer</code> åŸå‹é“¾ä¸Šçš„ä¸¤ä¸ªå±æ€§ <code>entities</code>ã€<code>dataSourceDisplay</code>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">Viewer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token literal-property property">dataSourceDisplay</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_dataSourceDisplay<span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token literal-property property">entities</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_dataSourceDisplay<span class="token punctuation">.</span>defaultDataSource<span class="token punctuation">.</span>entities<span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä¸Šé¢ä¸¤ä¸ª getter çœ‹ï¼Œ<strong>EntityCollection</strong> ä¼¼ä¹æ˜¯è¢« <strong>DataSourceDisplay</strong> å¯¹è±¡çš„ <strong>defaultDataSource</strong> ç®¡è¾–çš„ï¼›<strong>defaultDataSource</strong> æ˜¯ <strong>CustomDataSource</strong> ç±»å‹çš„ã€‚</p><p><strong>Viewer</strong> æ‹¥æœ‰ä¸€ä¸ª <strong>DataSourceDisplay</strong> æˆå‘˜ï¼Œ<strong>å®ƒè´Ÿè´£æ‰€æœ‰ DataSource çš„æ›´æ–°</strong>ã€‚</p><h5 id="_5-1-2ã€æ˜¾ç¤ºç®¡ç†å™¨-datasourcedisplay-ä¸é»˜è®¤æ•°æ®æº-customdatasource" tabindex="-1"><a class="header-anchor" href="#_5-1-2ã€æ˜¾ç¤ºç®¡ç†å™¨-datasourcedisplay-ä¸é»˜è®¤æ•°æ®æº-customdatasource"><span>5.1.2ã€æ˜¾ç¤ºç®¡ç†å™¨ DataSourceDisplay ä¸é»˜è®¤æ•°æ®æº CustomDataSource</span></a></h5><p>å®ƒéš <strong>Viewer</strong> åˆ›å»ºè€Œåˆ›å»ºï¼Œè€Œä¸”ä¼˜å…ˆçº§ç›¸å½“é«˜ï¼Œä»…æ¬¡äº <strong>CesiumWidget</strong>ï¼›å®ƒè‡ªå·±åˆ™åˆ›å»ºé»˜è®¤çš„ <strong>DataSource</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>CustomDataSource</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// DataSourceDisplay.js</span>
 <span class="token keyword">function</span> <span class="token function">DataSourceDisplay</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
    <span class="token keyword">const</span> defaultDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomDataSource_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_onDataSourceAdded</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span> defaultDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultDataSource <span class="token operator">=</span> defaultDataSource<span class="token punctuation">;</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™ä¸ª <strong>CustomDataSource</strong> çš„æ„é€ å‡½æ•°é‡Œï¼Œå°±èƒ½æ‰¾åˆ° <strong>Viewer</strong> æš´éœ²å‡ºå»çš„ <strong>EntityCollection</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// CustomDataSource.js</span>
 <span class="token keyword">function</span> <span class="token function">CustomDataSource</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>_entityCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EntityCollection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
 
 Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">CustomDataSource</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token literal-property property">entities</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_entityCollection<span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">// ...</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼ŒåŒ…å«å…³ç³»å°±è¯´æ¸…æ¥šäº†ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code> Viewer
 â”– DataSourceDisplay
   â”– CustomDataSource
     â”– EntityCollection
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>DataSourceDisplay</strong> é™¤äº†ç®¡ç€ <strong>CustomDataSource</strong> è¿™ä¸ªæœåŠ¡äº <strong>Entity API</strong> çš„é»˜è®¤æ•°æ®æºå¤–ï¼Œè¿˜ç®¡ç€å…¶å®ƒçš„ <strong>DataSource</strong>ï¼Œå…¶å®ƒçš„éƒ½ä¼šè£…å…¥ <strong>DataSourceDisplay</strong> çš„ <strong>DataSourceCollection</strong> å®¹å™¨ä¸‹ï¼Œè­¬å¦‚ <strong>GeoJsonDataSource</strong>ã€<strong>CzmlDataSource</strong> ç­‰ï¼Œåœ¨æ–‡æ¡£ä¸­æœ DataSource å…³é”®å­—åŸºæœ¬èƒ½æ‰¾é½ã€‚</p></blockquote><h5 id="_5-1-3ã€é»˜è®¤æ•°æ®æº-customdatasource" tabindex="-1"><a class="header-anchor" href="#_5-1-3ã€é»˜è®¤æ•°æ®æº-customdatasource"><span>5.1.3ã€é»˜è®¤æ•°æ®æºï¼šCustomDataSource</span></a></h5><p>é»˜è®¤çš„æ•°æ®æºçš„ä½œç”¨ï¼Œå°±æ˜¯ç»™ <strong>Entity API</strong> æä¾›åœŸå£¤ã€‚</p><p>ä½†æ˜¯ <strong>CustomDataSource</strong> å¹¶ä¸æ˜¯åªèƒ½ç»™ <strong>Entity API</strong> ä½¿ç”¨ï¼Œåœ¨å®˜æ–¹æ²™ç›’ä¸­å¯ä»¥æ‰¾åˆ°ç›´æ¥ä½¿ç”¨ <strong>CustomDataSource</strong> çš„ä¾‹å­ã€‚</p><h5 id="_5-1-4ã€datasource-apiä¸sceneä¹‹é—´çš„è”ç³»" tabindex="-1"><a class="header-anchor" href="#_5-1-4ã€datasource-apiä¸sceneä¹‹é—´çš„è”ç³»"><span>5.1.4ã€DataSource APIä¸Sceneä¹‹é—´çš„è”ç³»</span></a></h5><p>ç›®å‰äº†è§£çš„ï¼Œåœ¨<strong>Cesium</strong>ä¸­ï¼Œåªæœ‰<strong>Scene</strong>ä¸Šçš„<strong>PrimitiveCollection</strong>æ‰æœ‰æƒåŠ›æ›´æ–°<strong>Primitive</strong>ï¼Œè¿›è€Œåˆ›å»º<strong>DrawCommand</strong>ã€‚</p><p>è€Œ<strong>DataSource API</strong>è¢«åŒ…å«äº<strong>DataSourceDisplay</strong>å¯¹è±¡ï¼Œ<strong>DataSourceDisplay</strong>å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ª<strong>ç§æœ‰çš„primitiveCollection</strong>æˆå‘˜å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token keyword">function</span> <span class="token function">DataSourceDisplay</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// ...</span>
   <span class="token keyword">const</span> scene <span class="token operator">=</span> options<span class="token punctuation">.</span>scene<span class="token punctuation">;</span>
   <span class="token keyword">const</span> dataSourceCollection <span class="token operator">=</span> options<span class="token punctuation">.</span>dataSourceCollection<span class="token punctuation">;</span>
   <span class="token comment">// ...</span>
   
    <span class="token keyword">let</span> primitivesAdded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> primitives <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrimitiveCollection_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> groundPrimitives <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrimitiveCollection_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//è¿™ä¸ªç§æœ‰çš„ PrimitiveCollection åˆ›å»ºå®Œæˆåï¼Œå°±æŠŠå®ƒæ·»åŠ åˆ° Scene çš„ PrimitiveCollection ä¸­äº†ï¼Œä¼´éšç€ CesiumWidget è°ƒåº¦çš„æ¸²æŸ“å¾ªç¯è¿›è¡Œå¸§æ¸²æŸ“ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dataSourceCollection<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scene<span class="token punctuation">.</span>primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>primitives<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scene<span class="token punctuation">.</span>groundPrimitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>groundPrimitives<span class="token punctuation">)</span><span class="token punctuation">;</span>
      primitivesAdded <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
     
    <span class="token keyword">this</span><span class="token punctuation">.</span>_primitives <span class="token operator">=</span> primitives<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_groundPrimitives <span class="token operator">=</span> groundPrimitives<span class="token punctuation">;</span>
   
   <span class="token comment">// ...</span>
   
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>primitivesAdded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// å¯¹äº dataSourceCollection.length æ˜¯ 0 çš„æƒ…å†µ</span>
     <span class="token comment">// ä½¿ç”¨äº‹ä»¶æœºåˆ¶æŠŠç§æœ‰çš„ PrimitiveCollection æ·»åŠ åˆ° scene.primitives ä¸­</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>PrimitiveCollection</strong> æ”¯æŒåµŒå¥—æ·»åŠ ï¼Œä¹Ÿå°±æ˜¯ <strong>Collection</strong> å¯ä»¥æ·»åŠ åˆ° <strong>Collection</strong> ä¸­ï¼Œ<strong>update</strong> æ—¶ä¹Ÿä¼šæ ‘çŠ¶é€çº§å‘ä¸‹æ›´æ–°ã€‚</p></blockquote><h4 id="_5-2ã€å¯è§†åŒ–å™¨â€”â€”visualizer" tabindex="-1"><a class="header-anchor" href="#_5-2ã€å¯è§†åŒ–å™¨â€”â€”visualizer"><span>5.2ã€å¯è§†åŒ–å™¨â€”â€”Visualizer</span></a></h4><blockquote><p>é—®é¢˜ï¼šå¯è§†åŒ–å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>åœ¨<strong>Cesium</strong>ä¸­ï¼Œ<strong>Visualizer</strong>æ˜¯ç”¨äºå°†å®ä½“(<strong>Entity</strong>)ä¸åœºæ™¯(<strong>Scene</strong>)è¿›è¡Œå…³è”çš„ç»„ä»¶ã€‚<strong>Visualizerè´Ÿè´£å¤„ç†å®ä½“çš„æ¸²æŸ“ã€æ›´æ–°å’Œäº¤äº’ç­‰ä»»åŠ¡</strong>ã€‚<strong>Cesium</strong>ä¸­çš„å®ä½“æ˜¯åœ°ç†ç©ºé—´ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æ˜¯ç‚¹ã€çº¿ã€å¤šè¾¹å½¢ã€æ¨¡å‹ç­‰ã€‚</p><p><strong>Visualizer</strong>çš„ä½œç”¨æ˜¯æ ¹æ®å®ä½“çš„å±æ€§å’ŒçŠ¶æ€æ¥ç”Ÿæˆå¯¹åº”çš„å¯è§†åŒ–æ•ˆæœï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚å½“å®ä½“çš„å±æ€§å‘ç”Ÿå˜åŒ–æˆ–éœ€è¦æ›´æ–°æ—¶ï¼Œ<strong>Visualizer</strong>ä¼šè´Ÿè´£æ›´æ–°æ¸²æŸ“æ•ˆæœï¼Œä»è€Œä¿æŒåœºæ™¯çš„å®æ—¶åŒæ­¥ã€‚</p><p><strong>Cesium</strong>ä¸­å†…ç½®äº†å¤šä¸ª<strong>Visualizer</strong>ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„å®ä½“ï¼Œä¾‹å¦‚ï¼š</p><ol><li>PointVisualizerï¼šå¤„ç†ç‚¹å®ä½“çš„æ¸²æŸ“ã€‚</li><li>PolylineVisualizerï¼šå¤„ç†çº¿å®ä½“çš„æ¸²æŸ“ã€‚</li><li>PolygonVisualizerï¼šå¤„ç†å¤šè¾¹å½¢å®ä½“çš„æ¸²æŸ“ã€‚</li><li>ModelVisualizerï¼šå¤„ç†æ¨¡å‹å®ä½“çš„æ¸²æŸ“ã€‚</li></ol><p>é€šè¿‡å°†å®ä½“ä¸<strong>Visualizer</strong>å…³è”ï¼Œ<strong>Cesium</strong>å¯ä»¥é«˜æ•ˆåœ°ç®¡ç†å¤§é‡çš„åœ°ç†ç©ºé—´æ•°æ®ï¼Œå¹¶åœ¨ä¸‰ç»´åœºæ™¯ä¸­è¿›è¡ŒåŠ¨æ€å±•ç¤ºã€‚<strong>Visualizer</strong>çš„çµæ´»æ€§ä¹Ÿä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦<strong>è‡ªå®šä¹‰</strong>æ–°çš„<strong>Visualizer</strong>æ¥å¤„ç†ç‰¹å®šç±»å‹çš„å®ä½“æˆ–å®ç°ç‰¹å®šçš„æ¸²æŸ“æ•ˆæœã€‚</p><h5 id="_5-2-1ã€ä¸ºcustomdatasourceåˆ›å»ºvisualizer" tabindex="-1"><a class="header-anchor" href="#_5-2-1ã€ä¸ºcustomdatasourceåˆ›å»ºvisualizer"><span>5.2.1ã€ä¸ºCustomDataSourceåˆ›å»ºVisualizer</span></a></h5><p>åœ¨<strong>DataSourceDisplay</strong>åˆ›å»º<strong>defaultDataSource</strong>æ—¶ï¼Œä¼šä¸»åŠ¨è°ƒç”¨<code>_onDataSourceAdded</code>æ–¹æ³•ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// packages/engine/Source/DataSources/DataSourceDisplay.js</span>
<span class="token keyword">const</span> defaultDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomDataSource_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//å°†CustomDataSourceç±»å‹çš„å®ä¾‹defaultDataSourceä½œä¸ºå‚æ•°ä¼ å…¥_onDataSourceAddedæ–¹æ³•</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_onDataSourceAdded</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span> defaultDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_defaultDataSource <span class="token operator">=</span> defaultDataSource<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>Viewer
â”–CesiumWidget
â”–DataSourceDisplay
	â”–DataSourceCollection
	â”–CustomDataSource
		â”–EntityCollection
			â”–Entity

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_onDataSourceAdded</code>æ–¹æ³•ä¼šç»™<strong>defaultDataSource</strong>å†åˆ›å»ºä¸€ä¸ªç§æœ‰çš„<strong>PrimitiveCollection</strong>æ·»åŠ åˆ°<strong>DataSourceDisplay</strong>çš„<strong>PrimitiveCollection</strong>ä¸­ã€‚ç´§æ¥ç€ä¼šè°ƒç”¨<code>_visualizersCallback</code>æ–¹æ³•åˆ›å»º<strong>å¯è§†åŒ–å™¨ã€‚</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token comment">// DataSourceDisplay.prototype._onDataSourceAdded ä¸­</span>
 dataSource<span class="token punctuation">.</span>_visualizers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_visualizersCallback</span><span class="token punctuation">(</span>
   scene<span class="token punctuation">,</span>
   entityCluster<span class="token punctuation">,</span>
   dataSource
 <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">DataSourceDisplay</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_visualizersCallback <span class="token operator">=</span> <span class="token function">defaultValue</span><span class="token punctuation">(</span>
    options<span class="token punctuation">.</span>visualizersCallback<span class="token punctuation">,</span>
    DataSourceDisplay<span class="token punctuation">.</span>defaultVisualizersCallback
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">//_visualizersCallbackæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªVisualizerå¯¹è±¡æ•°ç»„</span>
DataSourceDisplay<span class="token punctuation">.</span><span class="token function-variable function">defaultVisualizersCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
<span class="token parameter">scene<span class="token punctuation">,</span>
entityCluster<span class="token punctuation">,</span>
dataSource</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entities <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>entities<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">BillboardVisualizer_default</span><span class="token punctuation">(</span>entityCluster<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">GeometryVisualizer_default</span><span class="token punctuation">(</span>
        scene<span class="token punctuation">,</span>
        entities<span class="token punctuation">,</span>
        dataSource<span class="token punctuation">.</span>_primitives<span class="token punctuation">,</span>
        dataSource<span class="token punctuation">.</span>_groundPrimitives
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">LabelVisualizer_default</span><span class="token punctuation">(</span>entityCluster<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">ModelVisualizer_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">Cesium3DTilesetVisualizer_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">PointVisualizer_default</span><span class="token punctuation">(</span>entityCluster<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">PathVisualizer_default</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> entities<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">PolylineVisualizer_default</span><span class="token punctuation">(</span>
        scene<span class="token punctuation">,</span>
        entities<span class="token punctuation">,</span>
        dataSource<span class="token punctuation">.</span>_primitives<span class="token punctuation">,</span>
        dataSource<span class="token punctuation">.</span>_groundPrimitives
      <span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-2-2ã€entitycollection-ä¸-visualizer-ä¹‹é—´çš„é€šä¿¡-äº‹ä»¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_5-2-2ã€entitycollection-ä¸-visualizer-ä¹‹é—´çš„é€šä¿¡-äº‹ä»¶æœºåˆ¶"><span>5.2.2ã€EntityCollection ä¸ Visualizer ä¹‹é—´çš„é€šä¿¡ - äº‹ä»¶æœºåˆ¶</span></a></h5><blockquote><p>é—®é¢˜ï¼šå¯è§†åŒ–å™¨å¦‚ä½•å°†Entityè½¬æ¢ä¸ºPrimitiveï¼Ÿ</p></blockquote><p>å®é™…ä¸Šï¼Œæ¯ä¸€ä¸ª<strong>CustomDataSource</strong>éƒ½åŒ…å«ä¸€ä¸ªä¸ä¹‹å…³è”çš„<strong>EntityCollection</strong>ï¼Œå®ƒè®©å…¶åŒ…å«çš„<strong>EntityCollection</strong>åœ¨<strong>DataSourceDisplay</strong>ä¸­ä½œä¸ºä¸€ä¸ªåˆç†çš„æ•°æ®æºå­˜åœ¨ã€‚ä½†æ˜¯å¹¶ä¸ç›´æ¥ç›‘å¬Entityçš„å˜åŒ–ã€‚</p><p>çœŸæ­£<strong>ç›´æ¥ç›‘å¬Entityå˜åŒ–</strong>çš„æ˜¯é€šè¿‡<strong>EntityCollection</strong>çš„<strong>äº‹ä»¶æœºåˆ¶</strong>å®Œæˆçš„ï¼Œè€Œ<strong>EntityCollection</strong>æ— è®ºå‘ç”Ÿä»€ä¹ˆå˜åŒ–éƒ½ä¼šä¼ é€’ç»™<strong>Visualizer</strong>ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code>DataSourceDisplay
â”– CustomDataSource
  â”  EntityCollection
  â”ƒ      â†‘
  â”ƒ  äº‹ä»¶æœºåˆ¶ç›‘å¬å˜åŒ–
  â”ƒ      â”ƒ
  â”– <span class="token punctuation">[</span>Visualizers<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>EntityCollection</strong> åŸå‹é“¾ä¸Šçš„ <strong>add/removeById/removeAll</strong> æ–¹æ³•ä¼šæ‰§è¡Œä¸€ä¸ªæ¨¡å—å†…çš„å‡½æ•° <code>fireChangedEvent()</code>ï¼Œå®ƒæœ€æ ¸å¿ƒçš„ä½œç”¨ï¼Œå°±æ˜¯æŠŠå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹çš„ <strong>Entity</strong> é€šè¿‡äº‹ä»¶è§¦å‘é€šçŸ¥ç»™ <strong>Visualizer</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// function fireChangedEvent() ä¸­</span>
<span class="token keyword">const</span> addedArray <span class="token operator">=</span> added<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> removedArray <span class="token operator">=</span> removed<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> changedArray <span class="token operator">=</span> changed<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

added<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
removed<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
changed<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
collection<span class="token punctuation">.</span>_collectionChanged<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span>
  collection<span class="token punctuation">,</span>
  addedArray<span class="token punctuation">,</span>
  removedArray<span class="token punctuation">,</span>
  changedArray
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ï¼Œ<strong>added/removed/changed</strong> æ˜¯ <strong>Entity</strong> å¢åˆ æ”¹æ—¶çš„ä¸´æ—¶ä¿å­˜å®¹å™¨ï¼Œæ¯æ¬¡æ‰§è¡Œ <code>fireChangedEvent()</code> å‡½æ•°æ—¶éƒ½ä¼šæŠŠè¿™ä¸‰ä¸ªå®¹å™¨æ¸…é™¤ã€‚</p><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œè§¦å‘äº‹ä»¶çš„è¿˜æ˜¯<strong>EntityCollection</strong>æœ¬èº«ï¼Œ<code>fireChangedEvent()</code>åªæ˜¯æŠŠå˜åŠ¨çš„ã€æœ€æ–°çš„Entityå–å‡ºå¹¶é€šçŸ¥æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚</p><p>åœ¨<strong>VIsualizer</strong>åˆ›å»ºçš„æ—¶å€™ï¼Œå°±ç»™<strong>EntityCollection</strong>æ³¨å†Œäº†å›è°ƒå‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// åœ¨ GeometryVisualizer çš„æ„é€ å‡½æ•°ä¸­</span>
entityCollection<span class="token punctuation">.</span>collectionChanged<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token class-name">GeometryVisualizer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_onCollectionChanged<span class="token punctuation">,</span>
  <span class="token keyword">this</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯å½“ <strong>EntityCollection</strong> æœ‰å¢åˆ æ”¹å˜åŒ–æ—¶ï¼Œ<strong>GeometryVisualizer</strong> çš„ <code>_onCollectionChanged</code> å°±ä¼šæ”¶åˆ°å˜åŒ–çš„ <strong>Entity</strong>ï¼Œå¹¶ç»§ç»­æ‰§è¡Œåç»­åŠ¨ä½œã€‚</p><p>å…³äº<strong>Entity</strong>çš„å±æ€§çš„ä¿®æ”¹æ˜¯å€ŸåŠ©<strong>Property API</strong>å®Œæˆçš„ï¼Œ<strong>Property API</strong>æ˜¯ç”¨äº<strong>ç®¡ç†å®ä½“ï¼ˆEntityï¼‰å±æ€§çš„ä¸€ç»„æ¥å£å’Œæ–¹æ³•</strong>ã€‚å®ä½“çš„å±æ€§å¯ä»¥æ˜¯å›ºå®šå€¼ã€æ—¶é—´ç›¸å…³å€¼æˆ–åŠ¨æ€è®¡ç®—çš„å€¼ï¼ŒProperty APIä½¿å¾—å®ä½“å±æ€§çš„å¤„ç†æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚åœ¨<strong>add/removeAll/removeById</strong>åˆ°<strong>EntityCollection</strong>æ—¶ï¼Œ<strong>EntityCollection</strong>ä¼šä¸ºè¯¥<strong>Entity</strong>æ³¨å†Œå±æ€§å˜åŠ¨äº‹ä»¶çš„å›è°ƒï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">//add</span>
<span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//...</span>
    entity<span class="token punctuation">.</span>definitionChanged<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
      <span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_onEntityDefinitionChanged<span class="token punctuation">,</span>
      <span class="token keyword">this</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fireChangedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token keyword">return</span> entity<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//removeById</span>
<span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">removeById</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//...</span>
    entity<span class="token punctuation">.</span>definitionChanged<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>
      <span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_onEntityDefinitionChanged<span class="token punctuation">,</span>
      <span class="token keyword">this</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fireChangedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//removeAll</span>
<span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">removeAll</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//...</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> entitiesLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	  <span class="token comment">//...</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">defined_default</span><span class="token punctuation">(</span>addedItem<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        existingItem<span class="token punctuation">.</span>definitionChanged<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>
          <span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_onEntityDefinitionChanged<span class="token punctuation">,</span>
          <span class="token keyword">this</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        removed<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>existingItemId<span class="token punctuation">,</span> existingItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//...</span>
    <span class="token function">fireChangedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code> <span class="token class-name">EntityCollection</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_onEntityDefinitionChanged</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">entity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> entity<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_addedEntities<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_changedEntities<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fireChangedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>_onEntityDefinitionChanged</code> åœ¨ <strong>Entity</strong> çš„ <code>definitionChanged</code> äº‹ä»¶è§¦å‘åæ‰§è¡Œï¼Œä¹Ÿè¿˜æ˜¯æ‰§è¡Œ <code>fireChangedEvent</code> å‡½æ•°</p><h4 id="_5-3ã€æ—¶é’Ÿclock" tabindex="-1"><a class="header-anchor" href="#_5-3ã€æ—¶é’Ÿclock"><span>5.3ã€æ—¶é’ŸClock</span></a></h4><blockquote><p>é—®é¢˜ï¼šæ€ä¹ˆè§¦å‘DataSourceDisplayçš„æ›´æ–°ï¼Ÿ</p></blockquote><p><strong>CesiumWidget</strong>ä¸­æ‹¥æœ‰ä¸€ä¸ªæ—¶é’Ÿæˆå‘˜å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// CesiumWidget æ„é€ å‡½æ•°ä¸­</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_clock <span class="token operator">=</span> <span class="token function">defined</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>clock<span class="token punctuation">)</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>clock <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>é»˜è®¤çš„æ—¶é’Ÿä¼šåœ¨<strong>æ¯ä¸€å¸§</strong>æ¸²æŸ“è°ƒåº¦å‡½æ•°ä¸­<strong>è·³åŠ¨</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">CesiumWidget</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_canRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_scene<span class="token punctuation">.</span><span class="token function">initializeFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> currentTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_clock<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_scene<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_clock<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ— è®ºæ˜¯å¦æ¸²æŸ“ï¼Œéƒ½ä¼šè°ƒç”¨<code>Clock.prototype.tick()</code>æ–¹æ³•è·³åŠ¨ä¸€æ¬¡æ—¶é’Ÿï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè§¦å‘<strong>onTick</strong>äº‹ä»¶ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">Clock</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onTick<span class="token punctuation">.</span><span class="token function">raiseEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œåœ¨<strong>Viewer</strong>çš„æ„é€ å‡½æ•°ä¸­ï¼Œå…ˆåˆ›å»ºäº†<strong>CesiumWidget</strong>ï¼Œéšåå°±ä¸ºæ—¶é’Ÿæ³¨å†Œäº†<strong>onTick</strong>çš„å›è°ƒå‡½æ•°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Viewer</span><span class="token punctuation">(</span><span class="token parameter">container<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// eventHelper æ˜¯ä¸€ä¸ªäº‹ä»¶åŠ©æ‰‹å¯¹è±¡ï¼Œæ­¤å¤„ä¸º clock æ³¨å†Œäº‹ä»¶ç”¨</span>
  eventHelper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>clock<span class="token punctuation">.</span>onTick<span class="token punctuation">,</span> <span class="token class-name">Viewer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>_onTick<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token class-name">Viewer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_onTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">clock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> clock<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>

  <span class="token keyword">const</span> isUpdated <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_dataSourceDisplay<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <strong>_onTick</strong> æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä»¶åšçš„äº‹æƒ…å°±æ˜¯æ‰§è¡Œ <strong>DataSourceDisplay</strong> çš„æ›´æ–°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">DataSourceDisplay</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  
  <span class="token keyword">let</span> visualizers<span class="token punctuation">;</span>
  <span class="token keyword">let</span> vLength<span class="token punctuation">;</span>
  
  visualizers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_defaultDataSource<span class="token punctuation">.</span>_visualizers<span class="token punctuation">;</span>
  vLength <span class="token operator">=</span> visualizers<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> vLength<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> visualizers<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªæ›´æ–°æ–¹æ³•å…¶å®å°±æ˜¯ <strong>è¿›ä¸€æ­¥æ›´æ–°</strong> <strong>DataSourceDisplay</strong> ä¸­æ‰€æœ‰çš„æ•°æ®æºï¼ˆæ— è®ºæ˜¯æ•°æ®æºå®¹å™¨ä¸­çš„è¿˜æ˜¯é»˜è®¤çš„ <strong>CustomDataSource</strong> çš„ï¼‰çš„ <strong>å¯è§†åŒ–å™¨ï¼ˆVisualizerï¼‰</strong>ã€‚</p><p><strong>CesiumWidget</strong> è´Ÿè´£è°ƒåº¦ <strong>Scene</strong> çš„å¸§æ¸²æŸ“ï¼ŒåŒæ—¶ä¼šè·³åŠ¨æ—¶é’Ÿå¯¹è±¡ï¼Œæ—¶é’Ÿå¯¹è±¡çš„è·³åŠ¨åˆè¿›è€Œé€šçŸ¥ <strong>Viewer</strong> æ›´æ–° <strong>DataSourceDisplay</strong> ä¸‹è¾–çš„æ‰€æœ‰ <strong>DataSource</strong>ã€‚</p><h4 id="_5-4ã€-visualizer-çš„æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#_5-4ã€-visualizer-çš„æ›´æ–°"><span>5.4ã€ Visualizer çš„æ›´æ–°</span></a></h4><h5 id="_5-4-1ã€æ›´æ–°æ–¹æ³•ä¸­çš„ä¸‰ä¸ªå¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_5-4-1ã€æ›´æ–°æ–¹æ³•ä¸­çš„ä¸‰ä¸ªå¾ªç¯"><span>5.4.1ã€æ›´æ–°æ–¹æ³•ä¸­çš„ä¸‰ä¸ªå¾ªç¯</span></a></h5><blockquote><p>ä¸‰ä¸ªå¾ªç¯æŠŠ<code>_addedObjects/_removedObjects/_changedObjects</code>è¿™ä¸‰ç±»é€†åºéå†é€šè¿‡EntityCollectionçš„äº‹ä»¶æœºåˆ¶ä¼ é€’ç»™Visualizer</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">GeometryVisualizer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> addedObjects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_addedObjects<span class="token punctuation">;</span>
  <span class="token keyword">const</span> added <span class="token operator">=</span> addedObjects<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
  <span class="token keyword">const</span> removedObjects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_removedObjects<span class="token punctuation">;</span>
  <span class="token keyword">const</span> removed <span class="token operator">=</span> removedObjects<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
  <span class="token keyword">const</span> changedObjects <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_changedObjects<span class="token punctuation">;</span>
  <span class="token keyword">const</span> changed <span class="token operator">=</span> changedObjects<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
  
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  <span class="token keyword">let</span> entity<span class="token punctuation">;</span>
  <span class="token keyword">let</span> id<span class="token punctuation">;</span>
  <span class="token keyword">let</span> updaterSet<span class="token punctuation">;</span>
  <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> changed<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> removed<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> added<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  
  addedObjects<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  removedObjects<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  changedObjects<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ›´æ–°æ–¹æ³•ä¼šå–ä¸‰ç±»<strong>Entity</strong>ï¼ˆ<code>_addedObjects/_removedObjects/_changedObjects</code>ï¼‰è¿›è¡Œé€†åºéå†ã€‚è¿™ä¸‰ä¸ªå®¹å™¨ä¼šé€šè¿‡EntityCollectionçš„äº‹ä»¶æœºåˆ¶ä¼ é€’ç»™Visualizerã€‚</p><h5 id="_5-4-2ã€visualizer-çš„æ•°æ®è½¬æ¢å·¥å…·-updater" tabindex="-1"><a class="header-anchor" href="#_5-4-2ã€visualizer-çš„æ•°æ®è½¬æ¢å·¥å…·-updater"><span>5.4.2ã€Visualizer çš„æ•°æ®è½¬æ¢å·¥å…· - Updater</span></a></h5><blockquote><p>Updateræ˜¯ä»€ä¹ˆ?</p></blockquote><p>åœ¨ä½¿ç”¨Property APIå»ä¿®æ”¹å®ä½“Entityçš„å±æ€§ï¼ˆå¤–è§‚ã€å½¢çŠ¶...ï¼‰æ—¶ï¼Œè¿™äº›åŠ¨æ€å€¼æ¯ä¸€å¸§éœ€è¦å˜æˆé™æ€å€¼ä¼ é€’ç»™WebGLï¼ŒEntityä¸­çš„å‡ ä½•ç±»å‹æ¯”è¾ƒå¤šï¼ŒCesiumåˆ†åˆ«ä¸ºè¿™äº›å‡ ä½•ç±»å‹çš„åŠ¨æ€è½¬é™æ€çš„è¿‡ç¨‹è¿›è¡Œäº†å°è£…â€”â€”Updaterï¼šç”¨äºè¾…åŠ©å‡ ä½•ç±»å‹çš„Entityçš„å‡ ä½•æ•°æ®æ›´æ–°ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨GeometryVisualizer.jsæ¨¡å—ä¸­ï¼Œæœ‰å¦‚ä¸‹æ•°ç»„ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> geometryUpdaters <span class="token operator">=</span> <span class="token punctuation">[</span>
  BoxGeometryUpdater<span class="token punctuation">,</span>
  CylinderGeometryUpdater<span class="token punctuation">,</span>
  CorridorGeometryUpdater<span class="token punctuation">,</span>
  EllipseGeometryUpdater<span class="token punctuation">,</span>
  EllipsoidGeometryUpdater<span class="token punctuation">,</span>
  PlaneGeometryUpdater<span class="token punctuation">,</span>
  PolygonGeometryUpdater<span class="token punctuation">,</span>
  PolylineVolumeGeometryUpdater<span class="token punctuation">,</span>
  RectangleGeometryUpdater<span class="token punctuation">,</span>
  WallGeometryUpdater<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›å°±æ˜¯å¯¹åº”çš„å‡ ä½•æ›´æ–°å™¨ã€‚è¿™äº›å‡ ä½•æ›´æ–°å™¨ç±»ä¸­å¯ä»¥æ‰¾åˆ°createXXXGeometryInstanceåŸå‹é“¾ä¸Šçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š<code>EllipsoidGeometryUpdater.prototype.createFillGeometryInstance</code> æ–¹æ³•ã€‚</p><figure><img src="/assets/image-20230720183619566-CUAzhCzf.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¿™äº›æ–¹æ³•å°±æ˜¯æœ€ååˆ›å»º <code>Primitive</code> æ—¶æ‰€éœ€çš„ <code>GeometryInstance</code> çš„åˆ›å»ºè€…ï¼Œå®ƒä»¬ä¾èµ–äºæ—¶é—´ï¼Œè¿”å›è¯¥æ—¶é—´çš„é™æ€å‡ ä½•å€¼ã€‚</p><h5 id="_5-4-3ã€updater-çš„é›†åˆ-geometryupdaterset" tabindex="-1"><a class="header-anchor" href="#_5-4-3ã€updater-çš„é›†åˆ-geometryupdaterset"><span>5.4.3ã€Updater çš„é›†åˆ - GeometryUpdaterSet</span></a></h5><blockquote><p>GeometryUpdateræ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>åœ¨GeometryVisualizer.prototype.updateæ–¹æ³•ä¸­ï¼Œä¸‰ä¸ªé€†åºå¾ªç¯åœ¨è®¿é—®ä¸€ä¸ªGeometryUpdaterSetç±»å‹çš„å®¹å™¨ã€‚è¿™ä¸ªå®¹å™¨æ˜¯<code>GeometryVisualizer.js</code> æ¨¡å—å†…çš„ç§æœ‰ç±»ã€‚</p><p>åªæœ‰åœ¨éå† <code>_addedObjects</code> æ—¶æ‰ä¼šåˆ›å»º <code>GeometryUpdaterSet</code>ï¼Œæ­¤æ—¶æ–°æ¥çš„ <code>Entity</code> ä¼šä¼ ç»™è¿™ä¸ªé›†åˆã€‚è¿™ä¸ªé›†åˆçš„ä½œç”¨ä¹Ÿæ¯”è¾ƒç®€å•</p><ul><li>ä¸ºæ–°æ¥ <strong>Entity</strong> åˆ›å»º<strong>æ‰€æœ‰çš„</strong>å‡ ä½•æ›´æ–°å™¨ï¼ˆè¿™å°±æ˜¯æ€§èƒ½å¯èƒ½ä¼šå‡ºç°é—®é¢˜çš„åŸå› ä¹‹ä¸€äº†ï¼‰</li><li>ä¸ºæ‰€æœ‰çš„å‡ ä½•æ›´æ–°å™¨æ³¨å†Œ <code>geometryChanged</code> äº‹ä»¶çš„å“åº”å‡½æ•°</li></ul><p>è¿™ä¸ªå‡ ä½•æ›´æ–°å™¨é›†åˆåˆ›å»ºå®Œåï¼Œä¼šå­˜å‚¨åˆ° <strong>GeometryVisualizer</strong> ä¸­ï¼Œå¹¶ä¸ <strong>Entity</strong> çš„ <strong>id</strong> ä½œç»‘å®šï¼ˆæ–¹ä¾¿å…¶å®ƒä¸¤ä¸ªé€†åºå¾ªç¯æŸ¥æ‰¾ï¼‰</p><figure><img src="/assets/image-20230720183900757-CWvRQJRb.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_5-4-4ã€æ€§èƒ½çš„æå‡-updater-çš„åˆ†æ‰¹" tabindex="-1"><a class="header-anchor" href="#_5-4-4ã€æ€§èƒ½çš„æå‡-updater-çš„åˆ†æ‰¹"><span>5.4.4ã€æ€§èƒ½çš„æå‡ - Updater çš„åˆ†æ‰¹</span></a></h5><blockquote><p>åˆ†æ‰¹çš„ä½œç”¨ï¼Ÿåˆ†æ‰¹çš„åç»­æ“ä½œï¼Ÿ</p></blockquote><p>WebGL çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œå•å¸§å†…ç»˜åˆ¶çš„æ¬¡æ•°è¶Šå°‘ï¼Œå°±è¶Šæµç•…ã€‚<strong>GeometryVisualizer</strong> å¦‚æœä¸ä¸ºè¿™äº›æ¥å—æ¥çš„ <strong>Entity</strong> åˆ†ç±»å½’å¹¶æ‰¹æ¬¡ï¼Œè€Œæ˜¯ç²—æš´åœ°æŠŠæ¯ä¸ª <strong>Entity</strong> ç›´æ¥ç”Ÿæˆé™æ€å‡ ä½•ã€å¤–è§‚æ•°æ®å°±åˆ›å»º <strong>Primitive</strong> çš„è¯ï¼Œæœ‰å¤šå°‘ <strong>Entity</strong> å°±ä¼šæœ‰å¤šå°‘ <strong>Primitive</strong>ï¼Œä¹Ÿå°±æœ‰å¤šå°‘ <strong>DrawCommand</strong>ï¼Œæ€§èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚</p><p>æ‰€ä»¥ï¼ŒCesiumåœ¨<strong>GeometryVisualizer</strong> ä¸­è®¾è®¡äº†ä¸€ä¸ªåˆ†æ‰¹çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯åŸå‹é“¾ä¸Šçš„ <code>_insertUpdaterIntoBatch</code> æ–¹æ³•ã€‚</p><p>åœ¨ <strong>GeometryVisualizer</strong> æ›´æ–°æ—¶ï¼Œä¸‰ä¸ªåˆ—è¡¨å¾ªç¯ä¸­çš„ä¸¤ä¸ªï¼ˆæ·»åŠ åˆ—è¡¨å’Œæ›´æ”¹åˆ—è¡¨ï¼‰éƒ½ä¼šè°ƒç”¨ <code>_insertUpdaterIntoBatch</code> æ–¹æ³•ï¼ŒæŠŠç”±äºæ–°å¢æˆ–ä¿®æ”¹ <strong>Entity</strong> è€Œåˆ›å»ºå‡ºæ¥çš„æ–°çš„ Updater åšåˆ†æ‰¹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token class-name">GeometryVisualizer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> changed<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    that<span class="token punctuation">.</span><span class="token function">_insertUpdaterIntoBatch</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> updater<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
  
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> added<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    that<span class="token punctuation">.</span><span class="token function">_insertUpdaterIntoBatch</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> updater<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œåœ¨ <code>_insertUpdaterIntoBatch</code> æ–¹æ³•ä¸­ï¼Œèƒ½çœ‹åˆ°éå¸¸å¤šçš„åˆ†æ”¯åˆ¤æ–­ä»¥åŠ <strong>add</strong> æ“ä½œï¼Œè¿™å°±æ˜¯å°† <strong>Updater</strong> æ ¹æ®<strong>ä¸åŒçš„æ¡ä»¶</strong>åˆ†é…åˆ° <strong>Visualizer</strong> ä¸Šä¸åŒçš„<strong>æ‰¹æ¬¡å®¹å™¨</strong>ä¸­çš„è¿‡ç¨‹äº†ã€‚</p><figure><img src="/assets/image-20230720184145376-Cc_9CAB1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_5-4-5ã€visualizer-æ›´æ–°çš„æœ€åä¸€æ­¥-æ‰¹æ¬¡å®¹å™¨æ›´æ–°" tabindex="-1"><a class="header-anchor" href="#_5-4-5ã€visualizer-æ›´æ–°çš„æœ€åä¸€æ­¥-æ‰¹æ¬¡å®¹å™¨æ›´æ–°"><span>5.4.5ã€Visualizer æ›´æ–°çš„æœ€åä¸€æ­¥ - æ‰¹æ¬¡å®¹å™¨æ›´æ–°</span></a></h5><blockquote><p>æ‰¹æ¬¡å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><h4 id="_5-5ã€æ‰¹æ¬¡å®¹å™¨å®Œæˆæ•°æ®åˆå¹¶-primitive-åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#_5-5ã€æ‰¹æ¬¡å®¹å™¨å®Œæˆæ•°æ®åˆå¹¶-primitive-åˆ›å»º"><span>5.5ã€æ‰¹æ¬¡å®¹å™¨å®Œæˆæ•°æ®åˆå¹¶ - Primitive åˆ›å»º</span></a></h4><h5 id="_5-5-1ã€æ‰¹æ¬¡å®¹å™¨çš„ç±»å‹ä¸åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#_5-5-1ã€æ‰¹æ¬¡å®¹å™¨çš„ç±»å‹ä¸åˆ›å»º"><span>5.5.1ã€æ‰¹æ¬¡å®¹å™¨çš„ç±»å‹ä¸åˆ›å»º</span></a></h5><p>CesiumJS ç›®å‰ç‰ˆæœ¬æä¾›äº†è‹¥å¹²ç§æ‰¹æ¬¡å®¹å™¨ï¼š</p><ul><li><code>DynamicGeometryBatch</code>ï¼š_dynamicBatch</li><li><code>StaticOutlineGeometryBatch</code>ï¼š_outlineBatches</li><li><code>StaticGroundGeometryColorBatch</code>ï¼š_groundColorBatches</li><li><code>StaticGroundGeometryPerMaterialBatch</code>ï¼š_groundMaterialBatches</li><li><code>StaticGeometryColorBatch</code>ï¼š_closedColorBatchesã€_openColorBatches</li><li><code>StaticGeometryPerMaterialBatch</code>ï¼š_closedMaterialBatchesã€_openMaterialBatches</li></ul><p>ä¸Šé¢åˆ—å‡ºçš„ï¼Œå‰è€…æ˜¯ç±»å‹ï¼Œå†’å·åé¢çš„æ˜¯ Visualizer çš„æˆå‘˜å­—æ®µï¼ˆä¹Ÿå°±æ˜¯å…·ä½“æ‰¹æ¬¡å®¹å™¨å¯¹è±¡ï¼‰ï¼Œä»åç§°ä¸éš¾çœ‹å‡ºå®ƒä»¬çš„ä¸åŒä¹‹å¤„ï¼Œå¤§éƒ¨åˆ†æ˜¯ç”¨æè´¨æˆ–é¢œè‰²æ¥ä½œä¸ºåˆ†ç±»ä¾æ®ã€‚</p><p>åœ¨ <strong>GeometryVisualizer</strong> çš„æ„é€ å‡½æ•°ä¸­æ‰¾åˆ°åˆ›å»ºè¿™äº›æˆå‘˜å­—æ®µçš„ä»£ç ï¼ˆå…¶å®æ„é€ å‡½æ•°é‡Œå¤§éƒ¨åˆ†ä»£ç ä¹Ÿæ˜¯åœ¨åˆ›å»ºæ‰¹æ¬¡å®¹å™¨ï¼‰ã€‚å®ƒä»¬æœ€ç»ˆä¼šåˆå¹¶åˆ° <strong>_batches</strong> æ•°ç»„ä¸­æ–¹ä¾¿éå†ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>_batches <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_outlineBatches<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_closedColorBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_closedMaterialBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_openColorBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_openMaterialBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_groundColorBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_groundMaterialBatches<span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_dynamicBatch
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-5-2ã€-å†…éƒ¨æ‰¹æ¬¡å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#_5-5-2ã€-å†…éƒ¨æ‰¹æ¬¡å®¹å™¨"><span>5.5.2ã€ å†…éƒ¨æ‰¹æ¬¡å®¹å™¨</span></a></h5><blockquote><p>å†…éƒ¨æ‰¹æ¬¡å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>åœ¨ä¸Šè¿°åˆ—ä¸¾çš„æ‰¹æ¬¡å®¹å™¨ï¼Œåªæ˜¯ä¸€ä¸ªä»£ç†å®¹å™¨ï¼ŒçœŸæ­£èµ·åˆ°å­˜å‚¨ä½œç”¨çš„æ˜¯è¿™äº›æ‰¹æ¬¡å®¹å™¨æ¨¡å—æ–‡ä»¶å†…éƒ¨çš„Batchç±»ã€‚</p><p>ä»¥æœ€ç®€å•çš„é™æ€æ‰¹æ¬¡å®¹å™¨ <strong>StaticGeometryColorBatch</strong> ä¸ºä¾‹ï¼Œå®ƒåœ¨ <strong>Updater</strong> é€šè¿‡ <strong>add</strong> æ–¹æ³•æ·»åŠ è¿›æ¥æ—¶ï¼Œå°±ä¼šåˆ›å»ºå†…éƒ¨ <strong>Batch</strong>ï¼ŒåŒæ—¶åˆ›å»ºè¿™ä¸ªæ—¶åˆ»çš„ <strong>GeometryInstance</strong>ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Batch</span><span class="token punctuation">(</span>
  <span class="token parameter">primitives<span class="token punctuation">,</span>
  translucent<span class="token punctuation">,</span>
  appearanceType<span class="token punctuation">,</span>
  depthFailAppearanceType<span class="token punctuation">,</span>
  depthFailMaterialProperty<span class="token punctuation">,</span>
  closed<span class="token punctuation">,</span>
  shadows</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token class-name">StaticGeometryColorBatch</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time<span class="token punctuation">,</span> updater</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> updater<span class="token punctuation">.</span><span class="token function">createFillGeometryInstance</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  
  <span class="token keyword">const</span> batch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Batch</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  batch<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>updater<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
  items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>batch<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå†…éƒ¨ <strong>Batch</strong> å­˜æ”¾ç€å¤–è§‚ä¿¡æ¯å’Œ <strong>GeometryInstance</strong> å¯¹è±¡ã€‚</p><figure><img src="/assets/image-20230720184712642-Bt824hiW.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_5-5-3ã€åˆ›å»º-primitive" tabindex="-1"><a class="header-anchor" href="#_5-5-3ã€åˆ›å»º-primitive"><span>5.5.3ã€åˆ›å»º Primitive</span></a></h5><p>åœ¨ Visualizer çš„æ›´æ–°æ–¹æ³•ä¸­ï¼Œæœ€åå°±æ˜¯å¯¹æ‰€æœ‰æ‰¹æ¬¡å®¹å™¨è¿›è¡Œæ›´æ–°ã€‚ä»ä»¥ <strong>StaticGeometryColorBatch</strong> ä¸ºä¾‹ï¼Œå®ƒçš„æ›´æ–°æ–¹æ³•ä¼šè°ƒç”¨ä¸€ä¸ªæ¨¡å—å†…çš„ <code>updateItems</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹ä¼ å…¥çš„æŸéƒ¨åˆ†å†…éƒ¨ <strong>Batch</strong> æ‰§è¡Œæ›´æ–°ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// StaticGeometryColorBatch.js ä¸­</span>

<span class="token keyword">function</span> <span class="token function">updateItems</span><span class="token punctuation">(</span><span class="token parameter">batch<span class="token punctuation">,</span> items<span class="token punctuation">,</span> time<span class="token punctuation">,</span> isUpdated</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isUpdated <span class="token operator">=</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isUpdated<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token class-name">StaticGeometryColorBatch</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>solidsMoved <span class="token operator">||</span> translucentsMoved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isUpdated <span class="token operator">=</span>
      <span class="token function">updateItems</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_solidItems<span class="token punctuation">,</span> time<span class="token punctuation">,</span> isUpdated<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isUpdated<span class="token punctuation">;</span>
    isUpdated <span class="token operator">=</span>
      <span class="token function">updateItems</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_translucentItems<span class="token punctuation">,</span> time<span class="token punctuation">,</span> isUpdated<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isUpdated<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>StaticGeometryColorBatch</strong> ä¸Šçš„ <code>_solidItems</code> å’Œ <code>_translucentItems</code> éƒ½æ˜¯æ™®é€šçš„æ•°ç»„ï¼Œä¿å­˜çš„æ˜¯æ¨¡å—å†…éƒ¨å®šä¹‰ <strong>Batch</strong> ç±»å‹çš„å¯¹è±¡ã€‚</p><p>è€Œè¿™äº›å†…éƒ¨ <strong>Batch</strong> çš„æ›´æ–°å‡½æ•°ï¼Œæœ€ç»ˆå°±ä¼šæ ¹æ®å­˜å‚¨çš„ä¿¡æ¯ï¼Œå®Œæˆ <strong>Primitive</strong> çš„åˆ›å»ºï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// StaticGeometryColorBatch.js ä¸­</span>

<span class="token comment">// ... è¿™ä¸ªæ–¹æ³•å¾ˆé•¿ï¼ŒèŠ‚çº¦ç¯‡å¹…</span>
<span class="token class-name">Batch</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> isUpdated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> removedCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> primitive <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>primitive<span class="token punctuation">;</span>
  <span class="token keyword">const</span> primitives <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>primitives<span class="token punctuation">;</span>
  <span class="token keyword">let</span> i<span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>createPrimitive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> geometries <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    <span class="token keyword">const</span> geometriesLength <span class="token operator">=</span> geometries<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>geometriesLength <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      primitive <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Primitive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      primitives<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>primitive<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token comment">// else ...</span>
  <span class="token punctuation">}</span> <span class="token comment">// else ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡³æ­¤ï¼Œ<strong>Entity</strong> ç»ˆäºå®Œæˆäº†é™æ€ <strong>Primitive</strong> çš„åˆ›å»ºï¼Œæ¥ç€ç­‰å¾… <strong>Scene</strong> åœ¨å¸§æ¸²æŸ“æµç¨‹ä¸­æ›´æ–° <strong>PrimitiveCollection</strong> è¿›è€Œåˆ›å»ºå‡º <strong>DrawCommand</strong>ï¼Œç­‰å¾… <strong>WebGL</strong> ç»˜åˆ¶ã€‚</p><h4 id="_5-6ã€æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_5-6ã€æ€»ç»“"><span>5.6ã€æ€»ç»“</span></a></h4><blockquote><p>å…³äºCesiumWidgetè°ƒåº¦æ¸²æŸ“ã€primitiveæ¸²æŸ“ã€Entityæ¸²æŸ“è§£æã€APIå…³ç³»æ¶æ„</p></blockquote><p>![](./img/Cesium æ¸²æŸ“è§£æ.jpg)</p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/studyNotes/Cesiumç¬”è®°/11ã€Cesiumè¿›é˜¶ä¸€ï¼šæºç è§£æ.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: gistwj@163.com">tangwenjian</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/10%E3%80%81Cesium%E5%9F%BA%E7%A1%80%E5%8D%81%EF%BC%9A%E5%8A%A0%E8%BD%BD%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE.html" aria-label="10ã€CesiumåŠ è½½å¤šæºæ•°æ®"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->10ã€CesiumåŠ è½½å¤šæºæ•°æ®</div></a><a class="route-link nav-link next" href="/studyNotes/Cesium%E7%AC%94%E8%AE%B0/12%E3%80%81Cesium%E5%AE%9E%E6%88%98%E4%B8%80%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%9C%B0%E7%90%83.html" aria-label="12ã€åˆ›å»ºåœ°çƒ"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">12ã€åˆ›å»ºåœ°çƒ<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">å·²ç»åˆ°åº•äº†</div><div class="vp-copyright">Copyright Â© 2024 ç¥­å¸å” </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DVIbrNyI.js" defer></script>
  </body>
</html>
